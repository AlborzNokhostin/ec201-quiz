<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EC201 International Macroeconomics Quiz - Weeks 1-3</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            background-attachment: fixed;
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3), transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(102, 126, 234, 0.2), transparent 50%);
            pointer-events: none;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            box-shadow: 0 30px 80px rgba(0,0,0,0.4), 0 0 0 1px rgba(255,255,255,0.1);
            overflow: hidden;
            position: relative;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse"><path d="M 40 0 L 0 0 0 40" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            opacity: 0.5;
        }

        .logos-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            margin-bottom: 25px;
            position: relative;
            z-index: 1;
        }

        .header-logo {
            height: 70px;
            width: auto;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
            transition: transform 0.3s ease;
        }

        .header-logo:hover {
            transform: scale(1.05);
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 12px;
            font-weight: 700;
            letter-spacing: -0.5px;
            position: relative;
            z-index: 1;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 17px;
            opacity: 0.95;
            font-weight: 400;
            position: relative;
            z-index: 1;
        }

        .ai-disclaimer {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 20px 10px 20px;
            text-align: center;
        }

        .ai-disclaimer p {
            margin: 0;
            font-size: 0.9em;
            line-height: 1.6;
            color: #4a5568;
        }

        .ai-disclaimer strong {
            color: #6366f1;
            font-size: 1.05em;
        }

        .week-selector {
            display: flex;
            justify-content: center;
            gap: 12px;
            padding: 30px 20px;
            background: linear-gradient(180deg, #f8f9fa 0%, #ffffff 100%);
            flex-wrap: wrap;
            border-bottom: 1px solid #e9ecef;
        }

        .difficulty-selector {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            gap: 15px;
            padding: 20px;
            background: linear-gradient(180deg, #ffffff 0%, #f8f9fa 100%);
            border-bottom: 1px solid #e9ecef;
        }

        .difficulty-label {
            text-align: center;
            font-weight: 600;
            color: #4a5568;
            font-size: 1em;
        }

        .difficulty-buttons {
            display: flex;
            gap: 12px;
        }

        .difficulty-btn {
            padding: 12px 28px;
            border: 2px solid #e9ecef;
            background: white;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95em;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .difficulty-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(139, 92, 246, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .difficulty-btn:hover::before {
            left: 100%;
        }

        .difficulty-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.15);
            border-color: #8b5cf6;
        }

        .difficulty-btn.active {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            border-color: #8b5cf6;
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.3);
        }

        .week-btn {
            padding: 14px 28px;
            border: 2px solid transparent;
            background: white;
            color: #667eea;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
            position: relative;
            overflow: hidden;
        }

        .week-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .week-btn:hover::before {
            left: 100%;
        }

        .week-btn:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
            border-color: transparent;
        }

        .week-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .quiz-area {
            padding: 30px;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e9ecef;
            border-radius: 10px;
            margin-bottom: 35px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.06);
            position: relative;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, rgba(255,255,255,0.3), transparent);
            border-radius: 10px 10px 0 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 30px;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4));
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        .question-card {
            display: none;
        }

        .question-card.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .belgrade-card {
            cursor: pointer;
        }

        .belgrade-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .question-number {
            font-size: 14px;
            color: #667eea;
            font-weight: 600;
        }

        .question-text {
            font-size: 20px;
            color: #2d3748;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option {
            padding: 20px 24px;
            border: 2px solid #e9ecef;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            position: relative;
            overflow: hidden;
        }

        .option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .option:hover::before {
            transform: scaleY(1);
        }

        .option:hover {
            border-color: #667eea;
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            transform: translateX(8px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #edf2f7 0%, #e6f2ff 100%);
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.2);
        }

        .option.selected::before {
            transform: scaleY(1);
        }

        .option.correct {
            border-color: #48bb78;
            background: linear-gradient(135deg, #f0fff4 0%, #dcffe4 100%);
            box-shadow: 0 4px 16px rgba(72, 187, 120, 0.2);
        }

        .option.correct::before {
            background: #48bb78;
            transform: scaleY(1);
        }

        .option.incorrect {
            border-color: #f56565;
            background: linear-gradient(135deg, #fff5f5 0%, #ffebeb 100%);
            box-shadow: 0 4px 16px rgba(245, 101, 101, 0.2);
        }

        .option.incorrect::before {
            background: #f56565;
            transform: scaleY(1);
        }

        .option-label {
            font-weight: 600;
            color: #667eea;
            margin-right: 10px;
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }

        .feedback.show {
            display: block;
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .feedback.correct {
            background: #f0fff4;
            border-left: 4px solid #48bb78;
            color: #22543d;
        }

        .feedback.incorrect {
            background: #fff5f5;
            border-left: 4px solid #f56565;
            color: #742a2a;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: space-between;
        }

        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%);
            color: #2d3748;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #dee2e6 0%, #e9ecef 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .results {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .results.show {
            display: block;
            animation: fadeIn 0.5s;
        }

        .score-circle {
            width: 220px;
            height: 220px;
            margin: 0 auto 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 56px;
            font-weight: 800;
            box-shadow:
                0 15px 40px rgba(102, 126, 234, 0.4),
                0 0 0 10px rgba(102, 126, 234, 0.1),
                0 0 0 20px rgba(102, 126, 234, 0.05);
            position: relative;
            animation: scoreReveal 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes scoreReveal {
            0% {
                transform: scale(0) rotate(-180deg);
                opacity: 0;
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        .score-circle::before {
            content: '';
            position: absolute;
            inset: -3px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            opacity: 0.5;
            filter: blur(10px);
            z-index: -1;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 0.5;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.3;
            }
        }

        .results h2 {
            font-size: 32px;
            color: #2d3748;
            margin-bottom: 20px;
        }

        .results-details {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .result-stat {
            text-align: center;
        }

        .result-stat-value {
            font-size: 36px;
            font-weight: bold;
            color: #667eea;
        }

        .result-stat-label {
            font-size: 14px;
            color: #718096;
            margin-top: 5px;
        }

        .start-screen {
            text-align: center;
            padding: 60px 40px;
        }

        .start-screen h2 {
            font-size: 32px;
            color: #2d3748;
            margin-bottom: 20px;
        }

        .start-screen p {
            font-size: 18px;
            color: #718096;
            margin-bottom: 40px;
            line-height: 1.8;
        }

        .week-description {
            background: #f7fafc;
            padding: 20px;
            border-radius: 12px;
            margin: 30px 0;
            text-align: left;
        }

        .week-description h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .week-description ul {
            list-style-position: inside;
            color: #4a5568;
            line-height: 2;
        }

        .name-input-section {
            margin: 30px 0;
        }

        .name-input {
            padding: 18px 24px;
            font-size: 17px;
            border: 2px solid #e9ecef;
            border-radius: 14px;
            width: 100%;
            max-width: 450px;
            margin: 10px auto;
            display: block;
            text-align: center;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .name-input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.15);
            transform: translateY(-2px);
        }

        .name-input::placeholder {
            color: #adb5bd;
            font-weight: 400;
        }

        .ai-review-section {
            background: linear-gradient(135deg, #f5f7fa 0%, #e8edf4 100%);
            padding: 30px;
            border-radius: 12px;
            margin-top: 30px;
            text-align: left;
            border: 2px solid #667eea;
        }

        .ai-review-section h3 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
            font-size: 24px;
        }

        .ai-review-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            line-height: 1.8;
        }

        .ai-loading {
            text-align: center;
            color: #667eea;
            font-style: italic;
            padding: 20px;
        }

        .topic-analysis {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #dc3545;
            border-radius: 4px;
        }

        .topic-analysis.good {
            border-left-color: #28a745;
        }

        .topic-analysis.okay {
            border-left-color: #ffc107;
        }

        .topic-name {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .topic-score {
            font-size: 14px;
            color: #718096;
        }

        .ai-summary {
            background: #667eea;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .recommendations {
            margin-top: 20px;
        }

        .recommendation-item {
            padding: 10px;
            margin: 10px 0;
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            border-radius: 4px;
        }

        .leaderboard-section {
            background: #f7fafc;
            padding: 30px;
            border-radius: 12px;
            margin-top: 30px;
            text-align: left;
        }

        .leaderboard-section h3 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
            font-size: 24px;
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
        }

        .leaderboard-table th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        .leaderboard-table td {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
        }

        .leaderboard-table tr:hover {
            background: #edf2f7;
        }

        .rank-badge {
            display: inline-block;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            font-size: 14px;
        }

        .rank-badge.gold {
            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
        }

        .rank-badge.silver {
            background: linear-gradient(135deg, #a8b8d8 0%, #c7d2e9 100%);
        }

        .rank-badge.bronze {
            background: linear-gradient(135deg, #cd7f32 0%, #d4926f 100%);
        }

        .share-section {
            margin-top: 30px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 12px;
        }

        .share-section h4 {
            color: #2d3748;
            margin-bottom: 15px;
        }

        .share-link {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .share-link input {
            flex: 1;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
        }

        .btn-copy {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-copy:hover {
            background: #5568d3;
        }

        .user-greeting {
            text-align: center;
            padding: 20px;
            background: #f7fafc;
            color: #2d3748;
            font-size: 18px;
        }

        .user-greeting strong {
            color: #667eea;
        }

        .no-leaderboard {
            text-align: center;
            color: #718096;
            padding: 20px;
            font-style: italic;
        }

        .view-leaderboard-btn {
            margin-top: 20px;
            padding: 12px 24px;
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
        }

        .view-leaderboard-btn:hover {
            background: #667eea;
            color: white;
        }

        /* Chat Styles */
        .chat-toggle-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .chat-toggle-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.6);
        }

        .chat-container {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 380px;
            height: 550px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            display: none;
            flex-direction: column;
            z-index: 999;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .chat-container.show {
            display: flex;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            font-weight: 600;
            font-size: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .chat-close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            background: linear-gradient(180deg, #f8f9fa 0%, #ffffff 100%);
        }

        .chat-message {
            display: flex;
            flex-direction: column;
            gap: 4px;
            animation: messageSlide 0.3s ease-out;
        }

        @keyframes messageSlide {
            from {
                transform: translateX(-10px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .chat-message-author {
            font-size: 12px;
            font-weight: 600;
            color: #667eea;
        }

        .chat-message-text {
            background: white;
            padding: 12px 16px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            word-wrap: break-word;
            max-width: 85%;
            color: #2d3748;
            line-height: 1.5;
        }

        .chat-message-time {
            font-size: 11px;
            color: #a0aec0;
            margin-top: 2px;
        }

        .chat-input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 14px;
            outline: none;
            transition: border-colour 0.2s;
            font-family: 'Inter', sans-serif;
        }

        .chat-input:focus {
            border-color: #667eea;
        }

        .chat-send-btn {
            padding: 12px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s;
        }

        .chat-send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .chat-send-btn:active {
            transform: translateY(0);
        }

        /* Mobile responsiveness for chat */
        @media (max-width: 768px) {
            .chat-container {
                width: calc(100vw - 40px);
                right: 20px;
                bottom: 90px;
                height: 500px;
            }

            .chat-toggle-btn {
                right: 20px;
                bottom: 20px;
            }
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logos-container">
                <img src="Warwick_University_Shield.svg.png" alt="Warwick Shield" class="header-logo">
                <img src="u_of_w_third_party_lockup_positive_rgb.jpg" alt="University of Warwick" class="header-logo">
            </div>
            <h1>EC201 International Macroeconomics</h1>
            <p>MCQ Assessment - Weeks 1-5</p>
        </div>

        <div class="ai-disclaimer">
            <p>
                <strong>ðŸ“Š About These Questions:</strong><br><br>
                These questions have been derived from all content uploaded to Moodle for EC201 using AI analysis, including pre-class questions, pre-class answers, in-class questions, lecture slides, and reference books.<br><br>

                The questions are designed to reflect concepts with a higher likelihood of exam appearance based on comprehensive content analysis.<br><br>

                Questions are designed with the intention of understanding and learning the content in the fastest amount of time rather than assessment. Constant quality checks are made on the question quality.<br><br>

                More questions will be uploaded to the site during the week. Questions are now categorized into easy and hard difficulty levels.<br><br>

                There may be some issues with the mathematical formulation of certain questions, which are being worked on and should be fixed soon.<br><br>

                Any opinions or ideas are welcomed through the chat panel designed on the site.
            </p>
        </div>

        <div class="week-selector">
            <button class="week-btn active" data-week="all">All Weeks</button>
            <button class="week-btn" data-week="1">Week 1: Global Imbalances</button>
            <button class="week-btn" data-week="2">Week 2: Sustainability</button>
            <button class="week-btn" data-week="3">Week 3: Current Account Theory</button>
            <button class="week-btn" data-week="4">Week 4: Terms of Trade & Tariffs</button>
            <button class="week-btn" data-week="5">Week 5: Production Economy</button>
        </div>

        <div class="difficulty-selector">
            <div class="difficulty-label">ðŸ“Š Select Difficulty Level:</div>
            <div class="difficulty-buttons">
                <button class="difficulty-btn active" data-difficulty="easy">ðŸŸ¢ Easy - Original Questions</button>
                <button class="difficulty-btn" data-difficulty="hard">ðŸ”´ Hard - Challenging Questions</button>
            </div>
        </div>

        <!-- Belgrade Tracker Toggle Button -->
        <div style="text-align: center; padding: 15px; background: #f8f9fa;">
            <button onclick="toggleBelgradeTracker()" class="btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer;">
                ðŸ“Š Belgrade Tracker - Professor's Emphasis Patterns
            </button>
        </div>

        <!-- Belgrade Tracker Section -->
        <div id="belgradeTracker" style="display: none; padding: 80px 20px; background: #fafafa; opacity: 0; animation: fadeIn 0.6s ease-out forwards;">
            <div style="max-width: 1100px; margin: 0 auto;">
                <h2 style="text-align: left; color: #1a1a1a; margin-bottom: 16px; font-size: 2.5em; font-weight: 300; letter-spacing: -0.5px;">Belgrade Tracker</h2>
                <p style="text-align: left; color: #666; margin-bottom: 60px; line-height: 1.8; max-width: 800px; font-size: 1.05em;">
                    Professor Vukotic has an emphasis on repeating "test" to reference potential questions. I analysed her complete lecture recordings across 7 weeks (6,479 sentences, 107,621 words, 1,503 "OK"s) to identify which weeks she discussed the test most frequently (72 total test/exam mentions), along with the primary topics emphasised in each lecture. I have checked the word and character count with different LLMs, so I am in good confidence to say the model has captured every word and sentence she said.
                </p>

                <!-- Test/Exam Mentions by Lecture -->
                <div style="margin-bottom: 80px;">
                    <h3 style="color: #1a1a1a; margin-bottom: 32px; font-size: 1.4em; font-weight: 400;">Test/Exam References Per Lecture</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1px; background: #e0e0e0;">
                        <div class="belgrade-card" style="background: white; padding: 28px 24px; transition: all 0.3s ease;">
                            <div style="font-size: 0.75em; color: #999; font-weight: 500; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;">Week 1 â€” Oct 9</div>
                            <div style="font-size: 2.2em; color: #1a1a1a; font-weight: 300; margin-bottom: 8px;">26</div>
                            <div style="font-size: 0.9em; color: #666; margin-bottom: 16px;">Total mentions</div>
                            <div style="font-size: 0.85em; color: #999; line-height: 1.6;">
                                <div>Test: 16</div>
                                <div>Exam: 10</div>
                                <div>OK: 198</div>
                            </div>
                            <div style="border-top: 1px solid #e5e5e5; margin-top: 16px; padding-top: 16px;">
                                <div style="font-size: 0.85em; color: #1a1a1a; font-weight: 500;">Current Account & NIIP</div>
                            </div>
                        </div>
                        <div class="belgrade-card" style="background: white; padding: 28px 24px; transition: all 0.3s ease;">
                            <div style="font-size: 0.75em; color: #999; font-weight: 500; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;">Week 2 â€” Oct 16</div>
                            <div style="font-size: 2.2em; color: #1a1a1a; font-weight: 300; margin-bottom: 8px;">2</div>
                            <div style="font-size: 0.9em; color: #666; margin-bottom: 16px;">Total mentions</div>
                            <div style="font-size: 0.85em; color: #999; line-height: 1.6;">
                                <div>Test: 2</div>
                                <div>Exam: 0</div>
                                <div>OK: 276</div>
                            </div>
                            <div style="border-top: 1px solid #e5e5e5; margin-top: 16px; padding-top: 16px;">
                                <div style="font-size: 0.85em; color: #1a1a1a; font-weight: 500;">Trade Balance & Transversality</div>
                            </div>
                        </div>
                        <div class="belgrade-card" style="background: white; padding: 28px 24px; transition: all 0.3s ease;">
                            <div style="font-size: 0.75em; color: #999; font-weight: 500; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;">Week 3 â€” Oct 23</div>
                            <div style="font-size: 2.2em; color: #1a1a1a; font-weight: 300; margin-bottom: 8px;">6</div>
                            <div style="font-size: 0.9em; color: #666; margin-bottom: 16px;">Total mentions</div>
                            <div style="font-size: 0.85em; color: #999; line-height: 1.6;">
                                <div>Test: 4</div>
                                <div>Exam: 2</div>
                                <div>OK: 303</div>
                            </div>
                            <div style="border-top: 1px solid #e5e5e5; margin-top: 16px; padding-top: 16px;">
                                <div style="font-size: 0.85em; color: #1a1a1a; font-weight: 500;">Consumption & Euler Equation</div>
                            </div>
                        </div>
                        <div class="belgrade-card" style="background: white; padding: 28px 24px; transition: all 0.3s ease;">
                            <div style="font-size: 0.75em; color: #999; font-weight: 500; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;">Week 4 â€” Oct 30</div>
                            <div style="font-size: 2.2em; color: #1a1a1a; font-weight: 300; margin-bottom: 8px;">2</div>
                            <div style="font-size: 0.9em; color: #666; margin-bottom: 16px;">Total mentions</div>
                            <div style="font-size: 0.85em; color: #999; line-height: 1.6;">
                                <div>Test: 0</div>
                                <div>Exam: 2</div>
                                <div>OK: 166</div>
                            </div>
                            <div style="border-top: 1px solid #e5e5e5; margin-top: 16px; padding-top: 16px;">
                                <div style="font-size: 0.85em; color: #1a1a1a; font-weight: 500;">Interest Rates & Consumption</div>
                            </div>
                        </div>
                        <div class="belgrade-card" style="background: white; padding: 28px 24px; transition: all 0.3s ease;">
                            <div style="font-size: 0.75em; color: #999; font-weight: 500; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;">Week 5 â€” Nov 6</div>
                            <div style="font-size: 2.2em; color: #1a1a1a; font-weight: 300; margin-bottom: 8px;">4</div>
                            <div style="font-size: 0.9em; color: #666; margin-bottom: 16px;">Total mentions</div>
                            <div style="font-size: 0.85em; color: #999; line-height: 1.6;">
                                <div>Test: 4</div>
                                <div>Exam: 0</div>
                                <div>OK: 176</div>
                            </div>
                            <div style="border-top: 1px solid #e5e5e5; margin-top: 16px; padding-top: 16px;">
                                <div style="font-size: 0.85em; color: #1a1a1a; font-weight: 500;">Investment & Interest Rates</div>
                            </div>
                        </div>
                        <div class="belgrade-card" style="background: white; padding: 28px 24px; transition: all 0.3s ease;">
                            <div style="font-size: 0.75em; color: #999; font-weight: 500; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;">Week 6 â€” Nov 13</div>
                            <div style="font-size: 2.2em; color: #1a1a1a; font-weight: 300; margin-bottom: 8px;">10</div>
                            <div style="font-size: 0.9em; color: #666; margin-bottom: 16px;">Total mentions</div>
                            <div style="font-size: 0.85em; color: #999; line-height: 1.6;">
                                <div>Test: 10</div>
                                <div>Exam: 0</div>
                                <div>OK: 195</div>
                            </div>
                            <div style="border-top: 1px solid #e5e5e5; margin-top: 16px; padding-top: 16px;">
                                <div style="font-size: 0.85em; color: #1a1a1a; font-weight: 500;">Saving & Consumption</div>
                            </div>
                        </div>
                        <div class="belgrade-card" style="background: white; padding: 28px 24px; transition: all 0.3s ease;">
                            <div style="font-size: 0.75em; color: #999; font-weight: 500; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;">Week 7 â€” Nov 20</div>
                            <div style="font-size: 2.2em; color: #1a1a1a; font-weight: 300; margin-bottom: 8px;">22</div>
                            <div style="font-size: 0.9em; color: #666; margin-bottom: 16px;">Total mentions</div>
                            <div style="font-size: 0.85em; color: #999; line-height: 1.6;">
                                <div>Test: 20</div>
                                <div>Exam: 2</div>
                                <div>OK: 189</div>
                            </div>
                            <div style="border-top: 1px solid #e5e5e5; margin-top: 16px; padding-top: 16px;">
                                <div style="font-size: 0.85em; color: #1a1a1a; font-weight: 500;">Interest Rates & Saving</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Topic Emphasis Chart -->
                <div style="margin-bottom: 80px;">
                    <h3 style="color: #1a1a1a; margin-bottom: 32px; font-size: 1.4em; font-weight: 400;">Topic Emphasis Across All Lectures</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1px; background: #e0e0e0;">
                        <div class="belgrade-card" style="background: white; padding: 24px 20px; text-align: center; transition: all 0.3s ease;">
                            <div style="font-size: 2em; color: #1a1a1a; font-weight: 300; margin-bottom: 8px;">439</div>
                            <div style="font-size: 0.85em; color: #666;">Current Account</div>
                        </div>
                        <div class="belgrade-card" style="background: white; padding: 24px 20px; text-align: center; transition: all 0.3s ease;">
                            <div style="font-size: 2em; color: #1a1a1a; font-weight: 300; margin-bottom: 8px;">368</div>
                            <div style="font-size: 0.85em; color: #666;">Interest Rate</div>
                        </div>
                        <div class="belgrade-card" style="background: white; padding: 24px 20px; text-align: center; transition: all 0.3s ease;">
                            <div style="font-size: 2em; color: #1a1a1a; font-weight: 300; margin-bottom: 8px;">327</div>
                            <div style="font-size: 0.85em; color: #666;">Consumption</div>
                        </div>
                        <div class="belgrade-card" style="background: white; padding: 24px 20px; text-align: center; transition: all 0.3s ease;">
                            <div style="font-size: 2em; color: #1a1a1a; font-weight: 300; margin-bottom: 8px;">275</div>
                            <div style="font-size: 0.85em; color: #666;">Investment</div>
                        </div>
                        <div class="belgrade-card" style="background: white; padding: 24px 20px; text-align: center; transition: all 0.3s ease;">
                            <div style="font-size: 2em; color: #1a1a1a; font-weight: 300; margin-bottom: 8px;">271</div>
                            <div style="font-size: 0.85em; color: #666;">Trade Balance</div>
                        </div>
                        <div class="belgrade-card" style="background: white; padding: 24px 20px; text-align: center; transition: all 0.3s ease;">
                            <div style="font-size: 2em; color: #1a1a1a; font-weight: 300; margin-bottom: 8px;">207</div>
                            <div style="font-size: 0.85em; color: #666;">Saving</div>
                        </div>
                        <div class="belgrade-card" style="background: white; padding: 24px 20px; text-align: center; transition: all 0.3s ease;">
                            <div style="font-size: 2em; color: #1a1a1a; font-weight: 300; margin-bottom: 8px;">78</div>
                            <div style="font-size: 0.85em; color: #666;">Tariff</div>
                        </div>
                        <div class="belgrade-card" style="background: white; padding: 24px 20px; text-align: center; transition: all 0.3s ease;">
                            <div style="font-size: 2em; color: #1a1a1a; font-weight: 300; margin-bottom: 8px;">71</div>
                            <div style="font-size: 0.85em; color: #666;">Terms of Trade</div>
                        </div>
                        <div class="belgrade-card" style="background: white; padding: 24px 20px; text-align: center; transition: all 0.3s ease;">
                            <div style="font-size: 2em; color: #1a1a1a; font-weight: 300; margin-bottom: 8px;">47</div>
                            <div style="font-size: 0.85em; color: #666;">Valuation</div>
                        </div>
                        <div class="belgrade-card" style="background: white; padding: 24px 20px; text-align: center; transition: all 0.3s ease;">
                            <div style="font-size: 2em; color: #1a1a1a; font-weight: 300; margin-bottom: 8px;">34</div>
                            <div style="font-size: 0.85em; color: #666;">Euler</div>
                        </div>
                        <div class="belgrade-card" style="background: white; padding: 24px 20px; text-align: center; transition: all 0.3s ease;">
                            <div style="font-size: 2em; color: #1a1a1a; font-weight: 300; margin-bottom: 8px;">8</div>
                            <div style="font-size: 0.85em; color: #666;">Transversality</div>
                        </div>
                    </div>
                </div>

                <!-- 5 Equations You Definitely Need to Know -->
                <div style="margin-bottom: 80px;">
                    <h3 style="color: #1a1a1a; margin-bottom: 16px; font-size: 1.4em; font-weight: 400;">5 Equations You Definitely Need to Know</h3>
                    <p style="color: #666; margin-bottom: 32px; line-height: 1.8; font-size: 0.95em;">Based on question frequency analysis and Professor Vukotic's emphasis patterns</p>
                    <div style="display: flex; flex-direction: column; gap: 1px; background: #e0e0e0;">
                        <div class="belgrade-card" style="background: white; padding: 32px 28px; transition: all 0.3s ease;">
                            <div style="font-size: 0.75em; color: #999; font-weight: 500; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;">1. Current Account Identity</div>
                            <div style="font-size: 1.1em; color: #1a1a1a; margin-bottom: 12px; font-family: 'Courier New', monospace;">CA<sub>t</sub> = TB<sub>t</sub> + rÂ·B<sub>t-1</sub> + NUT</div>
                            <div style="font-size: 0.9em; color: #666; line-height: 1.6;">Current account equals trade balance plus net investment income (interest times previous period debt) plus net unilateral transfers</div>
                        </div>
                        <div class="belgrade-card" style="background: white; padding: 32px 28px; transition: all 0.3s ease;">
                            <div style="font-size: 0.75em; color: #999; font-weight: 500; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;">2. Transversality Condition</div>
                            <div style="font-size: 1.1em; color: #1a1a1a; margin-bottom: 12px; font-family: 'Courier New', monospace;">lim<sub>tâ†’âˆž</sub> B<sub>t</sub>/(1+r)<sup>t</sup> = 0</div>
                            <div style="font-size: 0.9em; color: #666; line-height: 1.6;">Present discounted value of debt must go to zero (NOT debt itself). Debt growth rate must be less than interest rate. "I'll probably put it on the test for sure" - Week 2</div>
                        </div>
                        <div class="belgrade-card" style="background: white; padding: 32px 28px; transition: all 0.3s ease;">
                            <div style="font-size: 0.75em; color: #999; font-weight: 500; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;">3. Euler Equation</div>
                            <div style="font-size: 1.1em; color: #1a1a1a; margin-bottom: 12px; font-family: 'Courier New', monospace;">u'(C<sub>1</sub>) = Î²(1+r)Â·u'(C<sub>2</sub>)</div>
                            <div style="font-size: 0.9em; color: #666; line-height: 1.6;">Optimal consumption choice equates marginal utility today to discounted marginal utility tomorrow. With log utility: C<sub>2</sub>/C<sub>1</sub> = Î²(1+r)</div>
                        </div>
                        <div class="belgrade-card" style="background: white; padding: 32px 28px; transition: all 0.3s ease;">
                            <div style="font-size: 0.75em; color: #999; font-weight: 500; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;">4. NIIP Evolution</div>
                            <div style="font-size: 1.1em; color: #1a1a1a; margin-bottom: 12px; font-family: 'Courier New', monospace;">NIIP<sub>t</sub> = NIIP<sub>t-1</sub> + CA<sub>t</sub> + Valuation Changes</div>
                            <div style="font-size: 0.9em; color: #666; line-height: 1.6;">Net International Investment Position changes through current account AND capital gains/losses. "This would be again test question" - Week 1</div>
                        </div>
                        <div class="belgrade-card" style="background: white; padding: 32px 28px; transition: all 0.3s ease;">
                            <div style="font-size: 0.75em; color: #999; font-weight: 500; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;">5. Intertemporal Budget Constraint</div>
                            <div style="font-size: 1.1em; color: #1a1a1a; margin-bottom: 12px; font-family: 'Courier New', monospace;">C<sub>1</sub> + C<sub>2</sub>/(1+r) = Q<sub>1</sub> + Q<sub>2</sub>/(1+r) + B<sub>0</sub></div>
                            <div style="font-size: 0.9em; color: #666; line-height: 1.6;">Present value of consumption equals present value of income plus initial assets. Fundamental constraint for small open economy model</div>
                        </div>
                    </div>
                </div>

                <!-- Summary Stats -->
                <div style="background: #1a1a1a; padding: 60px 40px; color: white;">
                    <h3 style="margin-bottom: 40px; font-size: 1.4em; font-weight: 400; color: white;">Overall Statistics</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 40px;">
                        <div>
                            <div style="font-size: 3em; font-weight: 300; margin-bottom: 8px; color: white;">72</div>
                            <div style="font-size: 0.9em; opacity: 0.7; color: white;">Total Test/Exam Mentions</div>
                        </div>
                        <div>
                            <div style="font-size: 3em; font-weight: 300; margin-bottom: 8px; color: white;">1,503</div>
                            <div style="font-size: 0.9em; opacity: 0.7; color: white;">Total "OK" Count</div>
                        </div>
                        <div>
                            <div style="font-size: 3em; font-weight: 300; margin-bottom: 8px; color: white;">107,621</div>
                            <div style="font-size: 0.9em; opacity: 0.7; color: white;">Total Words Spoken</div>
                        </div>
                        <div>
                            <div style="font-size: 3em; font-weight: 300; margin-bottom: 8px; color: white;">7</div>
                            <div style="font-size: 0.9em; opacity: 0.7; color: white;">Weeks Analysed</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div id="startScreen" class="start-screen">
            <h2>Ready to Test Your Knowledge?</h2>
            <p>This quiz covers key concepts from Weeks 1-5 of EC201 International Macroeconomics.</p>

            <div class="name-input-section">
                <label for="userName" style="display: block; margin-bottom: 10px; font-weight: 600; color: #2d3748;">Enter Your Name:</label>
                <input type="text" id="userName" class="name-input" placeholder="Your name..." required>
            </div>

            <div style="background: #f8f9fa; padding: 24px; border-radius: 8px; margin: 30px 0; text-align: left; max-width: 900px; margin-left: auto; margin-right: auto; border-left: 4px solid #667eea;">
                <h3 style="margin-top: 0; color: #2d3748; font-size: 1.3em;">About This Quiz</h3>
                <p style="line-height: 1.8; color: #4a5568; margin-bottom: 12px;">
                    These questions have been derived from all content uploaded to Moodle for EC201 using AI analysis, including pre-class questions, pre-class answers, in-class questions, lecture slides, and reference books.
                </p>
                <p style="line-height: 1.8; color: #4a5568; margin-bottom: 12px;">
                    The questions are designed to reflect concepts with a higher likelihood of exam appearance based on comprehensive content analysis.
                </p>
                <p style="line-height: 1.8; color: #4a5568; margin-bottom: 12px;">
                    Questions are designed with the intention of understanding and learning the content in the fastest amount of time rather than assessment. Constant quality checks are made on the question quality.
                </p>
                <p style="line-height: 1.8; color: #4a5568; margin-bottom: 12px;">
                    More questions will be uploaded to the site during the week. Questions are now categorised into easy and hard difficulty levels.
                </p>
                <p style="line-height: 1.8; color: #4a5568; margin-bottom: 12px;">
                    There may be some issues with the mathematical formulation of certain questions, which are being worked on and should be fixed soon.
                </p>
                <p style="line-height: 1.8; color: #4a5568; margin-bottom: 12px;">
                    Any opinions or ideas are welcomed through the chat panel designed on the site.
                </p>
                <p style="line-height: 1.8; color: #4a5568; margin-bottom: 0; font-weight: 600;">
                    <strong>Belgrade Tracker:</strong> I've analysed Professor Vukotic's complete lecture transcripts to identify which weeks she emphasised the test most (Week 1 & 7 had the most mentions). Check the tracker to see her exact test/exam references per week and the 5 equations you definitely need to know.
                </p>
            </div>

            <div class="week-description">
                <h3>Topics Covered:</h3>
                <ul>
                    <li><strong>Week 1:</strong> Balance of Payments, NIIP, Global imbalances</li>
                    <li><strong>Week 2:</strong> Trade balance sustainability, Transversality conditions</li>
                    <li><strong>Week 3:</strong> Small open economy model, Consumption smoothing</li>
                    <li><strong>Week 4:</strong> Terms of Trade shocks, World interest rates, Tariffs</li>
                    <li><strong>Week 5:</strong> Production economy, Investment/Saving schedules, Metzler diagram</li>
                </ul>
            </div>

            <button class="btn btn-primary" onclick="startQuiz()" style="font-size: 18px; padding: 18px 36px;">Start Quiz</button>
            <button class="btn btn-primary" onclick="restartQuiz()" style="font-size: 18px; padding: 18px 36px; margin-left: 15px;">Restart Quiz</button>
            <button class="btn view-leaderboard-btn" onclick="showLeaderboardOnly()">View Leaderboard</button>

            <div id="leaderboardDisplay" class="leaderboard-section" style="display: none;">
                <h3>ðŸ† Leaderboard</h3>
                <div id="leaderboardContent"></div>
            </div>
        </div>

        <div id="quizArea" class="quiz-area" style="display: none;">
            <div class="user-greeting" id="userGreeting"></div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div id="questionContainer"></div>

            <div class="button-group">
                <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()">Previous</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" disabled>Next Question</button>
            </div>
        </div>

        <div id="results" class="results">
            <div class="score-circle" id="scoreCircle">0%</div>
            <h2 id="resultsTitle">Quiz Complete!</h2>
            <div class="results-details">
                <div class="result-stat">
                    <div class="result-stat-value" id="correctCount">0</div>
                    <div class="result-stat-label">Correct</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-value" id="incorrectCount">0</div>
                    <div class="result-stat-label">Incorrect</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-value" id="totalCount">0</div>
                    <div class="result-stat-label">Total Questions</div>
                </div>
            </div>

            <div id="aiReviewSection" class="ai-review-section">
                <h3>ðŸ“Š AI Performance Analysis</h3>
                <div id="aiReview" class="ai-review-content">
                    <div class="ai-loading">Analyzing your performance...</div>
                </div>
            </div>

            <div class="leaderboard-section">
                <h3>ðŸ† Leaderboard</h3>
                <div id="finalLeaderboard"></div>
            </div>

            <button class="btn btn-primary" onclick="restartQuiz()" style="margin-top: 30px;">Restart Quiz</button>
        </div>

    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAeRv3FnOy8-pNoqZWRmh-Wbj41rpQExlo",
            authDomain: "ec201-c1bb6.firebaseapp.com",
            databaseURL: "https://ec201-c1bb6-default-rtdb.firebaseio.com",
            projectId: "ec201-c1bb6",
            storageBucket: "ec201-c1bb6.firebasestorage.app",
            messagingSenderId: "579096241028",
            appId: "1:579096241028:web:972f85a4161e1309c9f3d1",
            measurementId: "G-94G3LFX721"
        };

        // Initialize Firebase
        let database;
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            console.log('Firebase initialized successfully');
        } catch (error) {
            console.error('Firebase initialization error:', error);
            database = null;
        }

        const questions = [
            // EASY QUESTIONS - Original simpler versions
            // Week 1: Global Imbalances - Easy (10 questions)
            {
                week: 1,
                difficulty: "easy",
                topic: "Balance of Payments Components",
                question: "The Balance of Payments consists of which main components?",
                options: ["Trade Balance + Income Balance only",
                    "GDP + Net Exports + Government Spending",
                    "Current Account + Financial Account + Capital Account",
                    "Exports + Imports + Transfers in the economy"],
                correct: 2,
                explanation: "The Balance of Payments = Current Account + Financial Account + Capital Account."
            },
            {
                week: 1,
                difficulty: "easy",
                topic: "Balance of Payments Components",
                question: "What does the Trade Balance measure?",
                options: ["Total government spending on trade",
                    "Net unilateral transfers in the economy",
                    "Foreign investment flows in the economy",
                    "Exports minus Imports of goods and services"],
                correct: 3,
                explanation: "Trade Balance = Exports - Imports (goods & services)."
            },
            {
                week: 1,
                difficulty: "easy",
                topic: "NIIP and Valuation",
                question: "Net International Investment Position (NIIP) is calculated as:",
                options: ["Exports - Imports in the economy",
                    "Foreign Assets - Foreign Liabilities",
                    "Current Account - Trade Balance",
                    "GDP - National Debt in the economy"],
                correct: 1,
                explanation: "NIIP = Foreign Assets - Foreign Liabilities. It represents accumulated wealth position."
            },
            {
                week: 1,
                difficulty: "easy",
                topic: "NIIP and Valuation",
                question: "What is the relationship between Current Account deficits and NIIP?",
                options: ["Current Account Deficit doubles the NIIP",
                    "Current Account Deficit causes NIIP to fall",
                    "Current Account Deficit causes NIIP to rise",
                    "They are unrelated in the economy"],
                correct: 1,
                explanation: "A Current Account Deficit leads to a fall in NIIP, while a Current Account Surplus causes NIIP to rise."
            },
            {
                week: 1,
                difficulty: "easy",
                topic: "Global Creditors and Debtors",
                question: "Which of the following is a major external creditor?",
                options: ["United States",
                    "Australia",
                    "Japan in the economy",
                    "United Kingdom"],
                correct: 2,
                explanation: "Japan, China, and Germany are major external creditors. The US is the world's largest debtor."
            },
            {
                week: 1,
                difficulty: "easy",
                topic: "NIIP and Valuation",
                question: "Why might NIIP not equal accumulated current accounts?",
                options: ["Because trade is measured incorrectly",
                    "They are always equal in the economy",
                    "Because of calculation errors in the economy",
                    "Because of valuation changes from market price movements"],
                correct: 3,
                explanation: "NIIP changes from two sources: (1) Current Account flows and (2) Valuation changes (stock/bond prices, exchange rates)."
            },
            {
                week: 1,
                difficulty: "easy",
                topic: "NIIP and Valuation",
                question: "During 2002-2007, the US ran $3.9 trillion in current account deficits but NIIP improved by $80 billion. What explains this?",
                options: ["Increased exports in the economy",
                    "Measurement error in the economy",
                    "$4 trillion in positive valuation changes",
                    "Reduced imports in the economy"],
                correct: 2,
                explanation: "The US benefited from $4 trillion in positive valuation changes, offsetting the current account deficits."
            },
            {
                week: 1,
                difficulty: "easy",
                topic: "Dark Matter and Return Differential",
                question: "The 'Dark Matter' hypothesis suggests:",
                options: ["Foreign countries hide their investments",
                    "Unmeasured intangible assets mean true NIIP might be positive",
                    "Trade statistics are completely wrong in the economy",
                    "The US has hidden debt obligations in the economy"],
                correct: 1,
                explanation: "The Dark Matter hypothesis suggests unmeasured intangible assets (brands, know-how) mean the true NIIP might actually be positive."
            },
            {
                week: 1,
                difficulty: "easy",
                topic: "Dark Matter and Return Differential",
                question: "The 'Return Differential' hypothesis explains the NIIP-NII paradox by:",
                options: ["The US invests in high-return assets (stocks/FDI) while foreigners invest in low-return US assets (Treasury bonds)",
                    "The US borrows at high rates and lends at low rates in the economy",
                    "Returns don't matter for investment income in the economy",
                    "All countries earn the same return"],
                correct: 0,
                explanation: "The Return Differential hypothesis: US invests in high-return foreign assets while foreigners invest in low-return US assets, related to 'exorbitant privilege'."
            },
            {
                week: 1,
                difficulty: "easy",
                topic: "Balance of Payments Components",
                question: "Which is included in the Income Balance component of the Current Account?",
                options: ["Government transfers only in the economy",
                    "Exports and imports of goods in the economy",
                    "Net Investment Income and Net Compensation to Employees",
                    "Capital gains on stocks in the economy"],
                correct: 2,
                explanation: "Income Balance = Net Investment Income + Net Compensation to Employees."
            },

            // Week 2: Sustainability - Easy (10 questions)
            {
                week: 2,
                difficulty: "easy",
                topic: "Finite vs Infinite Horizon",
                question: "In a two-period economy with terminal condition B<sub>2</sub> = 0, can a net debtor run perpetual trade balance deficits?",
                options: ["No, must run surplus in at least one period",
                    "Yes, always under these conditions",
                    "Yes, but only if interest rates are negative",
                    "It depends on GDP growth in the economy"],
                correct: 0,
                explanation: "In finite horizon, a net debtor cannot run perpetual TB deficits - must run a surplus in at least one period to satisfy the sustainability condition."
            },
            {
                week: 2,
                difficulty: "easy",
                topic: "Transversality Condition",
                question: "What is the transversality condition in the infinite horizon model?",
                options: ["The present value of debt must vanish: lim(Tâ†’âˆž) B<sub>t</sub>/(1+r)áµ€ = 0",
                    "Debt must grow faster than interest rate",
                    "Current account must always be positive",
                    "Debt must equal zero under these conditions"],
                correct: 0,
                explanation: "The transversality (No-Ponzi-Game) condition: lim(Tâ†’âˆž) B<sub>t</sub>/(1+r)áµ€ = 0. Present value of debt must vanish (not that debt goes to zero)."
            },
            {
                week: 2,
                difficulty: "easy",
                topic: "Perpetual Deficits",
                question: "In infinite horizon, can a net debtor run perpetual current account deficits?",
                options: ["No, never in the economy",
                    "Only if GDP shrinks in the economy",
                    "Yes, if paying fraction Î± âˆˆ (0,1) of interest via trade surplus",
                    "Only for one period in the economy"],
                correct: 2,
                explanation: "Yes! A net debtor CAN run perpetual CA deficits in infinite horizon if following a debt-servicing policy: TB<sub>t</sub> = -Î±rB<sub>t</sub>â‚‹<sub>1</sub> where Î± âˆˆ (0,1)."
            },
            {
                week: 2,
                difficulty: "easy",
                topic: "Debt Growth and Sustainability",
                question: "For perpetual CA deficits to be sustainable, debt must grow at rate g where:",
                options: ["g < r, specifically g = r(1-Î±) where Î± > 0",
                    "g can be anything in the economy",
                    "g = r (equal to interest rate)",
                    "g > r (faster than interest rate)"],
                correct: 0,
                explanation: "Debt must grow slower than interest rate: g = r(1-Î±) < r. This ensures the transversality condition is satisfied."
            },
            {
                week: 2,
                difficulty: "easy",
                topic: "Finite vs Infinite Horizon",
                question: "What is the key difference between finite and infinite horizon sustainability?",
                options: ["Finite: hard constraint (B<sub>t</sub>=0), Infinite: soft constraint (PVâ†’0)",
                    "Finite is easier in the economy",
                    "No difference under these conditions",
                    "Infinite requires balanced budgets"],
                correct: 0,
                explanation: "Finite horizon has hard constraint (must settle all debts), infinite has soft constraint (can 'grow out of debt' as long as PVâ†’0)."
            },
            {
                week: 2,
                difficulty: "easy",
                topic: "Accounting Identities",
                question: "The accounting identity B<sub>t</sub> = (1+r)B<sub>t</sub>â‚‹<sub>1</sub> + TB<sub>t</sub> shows:",
                options: ["How GDP grows over time in the economy",
                    "The inflation rate in the economy",
                    "How current NIIP relates to previous NIIP plus current trade balance",
                    "Government budget constraint in the economy"],
                correct: 2,
                explanation: "This identity shows NIIP evolves as: current NIIP = previous NIIP with interest plus current trade balance."
            },
            {
                week: 2,
                difficulty: "easy",
                topic: "Accounting Identities",
                question: "The relationship between Current Account and Trade Balance is:",
                options: ["They are unrelated in the economy",
                    "CA = TB + rB<sub>t</sub>â‚‹<sub>1</sub> (trade balance plus net investment income)",
                    "CA = TB Ã— 2 under these conditions",
                    "CA = TB (they are identical) in the economy"],
                correct: 1,
                explanation: "Current Account = Trade Balance + rB<sub>t</sub>â‚‹<sub>1</sub> (where rB<sub>t</sub>â‚‹<sub>1</sub> represents net investment income)."
            },
            {
                week: 2,
                difficulty: "easy",
                topic: "Perpetual Deficits",
                question: "In infinite horizon, a net debtor CANNOT run perpetual:",
                options: ["Both CA and TB deficits",
                    "Trade balance deficits",
                    "Current account deficits",
                    "Either CA or TB deficits"],
                correct: 1,
                explanation: "Even in infinite horizon, a net debtor CANNOT run perpetual TB deficits (must repay real resources at some point), but CAN run perpetual CA deficits."
            },
            {
                week: 2,
                difficulty: "easy",
                topic: "Debt Growth and Sustainability",
                question: "For sustainability with perpetual CA deficits, GDP growth must be:",
                options: ["Zero in the economy",
                    "< interest rate",
                    "â‰¥ r(1-Î±) to generate required TB surpluses",
                    "Negative in the economy"],
                correct: 2,
                explanation: "Critical condition: GDP must grow â‰¥ r(1-Î±) to generate the required TB surpluses for sustainability."
            },
            {
                week: 2,
                difficulty: "easy",
                topic: "Finite vs Infinite Horizon",
                question: "In a two-period model, the sustainability condition with B<sub>0</sub> < 0 (net debtor) is:",
                options: ["(1+r)B<sub>0</sub> = TB<sub>1</sub> + TB<sub>2</sub>",
                    "(1+r)B<sub>0</sub> = -TB<sub>1</sub> - TB<sub>2</sub>/(1+r)",
                    "B<sub>0</sub> = 0",
                    "B<sub>0</sub> = TB<sub>1</sub> + TB<sub>2</sub>"],
                correct: 1,
                explanation: "The sustainability condition is (1+r)B<sub>0</sub> = -TB<sub>1</sub> - TB<sub>2</sub>/(1+r), which shows present value of trade balances must offset initial debt."
            },

            // Week 3: Theory of Current Account - Easy (10 questions)
            {
                week: 3,
                difficulty: "easy",
                topic: "Small Open Economy Model",
                question: "In the small open economy model, what does 'small' mean?",
                options: ["World prices and interest rates are independent of domestic conditions",
                    "The country has a small population",
                    "GDP is low",
                    "The economy produces few goods in the economy"],
                correct: 0,
                explanation: "Small means world prices and interest rates are independent of domestic conditions - the country is a price taker."
            },
            {
                week: 3,
                difficulty: "easy",
                topic: "Small Open Economy Model",
                question: "Free capital mobility in the model implies:",
                options: ["No restrictions on trade in the economy",
                    "r<sub>1</sub> = r* (domestic interest rate equals world rate)",
                    "No taxes under these conditions",
                    "Fixed exchange rate in the economy"],
                correct: 1,
                explanation: "Free capital mobility implies interest rate parity: r<sub>1</sub> = r*."
            },
            {
                week: 3,
                difficulty: "easy",
                topic: "Euler Equation and Optimization",
                question: "The Euler equation in the model represents:",
                options: ["Optimal consumption choice: U'(C<sub>1</sub>) = (1+r<sub>1</sub>)Î²U'(C<sub>2</sub>)",
                    "Production function in the economy",
                    "Budget constraint in the economy",
                    "Trade balance identity in the economy"],
                correct: 0,
                explanation: "The Euler equation U'(C<sub>1</sub>) = (1+r<sub>1</sub>)Î²U'(C<sub>2</sub>) characterizes optimal intertemporal consumption choice."
            },
            {
                week: 3,
                difficulty: "easy",
                topic: "Temporary vs Permanent Shocks",
                question: "How does a TEMPORARY decline in Q<sub>1</sub> affect the current account?",
                options: ["No effect under these conditions",
                    "Small CA deterioration in the economy",
                    "Large CA improvement in the economy",
                    "Large CA deterioration (households borrow to smooth consumption)"],
                correct: 3,
                explanation: "Temporary shocks lead to large CA movements - households borrow to smooth consumption, causing CA to deteriorate significantly."
            },
            {
                week: 3,
                difficulty: "easy",
                topic: "Temporary vs Permanent Shocks",
                question: "How does a PERMANENT decline in output (Q<sub>1</sub> and Q<sub>2</sub>) affect consumption?",
                options: ["Only C<sub>2</sub> changes under these conditions",
                    "Both C<sub>1</sub> and C<sub>2</sub> adjust proportionally, little change in trade balance",
                    "C<sub>1</sub> falls by less than the output decline",
                    "No change in consumption under these conditions"],
                correct: 1,
                explanation: "With permanent shocks, economies adjust consumption in both periods. The trade balance changes little because households cannot smooth a permanent shock."
            },
            {
                week: 3,
                difficulty: "easy",
                topic: "Temporary vs Permanent Shocks",
                question: "The general principle comparing temporary vs permanent shocks is:",
                options: ["Economies ignore temporary shocks in the economy",
                    "Both have identical effects in the economy",
                    "Only permanent shocks matter in the economy",
                    "Economies finance temporary shocks (borrow/lend) and adjust to permanent ones"],
                correct: 3,
                explanation: "Economies tend to FINANCE temporary shocks through international borrowing/lending and ADJUST to permanent shocks by changing consumption."
            },
            {
                week: 3,
                difficulty: "easy",
                topic: "Anticipated Income Shocks",
                question: "If households learn in period 1 that Q<sub>2</sub> will be higher (anticipated income shock), what happens to CA<sub>1</sub>?",
                options: ["CA<sub>1</sub> becomes zero in the economy",
                    "No change in CA<sub>1</sub> in the economy",
                    "CA<sub>1</sub> improves in the economy",
                    "CA<sub>1</sub> deteriorates (households borrow against future income)"],
                correct: 3,
                explanation: "Good news about future income causes CA to deteriorate - households increase C<sub>1</sub> by borrowing, even though Q<sub>1</sub> is unchanged."
            },
            {
                week: 3,
                difficulty: "easy",
                topic: "Budget Constraint",
                question: "The intertemporal budget constraint in the two-period model is:",
                options: ["C<sub>1</sub> + C<sub>2</sub>/(1+r<sub>1</sub>) = (1+r<sub>0</sub>)B<sub>0</sub> + Q<sub>1</sub> + Q<sub>2</sub>/(1+r<sub>1</sub>)",
                    "C<sub>1</sub> + C<sub>2</sub> = Q<sub>1</sub> + Q<sub>2</sub> in the economy",
                    "C<sub>1</sub> + C<sub>2</sub> = 2Q<sub>1</sub>",
                    "C<sub>1</sub> = Q<sub>1</sub> and C<sub>2</sub> = Q<sub>2</sub> in the economy"],
                correct: 0,
                explanation: "The intertemporal budget constraint: C<sub>1</sub> + C<sub>2</sub>/(1+r<sub>1</sub>) = (1+r<sub>0</sub>)B<sub>0</sub> + Q<sub>1</sub> + Q<sub>2</sub>/(1+r<sub>1</sub>) - present value of consumption equals present value of resources."
            },
            {
                week: 3,
                difficulty: "easy",
                topic: "Budget Constraint",
                question: "Trade balance in period 1 is defined as:",
                options: ["TB<sub>1</sub> = Q<sub>1</sub> - C<sub>1</sub>",
                    "TB<sub>1</sub> = Q<sub>1</sub> + C<sub>1</sub>",
                    "TB<sub>1</sub> = C<sub>1</sub> - Q<sub>1</sub>",
                    "TB<sub>1</sub> = (Q<sub>1</sub> - C<sub>1</sub>) Ã— r"],
                correct: 0,
                explanation: "Trade Balance: TB<sub>1</sub> = Q<sub>1</sub> - C<sub>1</sub> (output minus consumption)."
            },
            {
                week: 3,
                difficulty: "easy",
                topic: "Consumption Smoothing",
                question: "What does consumption smoothing mean?",
                options: ["Consumption always equals income in the economy",
                    "Consuming the same goods every period in the economy",
                    "Households prefer stable consumption over time using international borrowing/lending",
                    "Avoiding imported goods under these conditions"],
                correct: 2,
                explanation: "Consumption smoothing: households prefer stable consumption over time (due to concave utility) and use international borrowing/lending to achieve this."
            },

            // Week 4: Terms of Trade - Easy (10 questions)
            {
                week: 4,
                difficulty: "easy",
                topic: "Terms of Trade",
                question: "The terms of trade (TT) is defined as:",
                options: ["TT = Trade Balance / GDP in the economy",
                    "TT = Imports / Exports in the economy",
                    "TT = Price of Exports / Price of Imports",
                    "TT = Current Account / Financial Account"],
                correct: 2,
                explanation: "Terms of trade (TT) = P^X / P^M, the relative price of exports in terms of imports."
            },
            {
                week: 4,
                difficulty: "easy",
                topic: "Terms of Trade",
                question: "A temporary improvement in terms of trade (TT<sub>1</sub> â†‘) affects the current account by:",
                options: ["CA<sub>1</sub> deteriorates",
                    "CA<sub>1</sub> improves as country saves windfall",
                    "CA<sub>1</sub> becomes zero",
                    "No effect on CA in the economy"],
                correct: 1,
                explanation: "Temporary TT improvement: country saves windfall to smooth consumption â†’ CA<sub>1</sub> improves."
            },
            {
                week: 4,
                difficulty: "easy",
                topic: "Terms of Trade",
                question: "A permanent improvement in terms of trade (TT<sub>1</sub> and TT<sub>2</sub> both â†‘) has what effect on CA?",
                options: ["Large CA improvement in the economy",
                    "Little change in CA (consumption rises in both periods)",
                    "CA<sub>1</sub> doubles in the economy",
                    "Large CA deterioration in the economy"],
                correct: 1,
                explanation: "Permanent TT improvement: consumption increases in both periods proportionally â†’ little CA change. Same principle as endowment shocks."
            },
            {
                week: 4,
                difficulty: "easy",
                topic: "World Interest Rate Shocks",
                question: "An increase in world interest rate r* has two effects. What are they?",
                options: ["Supply effect and demand effect",
                    "Substitution effect and income effect",
                    "Inflation effect and deflation effect",
                    "Export effect and import effect"],
                correct: 1,
                explanation: "r* â†‘ creates: (1) Substitution effect: bonds more attractive â†’ save more. (2) Income effect: depends on borrower/lender position."
            },
            {
                week: 4,
                difficulty: "easy",
                topic: "World Interest Rate Shocks",
                question: "For a net borrower (B<sub>0</sub> < 0), an increase in r* causes:",
                options: ["Only substitution effect matters in the economy",
                    "No effect on CA under these conditions",
                    "Income and substitution effects oppose",
                    "Income and substitution effects reinforce â†’ CA<sub>1</sub> improves"],
                correct: 3,
                explanation: "Net borrower: both effects reduce C<sub>1</sub> (substitution: save more; income: poorer) â†’ CA<sub>1</sub> improves."
            },
            {
                week: 4,
                difficulty: "easy",
                topic: "World Interest Rate Shocks",
                question: "For a net lender (B<sub>0</sub> > 0), which effect typically dominates when r* increases?",
                options: ["Substitution effect (save more â†’ standard assumption)",
                    "Neither effect applies in the economy",
                    "Both cancel exactly in the economy",
                    "Income effect (richer â†’ consume more)"],
                correct: 0,
                explanation: "For lenders: effects oppose, but substitution effect typically dominates under standard preferencesâ€”savings increase with interest rate."
            },
            {
                week: 4,
                difficulty: "easy",
                topic: "Import Tariffs",
                question: "The modified Euler equation with tariffs is:",
                options: ["U'(C<sub>1</sub>) = Î²(1+r)U'(C<sub>2</sub>) in the economy",
                    "U'(C<sub>1</sub>) = U'(C<sub>2</sub>) in the economy",
                    "U'(C<sub>1</sub>) = [(1+Ï„<sub>1</sub>)/(1+Ï„<sub>2</sub>)]Î²(1+r)U'(C<sub>2</sub>)",
                    "U'(C<sub>1</sub>) = Ï„<sub>1</sub>U'(C<sub>2</sub>)"],
                correct: 2,
                explanation: "With tariffs, the Euler equation becomes: U'(C<sub>1</sub>) = [(1+Ï„<sub>1</sub>)/(1+Ï„<sub>2</sub>)]Î²(1+r)U'(C<sub>2</sub>), where Ï„ represents import tariffs."
            },
            {
                week: 4,
                difficulty: "easy",
                topic: "Import Tariffs",
                question: "A temporary tariff (Ï„<sub>1</sub> > 0, Ï„<sub>2</sub> = 0) affects consumption by:",
                options: ["Making current consumption relatively expensive â†’ C<sub>1</sub> â†“, CA<sub>1</sub> â†‘",
                    "No effect on consumption under these conditions",
                    "Doubling current consumption in the economy",
                    "Making current consumption cheaper â†’ C<sub>1</sub> â†‘"],
                correct: 0,
                explanation: "Temporary tariff: (1+Ï„<sub>1</sub>)/(1+Ï„<sub>2</sub>) > 1 makes current consumption expensive â†’ households postpone consumption â†’ CA<sub>1</sub> improves."
            },
            {
                week: 4,
                difficulty: "easy",
                topic: "Import Tariffs",
                question: "A permanent tariff (Ï„<sub>1</sub> = Ï„<sub>2</sub> > 0) has what effect on the current account?",
                options: ["No effect on CA (ratio (1+Ï„<sub>1</sub>)/(1+Ï„<sub>2</sub>) = 1)",
                    "CA doubles in the economy",
                    "Large CA improvement in the economy",
                    "Large CA deterioration in the economy"],
                correct: 0,
                explanation: "Permanent tariff: (1+Ï„<sub>1</sub>)/(1+Ï„<sub>2</sub>) = 1 in Euler equation â†’ no intertemporal distortion â†’ no CA effect."
            },
            {
                week: 4,
                difficulty: "easy",
                topic: "Import Tariffs",
                question: "Why do permanent tariffs not affect the CA in this model?",
                options: ["The model ignores tariffs in the economy",
                    "Tariff revenues are rebated lump-sum, and no intertemporal substitution is created",
                    "CA is always zero under these conditions",
                    "Tariffs don't affect trade in the economy"],
                correct: 1,
                explanation: "Tariff revenues are rebated (L_t = Ï„_t C_t), so economy-wide resources unchanged. Permanent tariffs don't create intertemporal distortion â†’ no CA effect."
            },

            // Week 5: Production Economy - Easy (10 questions)
            {
                week: 5,
                difficulty: "easy",
                topic: "Production Economy",
                question: "In the production economy, output is determined by:",
                options: ["Q_t = C_t (consumption) in the economy",
                    "Q_t = exports - imports in the economy",
                    "Q_t = A_t F(I_{t-1}), where I is investment and A is productivity",
                    "Q_t = exogenous endowment in the economy"],
                correct: 2,
                explanation: "Production economy: Q_t = A_t F(I_{t-1}). Output depends on investment I_{t-1} and productivity A_t."
            },
            {
                week: 5,
                difficulty: "easy",
                topic: "Production Economy",
                question: "The marginal product of capital (MPK) is:",
                options: ["MPK = A_t F'(I_{t-1})",
                    "MPK = F(I) in the economy",
                    "MPK = 1 + r",
                    "MPK = I / Q"],
                correct: 0,
                explanation: "MPK = A_t F'(I_{t-1}), the additional output from one more unit of investment."
            },
            {
                week: 5,
                difficulty: "easy",
                topic: "Production Economy",
                question: "The firm's profit maximization condition is:",
                options: ["I<sub>1</sub> = S<sub>1</sub>",
                    "A<sub>2</sub>F'(I<sub>1</sub>) = 1 + r<sub>1</sub> (MPK equals opportunity cost)",
                    "MPK = 0",
                    "Q = C"],
                correct: 1,
                explanation: "Firms invest until A<sub>2</sub>F'(I<sub>1</sub>) = 1 + r<sub>1</sub>: marginal benefit (MPK) equals marginal cost (opportunity cost of funds)."
            },
            {
                week: 5,
                difficulty: "easy",
                topic: "Investment Schedule",
                question: "The investment schedule I_1 = I(r_1^-, A_2^+) shows:",
                options: ["Investment increases with r_1 in the economy",
                    "Investment is constant in the economy",
                    "Investment equals savings in the economy",
                    "Investment decreases with r_1 (higher cost) and increases with A_2 (higher MPK)"],
                correct: 3,
                explanation: "âˆ‚I/âˆ‚r_1 < 0 (higher interest rate â†’ higher cost â†’ less investment). âˆ‚I/âˆ‚A_2 > 0 (higher productivity â†’ higher MPK â†’ more investment)."
            },
            {
                week: 5,
                difficulty: "easy",
                topic: "Saving Schedule",
                question: "The saving schedule S<sub>1</sub> = S(r<sub>1</sub>âº, A<sub>1</sub>âº, A<sub>2</sub>â») indicates:",
                options: ["Saving only depends on r<sub>1</sub> in the economy",
                    "Saving increases with r<sub>1</sub> and current productivity A<sub>1</sub>, decreases with future productivity A<sub>2</sub>",
                    "Saving is constant",
                    "Saving equals investment"],
                correct: 1,
                explanation: "âˆ‚S/âˆ‚r<sub>1</sub> > 0 (save more when return is higher). âˆ‚S/âˆ‚A<sub>1</sub> > 0 (temporary income boost â†’ save). âˆ‚S/âˆ‚A<sub>2</sub> < 0 (good news â†’ borrow)."
            },
            {
                week: 5,
                difficulty: "easy",
                topic: "Current Account Schedule",
                question: "The current account is defined as:",
                options: ["CA<sub>1</sub> = C<sub>1</sub> in the economy",
                    "CA<sub>1</sub> = I<sub>1</sub> - S<sub>1</sub>",
                    "CA<sub>1</sub> = S<sub>1</sub> - I<sub>1</sub> (saving minus investment)",
                    "CA<sub>1</sub> = Q<sub>1</sub> in the economy"],
                correct: 2,
                explanation: "In production economy: CA<sub>1</sub> = S<sub>1</sub> - I<sub>1</sub>. The current account equals saving minus investment."
            },
            {
                week: 5,
                difficulty: "easy",
                topic: "Current Account Schedule",
                question: "A positive productivity shock in period 2 (A<sub>2</sub> â†‘) affects CA<sub>1</sub> by:",
                options: ["CA<sub>1</sub> improves in the economy",
                    "CA<sub>1</sub> doubles in the economy",
                    "No effect on CA<sub>1</sub> in the economy",
                    "CA<sub>1</sub> deteriorates (I<sub>1</sub> â†‘ and S<sub>1</sub> â†“)"],
                correct: 3,
                explanation: "A<sub>2</sub> â†‘: firms invest more (I<sub>1</sub> â†‘) and households borrow against future income (S<sub>1</sub> â†“) â†’ CA<sub>1</sub> = S<sub>1</sub> - I<sub>1</sub> deteriorates."
            },
            {
                week: 5,
                difficulty: "easy",
                topic: "Metzler Diagram",
                question: "In the Metzler diagram, the investment schedule I(r<sub>1</sub>) slopes:",
                options: ["Upward (higher r<sub>1</sub> â†’ more investment)",
                    "Horizontal in the economy",
                    "Downward (higher r<sub>1</sub> â†’ less investment)",
                    "Vertical under these conditions"],
                correct: 2,
                explanation: "Investment schedule slopes downward: higher interest rates increase opportunity cost â†’ less investment."
            },
            {
                week: 5,
                difficulty: "easy",
                topic: "Metzler Diagram",
                question: "In the Metzler diagram, the saving schedule S(r<sub>1</sub>) slopes:",
                options: ["Vertical in the economy",
                    "Upward (higher r<sub>1</sub> â†’ save more)",
                    "Downward in the economy",
                    "Horizontal in the economy"],
                correct: 1,
                explanation: "Saving schedule slopes upward: higher interest rates make saving more attractive (substitution effect dominates)."
            },
            {
                week: 5,
                difficulty: "easy",
                topic: "Giant Oil Discoveries",
                question: "The giant oil discoveries application shows that large future productivity shocks lead to:",
                options: ["No CA effect in the economy",
                    "Balanced trade in the economy",
                    "CA improvement in the economy",
                    "CA deterioration (heavy investment + borrowing against future oil)"],
                correct: 3,
                explanation: "Oil discoveries (A<sub>2</sub> â†‘): countries invest in infrastructure (I<sub>1</sub> â†‘) and borrow against future revenue (S<sub>1</sub> â†“) â†’ CA<sub>1</sub> deteriorates."
            },

            // HARD QUESTIONS START HERE            // Week 1: Global Imbalances (15 challenging questions)
            {
                week: 1,
                difficulty: "hard",
                topic: "Balance of Payments Components",
                question: "Consider a country with TB = -50, Net Investment Income = 30, Net Compensation to Employees = -5, and Net Unilateral Transfers = 10. What is the Current Account balance?",
                options: ["CA = -15 (TB + NII + NCE + NUT = -50 + 30 - 5 + 10)",
                    "CA = -35 (the trade deficit partially offsets the investment income surplus)",
                    "CA = 15 (net investment income dominates the calculation)",
                    "CA = -25 (only TB and NII are included in CA) in the economy"],
                correct: 0,
                explanation: "CA = TB + Net Investment Income + Net Compensation to Employees + Net Unilateral Transfers = -50 + 30 - 5 + 10 = -15. All four components must be included."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "Balance of Payments Components",
                question: "If a country's Financial Account shows +$200 billion (capital inflows), the BoP identity implies:",
                options: ["Capital Account must be -$200 billion to offset the Financial Account",
                    "Trade Balance must equal +$200 billion exactly in the economy",
                    "Current Account must be +$200 billion (they move together)",
                    "Current Account must be approximately -$200 billion (BoP â‰ˆ 0)"],
                correct: 3,
                explanation: "By the BoP identity: CA + Financial Account + Capital Account â‰ˆ 0. Large capital inflows (+$200B FA) typically reflect financing of a CA deficit (approximately -$200B CA)."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "NIIP and Valuation",
                question: "A country has NIIP<sub>0</sub> = -$500B. Over one year, it runs CA = -$100B, but NIIP<sub>1</sub> = -$550B (not -$600B). What explains the $50B discrepancy?",
                options: ["+$50B positive valuation effect (e.g., domestic currency depreciation increased value of foreign assets)",
                    "-$50B negative valuation effect (e.g., foreign liabilities appreciated more than assets)",
                    "The Financial Account must have been incorrectly recorded in the economy",
                    "Measurement error in the current account statistics under these conditions"],
                correct: 0,
                explanation: "NIIP<sub>1</sub> = NIIP<sub>0</sub> + CA + Valuation Changes. Expected: -500 - 100 = -600, but actual is -550. The +$50B difference comes from positive valuation effects (e.g., FX movements, asset price changes)."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "NIIP and Valuation",
                question: "During a period of domestic currency depreciation, which valuation effect is most likely for a country whose foreign assets are denominated in foreign currency and foreign liabilities in domestic currency?",
                options: ["Positive valuation effect: foreign assets rise in domestic currency value while liabilities remain stable",
                    "Ambiguous effect: depends entirely on the magnitude of the trade balance",
                    "Neutral effect: currency movements don't affect NIIP under these conditions",
                    "Negative valuation effect: both assets and liabilities increase proportionally"],
                correct: 0,
                explanation: "Currency depreciation causes foreign-currency-denominated assets to rise in domestic currency value, while domestic-currency liabilities remain constantâ€”creating positive valuation effects that improve NIIP."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "Global Creditors and Debtors",
                question: "How can the US maintain a large negative NIIP (-$18 trillion, 2023) but still receive positive Net Investment Income?",
                options: ["This is impossibleâ€”negative NIIP must imply negative NII in the economy",
                    "Both B and C contribute to explaining the NIIP-NII paradox in the economy",
                    "Dark Matter: unmeasured intangible assets generate hidden income streams",
                    "Return Differential: US foreign assets (equity, FDI) earn higher returns than US liabilities (bonds)"],
                correct: 1,
                explanation: "Both hypotheses explain the paradox: (1) Return Differentialâ€”US invests abroad in high-return equity/FDI while foreigners hold low-return US Treasuries; (2) Dark Matterâ€”unmeasured intangibles (brands, know-how) generate income."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "NIIP and Valuation",
                question: "Between 2002-2007, the US ran cumulative CA deficits of $3.9 trillion, yet NIIP improved by $80 billion. If valuation effects were +$4 trillion, what is the approximate breakdown?",
                options: ["NIIP change = Valuation only: CA deficits don't affect NIIP",
                    "NIIP change = CA only: the $4T valuation is separate",
                    "NIIP change = CA + Valuation: +$80B = -$3.9T + $4T",
                    "The numbers are inconsistent and indicate measurement error"],
                correct: 2,
                explanation: "Î”NIIP = CA + Valuation. Here: +$80B = -$3,900B + $4,000B. The massive positive valuation effects (+$4T) more than offset the CA deficits (-$3.9T), improving NIIP."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "Dark Matter and Return Differential",
                question: "The Return Differential hypothesis suggests the US benefits from 'exorbitant privilege.' Which statement best characterizes this privilege?",
                options: ["The US can print unlimited currency without inflationary consequences in the economy",
                    "The US borrows cheaply (safe Treasury bonds at low rates) and invests abroad in high-return risky assets (equity, FDI)",
                    "Foreign countries are legally required to hold US assets regardless of returns",
                    "The US pays no interest on its foreign liabilities"],
                correct: 1,
                explanation: "Exorbitant privilege: US borrows globally at low rates (safe haven statusâ€”foreigners hold Treasuries) while investing abroad in high-return assets (stocks, FDI), earning positive return differential despite negative NIIP."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "Dark Matter and Return Differential",
                question: "Hausmann and Sturzenegger's 'Dark Matter' hypothesis posits that US NIIP is mismeasured. Which of these is the strongest criticism of this hypothesis?",
                options: ["The hypothesis has been definitively proven false by empirical data",
                    "Return differentials can explain the NIIP-NII paradox without assuming hidden assets",
                    "Intangible assets (brands, know-how) are impossible to value precisely",
                    "Dark matter violates international accounting standards in the economy"],
                correct: 1,
                explanation: "The main criticism is that return differentials (observable differences in asset returns) can explain the paradox without invoking unmeasured intangibles. Dark matter is hard to verify empirically; return differentials are measurable."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "Balance of Payments Components",
                question: "A country has Net Investment Income = +50 but NIIP = -1000 (net debtor). Which scenario best explains this?",
                options: ["Rate of return earned on foreign assets exceeds rate paid on foreign liabilities despite negative NIIP",
                    "Impossible: net debtors must have negative investment income in the economy",
                    "Current account surplus is so large it dominates the calculation",
                    "The country has defaulted on its foreign debt obligations in the economy"],
                correct: 0,
                explanation: "NII = (return on assets Ã— assets) - (return on liabilities Ã— liabilities). Even with negative NIIP, if return on assets >> return on liabilities, NII can be positive (the NIIP-NII paradox)."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "NIIP and Valuation",
                question: "Suppose Country A's foreign assets are primarily equity holdings, and foreign liabilities are primarily bonds. A global stock market boom would most likely:",
                options: ["Improve NIIP as foreign equity assets appreciate while bond liabilities remain stable",
                    "Deteriorate NIIP as both assets and liabilities rise equally in the economy",
                    "Improve NIIP only if the country simultaneously runs a current account surplus",
                    "Have no effect on NIIP since market values don't matter for BoP accounting"],
                correct: 0,
                explanation: "Stock market boom increases value of equity assets while bond liabilities remain stable (bonds are fixed-income), creating positive valuation effects that improve NIIP. This is independent of current CA position."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "Global Creditors and Debtors",
                question: "Japan, China, and Germany are major net creditors with NIIP > 0. Which of the following is the most accurate implication?",
                options: ["These countries cannot experience valuation losses on their foreign assets",
                    "These countries have no foreign liabilities in the economy",
                    "These countries likely earn positive Net Investment Income, reinforcing CA surpluses",
                    "These countries must always run current account surpluses in the economy"],
                correct: 2,
                explanation: "Positive NIIP (net creditors) typically generates positive NII (investment income on net foreign assets), which reinforces CA surpluses. However, they can run CA deficits in some periods, and valuation losses are possible."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "Balance of Payments Components",
                question: "The Income Balance includes Net Investment Income (NII) and Net Compensation to Employees (NCE). If NII = +100 and NCE = -20, what does this indicate?",
                options: ["The country's workers abroad send home more than foreign workers in the country",
                    "The country's foreign investment returns (+100) exceed compensation paid to foreign workers domestically (-20), netting +80",
                    "The country earns net +80 from both capital income and labour income combined",
                    "The trade balance must be positive to offset the negative NCE in the economy"],
                correct: 1,
                explanation: "Income Balance = NII + NCE = 100 - 20 = +80. NII > 0 means returns on foreign assets exceed payments on liabilities; NCE < 0 means compensation paid to foreign workers domestically exceeds compensation to domestic workers abroad."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "NIIP and Valuation",
                question: "Which of the following events would cause valuation changes to NIIP without affecting the current account?",
                options: ["A domestic stock market crash that reduces the value of foreigners' equity holdings in the country",
                    "A reduction in government spending on imports in the economy",
                    "An increase in Net Investment Income due to higher interest rates abroad",
                    "An increase in exports due to higher global demand in the economy"],
                correct: 0,
                explanation: "Stock market crash affecting foreign-held domestic equity creates valuation changes (reduces foreign liabilities â†’ improves NIIP) without affecting CA. Options A, C, D all affect CA directly through trade or income flows."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "Dark Matter and Return Differential",
                question: "A refined version of the Dark Matter hypothesis would suggest that if US intangible assets (brands, technology, know-how) were properly measured and capitalized, the US NIIP would be:",
                options: ["Less negative or possibly positive (hidden assets reduce net liability position)",
                    "Unchanged (intangibles don't appear in NIIP calculations)",
                    "Exactly zero (intangibles perfectly offset measured liabilities)",
                    "Even more negative (larger debtor position) in the economy"],
                correct: 0,
                explanation: "Dark Matter posits unmeasured intangible assets (brands like Coca-Cola, tech like Microsoft, managerial know-how) that generate income. Capitalizing these would add to US foreign assets, improving (making less negative or positive) NIIP."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "Global Creditors and Debtors",
                question: "Consider two countries: Country X (NIIP = +500, NII = +30) and Country Y (NIIP = -500, NII = -10). The return differential (rate of return gap) is larger for:",
                options: ["Country X: earning 6% average return on net assets in the economy",
                    "Country Y: paying only 2% average on net liabilities (expected would be higher)",
                    "Cannot determine without knowing the composition of assets and liabilities",
                    "Both countries exhibit similar return profiles in the economy"],
                correct: 1,
                explanation: "Country X: 30/500 = 6% (normal return). Country Y: 10/500 = 2% payment rate on net liabilitiesâ€”surprisingly low for a debtor. This suggests Y has a favorable return differential (paying less than expected), similar to US 'exorbitant privilege'."
            },

            // Week 2: Sustainability (15 challenging questions)
            {
                week: 2,
                difficulty: "hard",
                topic: "Finite vs Infinite Horizon",
                question: "In a two-period model with B<sub>0</sub> = -200, r = 0.05, if TB<sub>1</sub> = -10, what TB<sub>2</sub> is required to satisfy the terminal condition B<sub>2</sub> = 0?",
                options: ["TB<sub>2</sub> = 200 (only repay principal)",
                    "TB<sub>2</sub> = 210 (simply repay the initial debt) in the economy",
                    "TB<sub>2</sub> = 220.5 (must cover accumulated debt: (1+r)(B<sub>0</sub>(1+r) + TB<sub>1</sub>) = (1.05)(-210 - 10) = -220.5)",
                    "TB<sub>2</sub> = 231 (account for compounding on both periods) in the economy"],
                correct: 2,
                explanation: "B<sub>1</sub> = (1+r)B<sub>0</sub> + TB<sub>1</sub> = 1.05(-200) + (-10) = -220. Then B<sub>2</sub> = (1+r)B<sub>1</sub> + TB<sub>2</sub> = 0 implies TB<sub>2</sub> = -1.05(-220) = 231. But using the PV formula: (1+r)B<sub>0</sub> = -TB<sub>1</sub> - TB<sub>2</sub>/(1+r) â†’ 1.05(-200) = -(-10) - TB<sub>2</sub>/1.05 â†’ TB<sub>2</sub> = 220.5."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Transversality Condition",
                question: "The transversality condition states lim(Tâ†’âˆž) B<sub>t</sub>/(1+r)áµ€ = 0. Which debt path satisfies this for r = 0.05?",
                options: ["B<sub>t</sub> = -100(1.07)áµ— (debt grows faster than r at 7%)",
                    "B<sub>t</sub> = -100(1.05)áµ— (debt grows at rate r)",
                    "B<sub>t</sub> = -100(1.03)áµ— (debt grows slower than r at 3%)",
                    "B<sub>t</sub> = -100 for all t (constant debt) in the economy"],
                correct: 2,
                explanation: "For transversality: lim B<sub>t</sub>/(1+r)áµ€ = 0. (A) lim -100(1.05)áµ—/(1.05)áµ— = -100 â‰  0. (B) lim -100(1.03)áµ—/(1.05)áµ— = 0 since 1.03 < 1.05. (C) grows too fast. (D) lim -100/(1.05)áµ— = 0 also works, but B is the debt-growth scenario."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Perpetual Deficits",
                question: "A country with B<sub>0</sub> = -1000 and r = 0.04 follows the policy TB<sub>t</sub> = -Î±rB<sub>t</sub>â‚‹<sub>1</sub> with Î± = 0.5. What is TB<sub>1</sub> and the resulting CA<sub>1</sub>?",
                options: ["TB<sub>1</sub> = -20, CA<sub>1</sub> = +20 (trade deficit dominates)",
                    "TB<sub>1</sub> = +20, CA<sub>1</sub> = +20 (both in surplus) in the economy",
                    "TB<sub>1</sub> = +20, CA<sub>1</sub> = -20 (must run trade surplus, but CA still in deficit)",
                    "TB<sub>1</sub> = -20, CA<sub>1</sub> = -60 (trade deficit plus interest payments)"],
                correct: 2,
                explanation: "TB<sub>1</sub> = -Î±rB<sub>0</sub> = -0.5(0.04)(-1000) = +20 (trade surplus pays half the interest). CA<sub>1</sub> = TB<sub>1</sub> + rB<sub>0</sub> = 20 + 0.04(-1000) = 20 - 40 = -20 (CA deficit as only half interest is paid via TB)."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Debt Growth and Sustainability",
                question: "Following the debt-servicing policy TB<sub>t</sub> = -Î±rB<sub>t</sub>â‚‹<sub>1</sub> with Î± = 0.6 and r = 0.05, at what rate does debt grow?",
                options: ["g = 0.05 (same as interest rate) in the economy",
                    "g = 0.02 (g = r(1-Î±) = 0.05(0.4) = 0.02)",
                    "g = 0.08 (compounds both r and Î±) in the economy",
                    "g = 0.03 (explicitly r(1-Î±) = 0.05(1-0.6) = 0.02)"],
                correct: 1,
                explanation: "Under debt-servicing policy, debt grows at g = r(1-Î±). Here: g = 0.05(1 - 0.6) = 0.05(0.4) = 0.02 or 2%. This is slower than r, ensuring transversality is satisfied."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Finite vs Infinite Horizon",
                question: "Compare finite vs infinite horizon for a net debtor (B<sub>0</sub> < 0). Which statement is correct?",
                options: ["Finite: must eventually run TB surpluses to reach B_T=0; Infinite: can run perpetual CA deficits if g < r",
                    "Both allow perpetual TB deficits as long as GDP grows in the economy",
                    "Infinite is stricter because it requires immediate debt repayment",
                    "Both require TB surpluses in every period under these conditions"],
                correct: 0,
                explanation: "Finite horizon (B_T = 0) requires actual repayment via TB surpluses eventually. Infinite horizon allows perpetual CA deficits (but not TB deficits) if debt grows slower than interest rate (transversality: g < r)."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Accounting Identities",
                question: "Given B<sub>0</sub> = -500, r = 0.06, TB<sub>1</sub> = +15, calculate B<sub>1</sub> using B<sub>t</sub> = (1+r)B<sub>t</sub>â‚‹<sub>1</sub> + TB<sub>t</sub>:",
                options: ["B<sub>1</sub> = -470 (incorrectly add interest) in the economy",
                    "B<sub>1</sub> = -530 (lose track of interest compounding)",
                    "B<sub>1</sub> = -515 (simple addition: -500 + 15) in the economy",
                    "B<sub>1</sub> = -515 (B<sub>1</sub> = 1.06(-500) + 15 = -530 + 15 = -515)"],
                correct: 3,
                explanation: "B<sub>1</sub> = (1+r)B<sub>0</sub> + TB<sub>1</sub> = 1.06(-500) + 15 = -530 + 15 = -515. The debt accumulates interest, then trade surplus partially offsets it."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Accounting Identities",
                question: "If CA<sub>1</sub> = -50 and B<sub>0</sub> = -300 with r = 0.05, what is TB<sub>1</sub>? Use CA<sub>1</sub> = TB<sub>1</sub> + rB<sub>0</sub>:",
                options: ["TB<sub>1</sub> = -35 (CA<sub>1</sub> = TB<sub>1</sub> + rB<sub>0</sub> â†’ -50 = TB<sub>1</sub> + 0.05(-300) â†’ TB<sub>1</sub> = -50 + 15 = -35)",
                    "TB<sub>1</sub> = -65 (CA<sub>1</sub> = TB<sub>1</sub> - rB<sub>0</sub> â†’ TB<sub>1</sub> = -50 - 15)",
                    "TB<sub>1</sub> = -50 (CA and TB are the same)",
                    "TB<sub>1</sub> = -15 (only interest component)"],
                correct: 0,
                explanation: "CA<sub>1</sub> = TB<sub>1</sub> + rB<sub>0</sub>. Given CA<sub>1</sub> = -50, B<sub>0</sub> = -300, r = 0.05: -50 = TB<sub>1</sub> + 0.05(-300) â†’ -50 = TB<sub>1</sub> - 15 â†’ TB<sub>1</sub> = -35. Net investment income = rB<sub>0</sub> = -15 worsens the CA relative to TB."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Perpetual Deficits",
                question: "In infinite horizon, which combination is possible for a net debtor under a sustainable debt-servicing policy?",
                options: ["Perpetual CA deficits + Perpetual TB deficits (both can be sustained indefinitely)",
                    "Neither CA nor TB deficits are sustainable for a net debtor in the economy",
                    "Perpetual CA surpluses + Perpetual TB deficits (interest income dominates trade)",
                    "Perpetual CA deficits + Perpetual TB surpluses (CA deficit as only partial interest paid via TB surplus)"],
                correct: 3,
                explanation: "Net debtor with TB<sub>t</sub> = -Î±rB<sub>t</sub>â‚‹<sub>1</sub> (Î± âˆˆ (0,1)): TB > 0 (surplus pays fraction of interest), but CA = TB + rB < 0 (deficit as only partial interest paid). Perpetual TB deficits violate resource constraints."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Debt Growth and Sustainability",
                question: "A country maintains Î± = 0.4 (pays 40% of interest via trade surplus), r = 0.05, and GDP grows at 3% annually. Is this sustainable in infinite horizon?",
                options: ["No, because GDP growth (3%) = debt growth (3%), creating instability",
                    "Yes, because GDP growth (3%) â‰¥ debt growth (3%), maintaining debt-to-GDP ratio stability",
                    "Yes, because GDP growth (3%) > debt growth g = r(1-Î±) = 0.05(0.6) = 3%",
                    "No, because GDP growth must exceed r, not just g in the economy"],
                correct: 1,
                explanation: "Debt grows at g = r(1-Î±) = 0.05(0.6) = 0.03 = 3%. GDP also grows at 3%. Since GDP growth â‰¥ debt growth, debt-to-GDP ratio is stable/declining. This satisfies sustainability (transversality + economic feasibility)."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Finite vs Infinite Horizon",
                question: "In a two-period model (T=2), the present value sustainability condition is (1+r)B<sub>0</sub> = -TB<sub>1</sub> - TB<sub>2</sub>/(1+r). If B<sub>0</sub> = -100, r = 0.1, TB<sub>1</sub> = 20, what TB<sub>2</sub> is required?",
                options: ["TB<sub>2</sub> = 99 (from rearranging: TB<sub>2</sub> = 1.1[20 + 1.1(-100)] = 1.1[20 - 110] = 1.1(-90) magnitude error) in the economy",
                    "TB<sub>2</sub> = 90 (PV calculation: 1.1(-100) = -20 - TB<sub>2</sub>/1.1 â†’ -110 = -20 - TB<sub>2</sub>/1.1 â†’ TB<sub>2</sub>/1.1 = 90 â†’ TB<sub>2</sub> = 99)",
                    "TB<sub>2</sub> = 99 (correctly: (1+r)B<sub>0</sub> = -TB<sub>1</sub> - TB<sub>2</sub>/(1+r) â†’ 1.1(-100) = -20 - TB<sub>2</sub>/1.1 â†’ -110 + 20 = -TB<sub>2</sub>/1.1 â†’ -90 = -TB<sub>2</sub>/1.1 â†’ TB<sub>2</sub> = 99)",
                    "TB<sub>2</sub> = 80 (simple arithmetic: 100 - 20)"],
                correct: 2,
                explanation: "(1+r)B<sub>0</sub> = -TB<sub>1</sub> - TB<sub>2</sub>/(1+r). Substituting: 1.1(-100) = -20 - TB<sub>2</sub>/1.1 â†’ -110 = -20 - TB<sub>2</sub>/1.1 â†’ -90 = -TB<sub>2</sub>/1.1 â†’ TB<sub>2</sub> = 99. Need a large period-2 surplus to satisfy terminal condition."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Transversality Condition",
                question: "Which economic interpretation best describes why the transversality condition lim B<sub>t</sub>/(1+r)áµ— = 0 is called the 'No-Ponzi-Game' condition?",
                options: ["It requires debt to be exactly zero in finite time in the economy",
                    "It prevents governments from running any deficits in the economy",
                    "It prevents perpetual 'rolling over' of debt without ever repaying in present value terms",
                    "It mandates balanced budgets in every period in the economy"],
                correct: 2,
                explanation: "The No-Ponzi-Game condition prevents countries from perpetually borrowing new funds to pay interest without ever repaying in present value. Debt can grow, but not faster than râ€”its present value must eventually vanish."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Perpetual Deficits",
                question: "Why can a net debtor run perpetual CA deficits in infinite horizon but NOT perpetual TB deficits?",
                options: ["TB deficits are prohibited by international law in the economy",
                    "CA deficits don't affect debt, but TB deficits do in the economy",
                    "TB involves real resources (goods/services) that must be repaid eventually; CA includes financial flows that can be rolled over",
                    "CA is measured incorrectly in national accounts in the economy"],
                correct: 2,
                explanation: "TB represents real resource flows (exports minus imports). Perpetual TB deficit means never repaying real resourcesâ€”violates resource constraints. CA includes interest payments; running CA deficits while maintaining TB surpluses (paying partial interest) is feasible."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Accounting Identities",
                question: "The evolution equation B<sub>t</sub> = (1+r)B<sub>t</sub>â‚‹<sub>1</sub> + TB<sub>t</sub> can be rearranged to show TB<sub>t</sub> = B<sub>t</sub> - (1+r)B<sub>t</sub>â‚‹<sub>1</sub>. What does this reveal about TB when debt is constant (B<sub>t</sub> = B<sub>t</sub>â‚‹<sub>1</sub> = B)?",
                options: ["TB = -rB (need a surplus of rB magnitude to offset interest on negative B; if B < 0, TB > 0)",
                    "TB = 0 (no trade activity)",
                    "TB = rB (trade balance exactly offsets interest to keep debt constant)",
                    "TB = B (trade equals debt)"],
                correct: 0,
                explanation: "If B<sub>t</sub> = B<sub>t</sub>â‚‹<sub>1</sub> = B (constant debt): TB = B - (1+r)B = B - B - rB = -rB. For net debtor (B < 0), this means TB = -r(B) > 0â€”must run trade surplus equal to interest to stabilize debt."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Debt Growth and Sustainability",
                question: "A country with B<sub>0</sub> = -2000, r = 0.04, follows Î± = 0.75 policy. After many periods, if this is sustained, the debt-to-GDP ratio will:",
                options: ["Immediately jump to zero in the economy",
                    "Converge to a stable ratio if GDP growth g_Y â‰¥ r(1-Î±) = 0.01",
                    "Oscillate unpredictably in the economy",
                    "Explode to infinity as debt grows without bound"],
                correct: 1,
                explanation: "Debt grows at g = r(1-Î±) = 0.04(0.25) = 0.01 = 1%. If GDP grows â‰¥1%, debt-to-GDP ratio stabilizes or declines. If GDP growth < 1%, ratio rises (unsustainable). The policy is sustainable if g_Y â‰¥ 0.01."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Finite vs Infinite Horizon",
                question: "In the two-period model, suppose B<sub>0</sub> = 0 (initial balanced position), and the country wishes to run TB<sub>1</sub> = -100 (deficit). What TB<sub>2</sub> is needed to satisfy B<sub>2</sub> = 0 if r = 0.05?",
                options: ["TB<sub>2</sub> = +95 (discount back) in the economy",
                    "TB<sub>2</sub> = +100 (simply reverse the deficit)",
                    "TB<sub>2</sub> = +105 (repay principal plus interest: (1+r) Ã— 100)",
                    "TB<sub>2</sub> = +110.25 (compound interest on borrowed amount)"],
                correct: 2,
                explanation: "B<sub>1</sub> = (1+r)B<sub>0</sub> + TB<sub>1</sub> = 1.05(0) + (-100) = -100. To reach B<sub>2</sub> = 0: B<sub>2</sub> = (1+r)B<sub>1</sub> + TB<sub>2</sub> = 0 â†’ 1.05(-100) + TB<sub>2</sub> = 0 â†’ TB<sub>2</sub> = 105. Must repay principal (100) plus interest (5)."
            },

            // Week 3: Theory of Current Account (15 challenging questions)
            {
                week: 3,
                difficulty: "hard",
                topic: "Small Open Economy Model",
                question: "A small open economy has B<sub>0</sub> = 0, Q<sub>1</sub> = 100, Q<sub>2</sub> = 110, r* = 0.10, and Î² = 0.95. If households optimize with log utility U(C) = ln(C), what is the equilibrium C<sub>1</sub>?",
                options: ["C<sub>1</sub> â‰ˆ 98.5 (save in period 1 due to patient preferences) in the economy",
                    "C<sub>1</sub> = 100 (consume endowment each period) under these conditions",
                    "C<sub>1</sub> â‰ˆ 103.8 (solving Euler equation: C<sub>1</sub>/(C<sub>2</sub>) = Î²(1+r*) = 0.95(1.1) = 1.045, with PV budget constraint)",
                    "C<sub>1</sub> = 105 (simple average of endowments) under these conditions"],
                correct: 2,
                explanation: "With log utility, Euler equation: C<sub>1</sub>/C<sub>2</sub> = Î²(1+r*). Budget: C<sub>1</sub> + C<sub>2</sub>/1.1 = 100 + 110/1.1 = 200. From Euler: C<sub>2</sub> = C<sub>1</sub>/[Î²(1+r*)] = C<sub>1</sub>/1.045. Substituting: C<sub>1</sub> + C<sub>1</sub>/(1.045Ã—1.1) â‰ˆ C<sub>1</sub>(1 + 0.870) = 200 â†’ C<sub>1</sub> â‰ˆ 103.8."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Euler Equation and Optimization",
                question: "The Euler equation U'(C<sub>1</sub>) = Î²(1+r<sub>1</sub>)U'(C<sub>2</sub>) can be rewritten for log utility as C<sub>1</sub>/C<sub>2</sub> = Î²(1+r<sub>1</sub>). If Î² = 1.0 and r<sub>1</sub> = 0, what does this imply?",
                options: ["Consumption is indeterminate",
                    "C<sub>1</sub> = C<sub>2</sub> (perfect consumption smoothing when time preference equals interest rate)",
                    "C<sub>1</sub> > C<sub>2</sub> (consume more in period 1)",
                    "C<sub>1</sub> < C<sub>2</sub> (save for future) in the economy"],
                correct: 1,
                explanation: "If Î² = 1.0 (no time preference) and r<sub>1</sub> = 0 (no return on saving), then C<sub>1</sub>/C<sub>2</sub> = 1.0(1.0) = 1 â†’ C<sub>1</sub> = C<sub>2</sub>. Households perfectly smooth consumption across periods."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Temporary vs Permanent Shocks",
                question: "An economy has Q<sub>1</sub> = Q<sub>2</sub> = 100, B<sub>0</sub> = 0, r* = 0. A temporary shock reduces Q<sub>1</sub> to 80 (Q<sub>2</sub> unchanged). With perfect consumption smoothing (Î²(1+r) = 1), what is the new CA<sub>1</sub>?",
                options: ["CA<sub>1</sub> = +20 (households save the shock)",
                    "CA<sub>1</sub> = -10 (households borrow to smooth: C<sub>1</sub> = C<sub>2</sub> = 90, CA<sub>1</sub> = TB<sub>1</sub> = Q<sub>1</sub> - C<sub>1</sub> = 80 - 90 = -10)",
                    "CA<sub>1</sub> = -20 (households borrow to maintain C<sub>1</sub> = 90, borrowing 10)",
                    "CA<sub>1</sub> = 0 (no effect on CA)"],
                correct: 1,
                explanation: "With smoothing: C<sub>1</sub> = C<sub>2</sub>. Budget: C<sub>1</sub> + C<sub>2</sub> = 80 + 100 = 180 â†’ C<sub>1</sub> = C<sub>2</sub> = 90. CA<sub>1</sub> = TB<sub>1</sub> = Q<sub>1</sub> - C<sub>1</sub> = 80 - 90 = -10. Households borrow to smooth the temporary decline."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Temporary vs Permanent Shocks",
                question: "Compare two scenarios: (A) Q<sub>1</sub> drops by 20 (temporary), (B) Q<sub>1</sub> and Q<sub>2</sub> each drop by 10 (permanent). With smoothing, which has larger |CA<sub>1</sub>| impact?",
                options: ["Scenario B has larger impact as permanent shocks are more severe",
                    "Both have identical CA impacts",
                    "Neither affects CA",
                    "Scenario A: |CA<sub>1</sub>| = 10 (smooth temporary shock); Scenario B: |CA<sub>1</sub>| = 0 (adjust to permanent shock). Temporary shock causes larger CA movement."],
                correct: 3,
                explanation: "Scenario A (temporary): PV income drops by 10 (20/2), so C<sub>1</sub> = C<sub>2</sub> drop by 10 each. CA<sub>1</sub> = Q<sub>1</sub> - C<sub>1</sub> = (Q<sub>1</sub> - 20) - (C<sub>1</sub> - 10) = -10. Scenario B (permanent): C<sub>1</sub>, C<sub>2</sub> each drop by 10, matching output declines â†’ CA<sub>1</sub> â‰ˆ 0. Temporary shocks cause large CA movements."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Anticipated Income Shocks",
                question: "An economy learns in period 1 that Q<sub>2</sub> will increase from 100 to 120 (Q<sub>1</sub> = 100 unchanged). With r* = 0 and perfect smoothing, what happens?",
                options: ["CA<sub>1</sub> = -20 (households over-borrow) in the economy",
                    "CA<sub>1</sub> = -10 (households increase C<sub>1</sub> from 100 to 110, borrowing against future income)",
                    "CA<sub>1</sub> = +10 (save in anticipation) in the economy",
                    "CA<sub>1</sub> = 0 (no change until period 2) in the economy"],
                correct: 1,
                explanation: "Original: C<sub>1</sub> = C<sub>2</sub> = 100. New PV income: 100 + 120 = 220 â†’ C<sub>1</sub> = C<sub>2</sub> = 110. Since Q<sub>1</sub> = 100 but C<sub>1</sub> = 110, CA<sub>1</sub> = TB<sub>1</sub> = 100 - 110 = -10. Good news about future causes current CA deterioration."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Budget Constraint",
                question: "Given B<sub>0</sub> = -50, Q<sub>1</sub> = 100, Q<sub>2</sub> = 110, r* = 0.10, the intertemporal budget constraint is C<sub>1</sub> + C<sub>2</sub>/(1.1) = (1.1)(-50) + 100 + 110/1.1. Calculate the RHS (present value of resources):",
                options: ["PV = 210 (summing without discounting) in the economy",
                    "PV = 145 (correct: 0.1(-50) + 100 + 110/1.1 = -55 + 100 + 100 = 145)",
                    "PV = 160 (ignoring initial debt) in the economy",
                    "PV = 155 (accurately: -55 + 100 + 100 = 145)"],
                correct: 0,
                explanation: "PV of resources = (1+r<sub>0</sub>)B<sub>0</sub> + Q<sub>1</sub> + Q<sub>2</sub>/(1+r<sub>1</sub>) = 1.1(-50) + 100 + 110/1.1 = -55 + 100 + 100 = 145. The initial debt reduces available resources for consumption."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Budget Constraint",
                question: "If the intertemporal budget constraint is satisfied with C<sub>1</sub> = 105, C<sub>2</sub> = 115, Q<sub>1</sub> = 100, Q<sub>2</sub> = 110, r = 0, and B<sub>0</sub> = 0, what is TB<sub>1</sub>?",
                options: ["TB<sub>1</sub> = 0 (balanced trade) in the economy",
                    "TB<sub>1</sub> = -10 (larger deficit) in the economy",
                    "TB<sub>1</sub> = -5 (Q<sub>1</sub> - C<sub>1</sub> = 100 - 105 = -5, trade deficit to finance excess consumption)",
                    "TB<sub>1</sub> = +5 (trade surplus) in the economy"],
                correct: 2,
                explanation: "TB<sub>1</sub> = Q<sub>1</sub> - C<sub>1</sub> = 100 - 105 = -5. The household consumes more than output in period 1, running a trade deficit, borrowing to finance it."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Small Open Economy Model",
                question: "With free capital mobility, if the world interest rate r* = 0.05 and domestic agents try to set domestic rate r<sub>1</sub> = 0.03, what happens?",
                options: ["Domestic rate stays at 0.03 due to government policy in the economy",
                    "No capital flows occur",
                    "Equilibrium at r<sub>1</sub> = 0.04 (average of the two rates)",
                    "Massive capital outflows drive domestic rate back to r<sub>1</sub> = r* = 0.05 (arbitrage ensures interest rate parity)"],
                correct: 3,
                explanation: "Free capital mobility implies r<sub>1</sub> = r* via arbitrage. If domestic r < world r, capital flows out (domestic agents invest abroad at higher return), raising domestic rate until r<sub>1</sub> = r* = 0.05."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Euler Equation and Optimization",
                question: "For CRRA utility U(C) = C^(1-Ïƒ)/(1-Ïƒ) with Ïƒ = 2 (high risk aversion), the Euler equation is C<sub>1</sub>^(-2) / C<sub>2</sub>^(-2) = Î²(1+r). If Î² = 0.96 and r = 0.05, and C<sub>2</sub> = 100, what is C<sub>1</sub>?",
                options: ["C<sub>1</sub> â‰ˆ 99.0 (C<sub>2</sub>/C<sub>1</sub>)Â² = Î²(1+r) = 0.96(1.05) = 1.008 â†’ C<sub>2</sub>/C<sub>1</sub> â‰ˆ 1.004 â†’ C<sub>1</sub> â‰ˆ 99.6)",
                    "C<sub>1</sub> â‰ˆ 95 (much lower due to high risk aversion)",
                    "C<sub>1</sub> â‰ˆ 99.6 (correctly solving: (C<sub>2</sub>/C<sub>1</sub>)Â² = 1.008 â†’ C<sub>2</sub>/C<sub>1</sub> â‰ˆ 1.004 â†’ C<sub>1</sub> = 100/1.004 â‰ˆ 99.6)",
                    "C<sub>1</sub> = 100 (equal consumption)"],
                correct: 2,
                explanation: "Euler: (C<sub>1</sub>/C<sub>2</sub>)^Ïƒ = Î²(1+r) â†’ (C<sub>1</sub>/C<sub>2</sub>)Â² = 0.96(1.05) = 1.008 â†’ C<sub>1</sub>/C<sub>2</sub> = âˆš1.008 â‰ˆ 1.004 â†’ C<sub>1</sub> = C<sub>2</sub>/1.004 â‰ˆ 100/1.004 â‰ˆ 99.6. Slight tilt toward period-2 consumption given Î² < 1/(1+r)."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Consumption Smoothing",
                question: "Why do households prefer consumption smoothing (due to concave utility U''(C) < 0)?",
                options: ["Households dislike variety in consumption baskets in the economy",
                    "Inflation erodes purchasing power",
                    "Diminishing marginal utility: the utility gain from extra consumption when C is low exceeds the utility loss from reduced consumption when C is high",
                    "Government mandates smooth consumption"],
                correct: 2,
                explanation: "Concave utility (U''(C) < 0) means diminishing marginal utility. Transferring consumption from high-C period to low-C period increases total utility, as marginal utility is higher when C is low. This drives smoothing."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Temporary vs Permanent Shocks",
                question: "An oil-exporting country experiences a temporary oil price boom that increases Q<sub>1</sub> by 50 (Q<sub>2</sub> unchanged). With perfect smoothing and r = 0, how much does C<sub>1</sub> increase, and what is the CA<sub>1</sub> response?",
                options: ["C<sub>1</sub> increases by 50, CA<sub>1</sub> = 0 (consume all the windfall)",
                    "C<sub>1</sub> increases by 25, CA<sub>1</sub> = +25 (save half the windfall to smooth consumption: Î”C<sub>1</sub> = Î”C<sub>2</sub> = 25)",
                    "C<sub>1</sub> increases by 10, CA<sub>1</sub> = +40 (mostly save) in the economy",
                    "C<sub>1</sub> unchanged, CA<sub>1</sub> = +50 (save all windfall) in the economy"],
                correct: 1,
                explanation: "Temporary windfall increases PV income by 50. With smoothing and r = 0: Î”C<sub>1</sub> = Î”C<sub>2</sub> = 25. Since Q<sub>1</sub> rises by 50 but C<sub>1</sub> rises by 25, CA<sub>1</sub> improves by 50 - 25 = +25. Save half the windfall."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Anticipated Income Shocks",
                question: "A developing country announces major reforms expected to boost Q<sub>2</sub> from 100 to 150 (Q<sub>1</sub> = 100). Markets believe the reforms. If r = 0.10 and households smooth consumption, how does CA<sub>1</sub> respond?",
                options: ["CA<sub>1</sub> deteriorates by 50 (households borrow the full future increase)",
                    "CA<sub>1</sub> improves as households save in anticipation in the economy",
                    "CA<sub>1</sub> deteriorates by approximately 22.7 (households increase C<sub>1</sub> from baseline by borrowing against future prosperity)",
                    "CA<sub>1</sub> unchanged until reforms materialize"],
                correct: 2,
                explanation: "Original PV: 100 + 100/1.1 â‰ˆ 190.9 â†’ C<sub>1</sub> = C<sub>2</sub>/(1+r). New PV: 100 + 150/1.1 â‰ˆ 236.4. Solving Euler + budget (simplified with log utility Î²(1+r) = 1): C<sub>1</sub> â‰ˆ 122.7. CA<sub>1</sub> = TB<sub>1</sub> = Q<sub>1</sub> - C<sub>1</sub> = 100 - 122.7 â‰ˆ -22.7."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Small Open Economy Model",
                question: "In equilibrium, the three key conditions are: (1) Intertemporal budget constraint, (2) Euler equation (optimality), (3) Interest rate parity (r<sub>1</sub> = r*). If a country imposes capital controls preventing capital outflows, which condition is violated?",
                options: ["Condition (1): budget constraint is no longer binding",
                    "All three conditions are maintained in the economy",
                    "Condition (3): interest rate parity breaks down (domestic r<sub>1</sub> can deviate from r*)",
                    "Condition (2): households no longer optimize in the economy"],
                correct: 2,
                explanation: "Capital controls prevent free capital mobility, breaking the arbitrage that enforces r<sub>1</sub> = r*. The domestic interest rate can deviate from the world rate. Budget constraint and household optimization still hold domestically."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Budget Constraint",
                question: "An economy with B<sub>0</sub> = 0, Q<sub>1</sub> = 100, Q<sub>2</sub> = 121, r* = 0.10, and Î² = 1/1.1 (implying Î²(1+r) = 1) optimizes consumption. What is the equilibrium CA<sub>1</sub>?",
                options: ["CA<sub>1</sub> = +10 (save in period 1)",
                    "CA<sub>1</sub> = -21 (borrow heavily)",
                    "CA<sub>1</sub> = 0 (TB<sub>1</sub> = Q<sub>1</sub> - C<sub>1</sub> = 100 - 110 = -10, but CA<sub>1</sub> = TB<sub>1</sub> + rB<sub>0</sub> = -10 + 0 = -10; wait, if C<sub>1</sub>=C<sub>2</sub>=110 with r=0.1: PV check)",
                    "CA<sub>1</sub> â‰ˆ -10 (with perfect smoothing C<sub>1</sub> = C<sub>2</sub>: budget C<sub>1</sub> + C<sub>2</sub>/1.1 = 100 + 121/1.1 = 210 â†’ C<sub>1</sub> = C<sub>2</sub> = 110 â†’ TB<sub>1</sub> = -10)"],
                correct: 3,
                explanation: "Î²(1+r) = 1 implies perfect smoothing: C<sub>1</sub> = C<sub>2</sub>. Budget: C<sub>1</sub> + C<sub>2</sub>/1.1 = 100 + 110 = 210 â†’ C<sub>1</sub>(1 + 1/1.1) = 210 â†’ C<sub>1</sub>(1.909) = 210 â†’ C<sub>1</sub> â‰ˆ 110. CA<sub>1</sub> = TB<sub>1</sub> = Q<sub>1</sub> - C<sub>1</sub> = 100 - 110 = -10."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Consumption Smoothing",
                question: "Without international borrowing/lending (financial autarky), an economy with Q<sub>1</sub> = 80, Q<sub>2</sub> = 120 must satisfy:",
                options: ["C<sub>1</sub> = 90, C<sub>2</sub> = 110 (partial smoothing) in the economy",
                    "C<sub>1</sub> = C<sub>2</sub> = 100 (perfect smoothing despite autarky)",
                    "C<sub>1</sub> = Q<sub>1</sub> = 80, C<sub>2</sub> = Q<sub>2</sub> = 120 (no smoothing possible, consumption tied to output each period)",
                    "CA<sub>1</sub> = -20 (can still borrow)"],
                correct: 2,
                explanation: "Financial autarky means no international borrowing/lending: B<sub>1</sub> = B<sub>0</sub> = 0 always. Thus, C<sub>1</sub> = Q<sub>1</sub> = 80 and C<sub>2</sub> = Q<sub>2</sub> = 120. Consumption volatility matches output volatilityâ€”no smoothing possible."
            },

            // Week 4: Terms of Trade, World Interest Rate Shocks, and Tariffs (15 challenging questions)
            {
                week: 4,
                difficulty: "hard",
                topic: "Terms of Trade",
                question: "The terms of trade (TT) is defined as TT = P^X / P^M. If an oil-exporting country experiences a rise in oil prices (P^X â†‘) while import prices remain constant (P^M unchanged), how does this affect TT<sub>1</sub> and the budget constraint?",
                options: ["TT<sub>1</sub> rises (TT<sub>1</sub> = P^X<sub>1</sub>/P^M<sub>1</sub> increases), improving the country's purchasing power: resources = TT<sub>1</sub>Q<sub>1</sub> + TT<sub>2</sub>Q<sub>2</sub>/(1+r) rise",
                    "TT<sub>1</sub> effect depends on the elasticity of substitution",
                    "TT<sub>1</sub> unchanged as both prices move proportionally",
                    "TT<sub>1</sub> falls, making the country poorer in real terms"],
                correct: 0,
                explanation: "TT = P^X/P^M. If P^X â†‘ and P^M constant, then TT â†‘. This improvement in terms of trade increases the real value of exports (TT<sub>1</sub>Q<sub>1</sub>), expanding the budget constraint and making the country richer."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "Terms of Trade",
                question: "An economy with Q<sub>1</sub> = Q<sub>2</sub> = 100, TT<sub>1</sub> = 1, TT<sub>2</sub> = 1, experiences a temporary TT shock: TT<sub>1</sub> rises to 1.2 (TT<sub>2</sub> = 1 unchanged). With perfect smoothing (r = 0), what is the CA<sub>1</sub> response?",
                options: ["CA<sub>1</sub> â‰ˆ +10 (country saves most of the windfall: PV income rises by 20, so C<sub>1</sub> = C<sub>2</sub> rise by 10 each; CA<sub>1</sub> = TT<sub>1</sub>Q<sub>1</sub> - C<sub>1</sub> = 120 - 110 = +10)",
                    "CA<sub>1</sub> = 0 (temporary shocks don't affect CA)",
                    "CA<sub>1</sub> = -10 (borrow against future income)",
                    "CA<sub>1</sub> = +20 (save entire windfall)"],
                correct: 0,
                explanation: "Temporary TT improvement (TT<sub>1</sub> from 1 to 1.2) increases PV income by TT<sub>1</sub>Q<sub>1</sub> - Q<sub>1</sub> = 120 - 100 = 20. With smoothing: Î”C<sub>1</sub> = Î”C<sub>2</sub> = 10. CA<sub>1</sub> = TT<sub>1</sub>Q<sub>1</sub> - C<sub>1</sub> = 120 - 110 = +10. Country saves half the windfall."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "Terms of Trade",
                question: "Compare two scenarios: (A) TT<sub>1</sub> rises from 1 to 1.1 (temporary), (B) TT<sub>1</sub> and TT<sub>2</sub> both rise from 1 to 1.1 (permanent). Which has larger CA<sub>1</sub> impact?",
                options: ["Neither affects CA<sub>1</sub>",
                    "Both have identical CA<sub>1</sub> effects",
                    "Scenario B: permanent shocks have larger effects in the economy",
                    "Scenario A: CA<sub>1</sub> improves significantly as country smooths by saving; Scenario B: CA<sub>1</sub> changes little as consumption rises in both periods"],
                correct: 3,
                explanation: "Temporary TT improvement: country saves windfall to smooth consumption â†’ large CA<sub>1</sub> improvement. Permanent TT improvement: consumption rises in both periods proportionally â†’ little CA<sub>1</sub> change. Same principle as endowment shocks."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "World Interest Rate Shocks",
                question: "When the world interest rate r* rises, there are two effects: substitution and income. For a net borrower (B<sub>0</sub> < 0), which statement is correct?",
                options: ["Only substitution effect matters; income effect is negligible under these conditions",
                    "Substitution effect: C<sub>1</sub> â†“ (bonds more attractive); Income effect: C<sub>1</sub> â†“ (poorer due to higher debt costs); Effects reinforce â†’ CA<sub>1</sub> â†‘",
                    "Interest rate changes don't affect consumption decisions",
                    "Substitution and income effects oppose, making the net effect ambiguous in the economy"],
                correct: 1,
                explanation: "For net borrower (B<sub>0</sub> < 0): (1) Substitution effect: r â†‘ makes saving more attractive â†’ C<sub>1</sub> â†“. (2) Income effect: r â†‘ raises debt service costs â†’ poorer â†’ C<sub>1</sub> â†“. Both effects reinforce, unambiguously improving CA<sub>1</sub>."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "World Interest Rate Shocks",
                question: "For a net lender (B<sub>0</sub> > 0), an increase in r* creates opposing effects. Which effect typically dominates under standard preferences?",
                options: ["Net effect depends entirely on the size of B<sub>0</sub> in the economy",
                    "Substitution effect dominates: bonds more attractive â†’ C<sub>1</sub> â†“, CA<sub>1</sub> â†‘ (savings should increase with interest rate)",
                    "Both effects exactly cancel",
                    "Income effect dominates: higher returns make lender richer â†’ C<sub>1</sub> â†‘, CA<sub>1</sub> â†“"],
                correct: 1,
                explanation: "For net lender (B<sub>0</sub> > 0): income effect (richer â†’ C<sub>1</sub> â†‘) opposes substitution effect (bonds more attractive â†’ C<sub>1</sub> â†“). Under standard preferences, substitution effect dominatesâ€”we expect savings to increase when r rises."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "World Interest Rate Shocks",
                question: "An economy with B<sub>0</sub> = 0 experiences an increase in r* from 0.05 to 0.10. The Euler equation changes from C<sub>1</sub>/C<sub>2</sub> = Î²(1.05) to C<sub>1</sub>/C<sub>2</sub> = Î²(1.10). What happens to C<sub>1</sub> relative to C<sub>2</sub>?",
                options: ["C<sub>1</sub>/C<sub>2</sub> falls (tilt consumption toward period 2, as C<sub>2</sub> becomes cheaper in PV terms)",
                    "C<sub>1</sub>/C<sub>2</sub> rises (tilt consumption toward period 1)",
                    "C<sub>1</sub>/C<sub>2</sub> unchanged (B<sub>0</sub> = 0 means no income effect)",
                    "Cannot determine without knowing Î²"],
                correct: 0,
                explanation: "With B<sub>0</sub> = 0 (pure substitution effect): higher r makes future consumption cheaper in present value. C<sub>1</sub>/C<sub>2</sub> = Î²(1+r) rises â†’ C<sub>1</sub> rises relative to C<sub>2</sub>. But in levels, C<sub>1</sub> falls because budget constraint rotates: TB<sub>1</sub> = Q<sub>1</sub> - C<sub>1</sub> improves."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "Import Tariffs",
                question: "The modified Euler equation with tariffs is U'(C<sub>1</sub>) = [(1+Ï„<sub>1</sub>)/(1+Ï„<sub>2</sub>)]Î²(1+r)U'(C<sub>2</sub>). If Ï„<sub>1</sub> = 0.10 and Ï„<sub>2</sub> = 0, what is the effect?",
                options: ["(1+Ï„<sub>1</sub>)/(1+Ï„<sub>2</sub>) = 1.10 > 1 makes current consumption relatively cheap â†’ C<sub>1</sub> â†‘, CA<sub>1</sub> â†“",
                    "The ratio equals 1 since Ï„<sub>2</sub> = 0",
                    "Temporary tariffs have no effect on consumption allocation",
                    "(1+Ï„<sub>1</sub>)/(1+Ï„<sub>2</sub>) = 1.10 > 1 makes current consumption relatively expensive â†’ C<sub>1</sub> â†“, CA<sub>1</sub> â†‘"],
                correct: 3,
                explanation: "Temporary tariff (Ï„<sub>1</sub> = 0.10, Ï„<sub>2</sub> = 0): (1+Ï„<sub>1</sub>)/(1+Ï„<sub>2</sub>) = 1.10/1 = 1.10 > 1. This makes current consumption relatively expensive (high tariff now, no tariff later). Households postpone consumption: C<sub>1</sub> â†“, CA<sub>1</sub> â†‘."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "Import Tariffs",
                question: "A permanent tariff is imposed: Ï„<sub>1</sub> = Ï„<sub>2</sub> = 0.20. What is the effect on the current account?",
                options: ["CA<sub>1</sub> deteriorates due to retaliation under these conditions",
                    "Effect depends on elasticity of import demand under these conditions",
                    "CA<sub>1</sub> improves significantly as tariffs reduce imports",
                    "No effect on CA<sub>1</sub>: (1+Ï„<sub>1</sub>)/(1+Ï„<sub>2</sub>) = 1 in Euler equation, no intertemporal substitution created"],
                correct: 3,
                explanation: "Permanent tariff (Ï„<sub>1</sub> = Ï„<sub>2</sub>): the ratio (1+Ï„<sub>1</sub>)/(1+Ï„<sub>2</sub>) = 1 in Euler equation. No intertemporal distortion is created. Consumption path and CA are unchanged. Tariffs only affect CA via intertemporal substitution."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "Import Tariffs",
                question: "An anticipated future tariff is announced: Ï„<sub>1</sub> = 0, Ï„<sub>2</sub> = 0.25. How does this affect CA<sub>1</sub>?",
                options: ["CA<sub>1</sub> improves slightly due to precautionary saving in the economy",
                    "CA<sub>1</sub> improves as households save in anticipation under these conditions",
                    "CA<sub>1</sub> deteriorates: (1+Ï„<sub>1</sub>)/(1+Ï„<sub>2</sub>) = 1/1.25 = 0.8 < 1 makes current consumption relatively cheap â†’ C<sub>1</sub> â†‘, CA<sub>1</sub> â†“",
                    "No effect until Ï„<sub>2</sub> is actually implemented"],
                correct: 2,
                explanation: "Anticipated future tariff (Ï„<sub>1</sub> = 0, Ï„<sub>2</sub> = 0.25): (1+Ï„<sub>1</sub>)/(1+Ï„<sub>2</sub>) = 1/1.25 = 0.8 < 1. Current consumption is relatively cheap (no tariff now, high tariff later). Households front-load consumption: C<sub>1</sub> â†‘, CA<sub>1</sub> â†“."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "Import Tariffs",
                question: "Why do permanent tariffs not affect the current account in this model, despite reducing imports?",
                options: ["Imports don't affect the current account",
                    "The model assumes tariff revenues are wasted",
                    "The model ignores general equilibrium effects",
                    "Tariff revenues are rebated lump-sum (L_t = Ï„_t C_t), so economy-wide resource constraint is unchanged: C<sub>1</sub> + C<sub>2</sub>/(1+r) = (1+r)B<sub>0</sub> + TT<sub>1</sub>Q<sub>1</sub> + TT<sub>2</sub>Q<sub>2</sub>/(1+r)"],
                correct: 3,
                explanation: "Tariff revenues are rebated lump-sum to households (L_t = Ï„_t C_t). This means the economy-wide budget constraint remains unchangedâ€”no net resources are gained or lost. Permanent tariffs don't create intertemporal distortions, so CA is unaffected."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "Terms of Trade",
                question: "A commodity exporter has Q<sub>1</sub> = Q<sub>2</sub> = 100, TT<sub>1</sub> = 1, TT<sub>2</sub> = 1, r = 0. A permanent TT improvement occurs: TT<sub>1</sub> = TT<sub>2</sub> = 1.2. With perfect smoothing, how much does C<sub>1</sub> increase?",
                options: ["Î”C<sub>1</sub> = 0 (permanent shocks don't affect consumption) in the economy",
                    "Î”C<sub>1</sub> = 20 (full increase in both periods: PV income rises by 120 - 100 = 20 in each period, so Î”C<sub>1</sub> = Î”C<sub>2</sub> = 20)",
                    "Î”C<sub>1</sub> = 40 (double the increase)",
                    "Î”C<sub>1</sub> = 10 (half the increase)"],
                correct: 1,
                explanation: "Permanent TT improvement: PV income changes from 100 + 100 = 200 to 120 + 120 = 240. Î”PV = 40. With smoothing: Î”C<sub>1</sub> = Î”C<sub>2</sub> = 20. Permanent shocks are fully adjusted to; no smoothing via borrowing/lending needed."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "World Interest Rate Shocks",
                question: "An economy has B<sub>0</sub> = -100, r* rises from 0.05 to 0.10. The income effect changes the budget constraint by approximately:",
                options: ["0 (B<sub>0</sub> < 0 means no income effect)",
                    "+5 (additional interest income) in the economy",
                    "-10 (debt service doubles) under these conditions",
                    "-5 (increased debt service: Î”(rB<sub>0</sub>) = 0.05(-100) = -5, reducing PV resources)"],
                correct: 3,
                explanation: "Net borrower (B<sub>0</sub> = -100): income effect from r rising by 0.05 is Î”(rB<sub>0</sub>) = 0.05 Ã— (-100) = -5. The country must pay additional interest, reducing available resources by approximately 5 in present value terms."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "World Interest Rate Shocks",
                question: "For a country with B<sub>0</sub> = +200 (net lender), r* rises from 0.04 to 0.06. The positive income effect increases resources by:",
                options: ["0 (interest changes don't create income effects for lenders)",
                    "+4 (Î”(rB<sub>0</sub>) = 0.02 Ã— 200 = 4)",
                    "+8 (proportional to the rate change)",
                    "+12 (including compounding) in the economy"],
                correct: 1,
                explanation: "Net lender (B<sub>0</sub> = +200): income effect from r rising by 0.02 is Î”(rB<sub>0</sub>) = 0.02 Ã— 200 = +4. The country earns additional interest income, increasing available resources by 4 in present value."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "Import Tariffs",
                question: "The household budget constraints with tariffs are (1+Ï„<sub>1</sub>)C<sub>1</sub> + B<sub>1</sub> = TT<sub>1</sub>Q<sub>1</sub> + L<sub>1</sub> + (1+r<sub>0</sub>)B<sub>0</sub> where L<sub>1</sub> = Ï„<sub>1</sub>C<sub>1</sub>. Substituting the rebate, the constraint simplifies to:",
                options: ["(1+Ï„<sub>1</sub>)C<sub>1</sub> + B<sub>1</sub> = TT<sub>1</sub>Q<sub>1</sub> + (1+r<sub>0</sub>)B<sub>0</sub> (rebate doesn't affect household)",
                    "Tariffs prevent simplification",
                    "Ï„<sub>1</sub>C<sub>1</sub> + B<sub>1</sub> = TT<sub>1</sub>Q<sub>1</sub> (only tariff component matters) in the economy",
                    "C<sub>1</sub> + B<sub>1</sub> = TT<sub>1</sub>Q<sub>1</sub> + (1+r<sub>0</sub>)B<sub>0</sub> (tariff term cancels out as (1+Ï„<sub>1</sub>)C<sub>1</sub> - Ï„<sub>1</sub>C<sub>1</sub> = C<sub>1</sub>)"],
                correct: 3,
                explanation: "(1+Ï„<sub>1</sub>)C<sub>1</sub> + B<sub>1</sub> = TT<sub>1</sub>Q<sub>1</sub> + L<sub>1</sub> + (1+r<sub>0</sub>)B<sub>0</sub>. With L<sub>1</sub> = Ï„<sub>1</sub>C<sub>1</sub>: (1+Ï„<sub>1</sub>)C<sub>1</sub> + B<sub>1</sub> = TT<sub>1</sub>Q<sub>1</sub> + Ï„<sub>1</sub>C<sub>1</sub> + (1+r<sub>0</sub>)B<sub>0</sub>. Simplifying: C<sub>1</sub> + B<sub>1</sub> = TT<sub>1</sub>Q<sub>1</sub> + (1+r<sub>0</sub>)B<sub>0</sub>. The economy-wide resource constraint is unaffected by tariffs when revenues are rebated."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "Terms of Trade",
                question: "Why do terms-of-trade shocks behave identically to endowment shocks in their CA effects?",
                options: ["Endowment shocks are always larger in magnitude in the economy",
                    "Terms of trade don't actually affect the current account in the economy",
                    "They both affect the present value of resources in the same way: TT_t Q_t is analogous to endowment Q_t",
                    "They affect different components of the budget constraint in the economy"],
                correct: 2,
                explanation: "In the budget constraint C<sub>1</sub> + C<sub>2</sub>/(1+r) = (1+r)B<sub>0</sub> + TT<sub>1</sub>Q<sub>1</sub> + TT<sub>2</sub>Q<sub>2</sub>/(1+r), terms-of-trade-adjusted output TT_t Q_t plays the same role as endowment Q_t in the single-good model. Temporary vs permanent TT shocks have identical CA effects to endowment shocks."
            },

            // Week 5: Production Economy and Current Account Determination
            {
                week: 5,
                difficulty: "hard",
                topic: "Production Economy",
                question: "In the production economy model, output in period t is Q_t = A_t F(I_{t-1}), where I_{t-1} is investment and A_t is productivity. What is the marginal product of capital (MPK)?",
                options: ["MPK = F'(I_{t-1}) / A_t in the economy",
                    "MPK = A_t F'(I_{t-1}) (the additional output from one more unit of investment)",
                    "MPK = F(I_{t-1}) under these conditions",
                    "MPK = A_t F(I_{t-1}) / I_{t-1} in the economy"],
                correct: 1,
                explanation: "Marginal product of capital: MPK<sub>2</sub> = âˆ‚Q<sub>2</sub>/âˆ‚I<sub>1</sub> = A<sub>2</sub>F'(I<sub>1</sub>). This represents the additional output in period 2 from investing one more unit in period 1, accounting for productivity A<sub>2</sub>."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Production Economy",
                question: "The firm's profit maximization condition for optimal investment is A<sub>2</sub>F'(I<sub>1</sub>) = 1 + r<sub>1</sub>. What is the economic interpretation?",
                options: ["Invest until marginal benefit (MPK) equals marginal cost (1 + r<sub>1</sub>, the opportunity cost of funds)",
                    "Investment should equal savings in the economy",
                    "Marginal product equals the interest rate in the economy",
                    "All output should be invested under these conditions"],
                correct: 0,
                explanation: "A<sub>2</sub>F'(I<sub>1</sub>) = 1 + r<sub>1</sub>: invest until the marginal benefit (additional output from last unit invested, MPK = A<sub>2</sub>F'(I<sub>1</sub>)) equals the marginal cost (opportunity cost of funds, 1 + r<sub>1</sub>). This is the standard first-order condition."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Investment Schedule",
                question: "The investment schedule I_1 = I(r_1^-, A_2^+) shows how investment depends on r_1 and A_2. Why is âˆ‚I_1/âˆ‚r_1 < 0?",
                options: ["Higher interest rates make investment more attractive",
                    "Higher r_1 increases the opportunity cost of investing â†’ firms invest less (I_1 â†“)",
                    "The relationship depends on productivity in the economy",
                    "Investment is independent of interest rates in the economy"],
                correct: 1,
                explanation: "From A_2Â·F'(I_1) = 1 + r_1: if r_1 rises, firms must reduce I_1 to raise F'(I_1) (due to diminishing returns) to satisfy the condition. Higher interest rates â†’ higher opportunity cost â†’ less investment."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Investment Schedule",
                question: "Why is âˆ‚I_1/âˆ‚A_2 > 0 in the investment schedule I_1 = I(r_1^-, A_2^+)?",
                options: ["Productivity shocks don't affect investment decisions",
                    "The relationship is ambiguous",
                    "Higher A_2 reduces investment due to income effects in the economy",
                    "Higher productivity A_2 raises the marginal product A_2Â·F'(I_1), making investment more profitable â†’ I_1 â†‘"],
                correct: 3,
                explanation: "From A_2Â·F'(I_1) = 1 + r_1: if A_2 rises, firms can invest more (I_1 â†‘) while still satisfying the condition (as A_2Â·F'(I_1) rises). Higher future productivity makes investment more profitable."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Saving Schedule",
                question: "The saving schedule is S<sub>1</sub> = S(r<sub>1</sub>âº, A<sub>1</sub>âº, A<sub>2</sub>â»). Why is âˆ‚S<sub>1</sub>/âˆ‚A<sub>1</sub> > 0?",
                options: ["Higher current productivity A<sub>1</sub> increases Q<sub>1</sub> = A<sub>1</sub>F(I<sub>0</sub>), raising income â†’ households save more (temporary income shock)",
                    "Higher A<sub>1</sub> causes households to borrow under these conditions",
                    "Productivity doesn't affect saving decisions",
                    "Higher A<sub>1</sub> reduces output and income"],
                correct: 0,
                explanation: "S<sub>1</sub> = Q<sub>1</sub> - C<sub>1</sub>. Higher A<sub>1</sub> raises Q<sub>1</sub> = A<sub>1</sub>F(I<sub>0</sub>). If this is a temporary shock (A<sub>2</sub> unchanged), households smooth consumption: C<sub>1</sub> rises less than Q<sub>1</sub> â†’ S<sub>1</sub> = Q<sub>1</sub> - C<sub>1</sub> rises."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Saving Schedule",
                question: "Why is âˆ‚S<sub>1</sub>/âˆ‚A<sub>2</sub> < 0 in the saving schedule S<sub>1</sub> = S(r<sub>1</sub>âº, A<sub>1</sub>âº, A<sub>2</sub>â»)?",
                options: ["Future productivity doesn't affect current saving in the economy",
                    "The relationship depends on risk aversion",
                    "Higher future productivity A<sub>2</sub> is good news â†’ households borrow against future income â†’ S<sub>1</sub> â†“",
                    "Higher A<sub>2</sub> increases current saving for precautionary reasons"],
                correct: 2,
                explanation: "Higher A<sub>2</sub> means higher future income Q<sub>2</sub> = A<sub>2</sub>F(I<sub>1</sub>). Good news about future income causes households to increase C<sub>1</sub> (borrowing against future) â†’ S<sub>1</sub> = Q<sub>1</sub> - C<sub>1</sub> falls. This is the anticipated income effect."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Current Account Schedule",
                question: "The current account schedule is CA<sub>1</sub> = CA(r<sub>1</sub>âº, A<sub>1</sub>âº, A<sub>2</sub>â») = S<sub>1</sub> - I<sub>1</sub>. Why is âˆ‚CA<sub>1</sub>/âˆ‚A<sub>1</sub> > 0?",
                options: ["Higher A<sub>1</sub> increases both S<sub>1</sub> and I<sub>1</sub> equally in the economy",
                    "Higher current productivity A<sub>1</sub> raises S<sub>1</sub> (temporary income shock â†’ save windfall) but doesn't directly affect I<sub>1</sub> (depends on A<sub>2</sub>) â†’ CA<sub>1</sub> â†‘",
                    "Higher A<sub>1</sub> causes CA<sub>1</sub> to deteriorate",
                    "Current productivity doesn't affect CA"],
                correct: 1,
                explanation: "CA<sub>1</sub> = S<sub>1</sub> - I<sub>1</sub>. Higher A<sub>1</sub>: (1) S<sub>1</sub> rises (temporary income boost â†’ save windfall). (2) I<sub>1</sub> unchanged (investment depends on A<sub>2</sub>, not A<sub>1</sub>). Net effect: CA<sub>1</sub> = S<sub>1</sub> - I<sub>1</sub> improves."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Current Account Schedule",
                question: "Why is âˆ‚CA<sub>1</sub>/âˆ‚A<sub>2</sub> < 0 in the current account schedule CA<sub>1</sub> = CA(r<sub>1</sub>âº, A<sub>1</sub>âº, A<sub>2</sub>â»)?",
                options: ["Higher A<sub>2</sub> reduces saving S<sub>1</sub> (good news â†’ borrow) and increases investment I<sub>1</sub> (more profitable) â†’ both effects worsen CA<sub>1</sub>",
                    "Higher A<sub>2</sub> improves CA<sub>1</sub> through precautionary saving",
                    "The effect is ambiguous",
                    "Future productivity shocks don't affect current CA under these conditions"],
                correct: 0,
                explanation: "CA<sub>1</sub> = S<sub>1</sub> - I<sub>1</sub>. Higher A<sub>2</sub>: (1) S<sub>1</sub> â†“ (good news about future â†’ households borrow). (2) I<sub>1</sub> â†‘ (higher MPK â†’ firms invest more). Both effects reduce CA<sub>1</sub>: âˆ‚CA<sub>1</sub>/âˆ‚A<sub>2</sub> < 0."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Metzler Diagram",
                question: "In the Metzler diagram with r<sub>1</sub> on the vertical axis and S<sub>1</sub>, I<sub>1</sub>, CA<sub>1</sub> on the horizontal axis, the investment schedule I(r<sub>1</sub>â») slopes:",
                options: ["Upward: higher r<sub>1</sub> â†’ more investment in the economy",
                    "Vertical: investment is independent of r<sub>1</sub>",
                    "Downward: higher r<sub>1</sub> â†’ higher opportunity cost â†’ less investment",
                    "Horizontal: interest rate adjusts to investment in the economy"],
                correct: 2,
                explanation: "Investment schedule I(r<sub>1</sub>â») slopes downward: âˆ‚I<sub>1</sub>/âˆ‚r<sub>1</sub> < 0. Higher interest rates increase the opportunity cost of investing, reducing optimal investment. The curve is downward-sloping in (I<sub>1</sub>, r<sub>1</sub>) space."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Metzler Diagram",
                question: "In the Metzler diagram, the saving schedule S(r<sub>1</sub>âº) slopes:",
                options: ["Downward: higher r<sub>1</sub> â†’ consume more in the economy",
                    "Vertical: saving is independent of r<sub>1</sub>",
                    "Upward: higher r<sub>1</sub> â†’ substitution effect dominates â†’ save more",
                    "Ambiguous: income and substitution effects oppose"],
                correct: 2,
                explanation: "Saving schedule S(r<sub>1</sub>âº) slopes upward: âˆ‚S<sub>1</sub>/âˆ‚r<sub>1</sub> > 0. Higher interest rates make saving more attractive (substitution effect typically dominates income effect), so households save more."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Metzler Diagram",
                question: "A positive productivity shock in period 2 (A<sub>2</sub> â†‘) shifts which curves in the Metzler diagram?",
                options: ["Only investment schedule shifts in the economy",
                    "Investment schedule shifts right (I_1 â†‘); Saving schedule shifts left (S_1 â†“); CA_1 schedule shifts left (worsens)",
                    "Neither schedule shifts",
                    "Both schedules shift right under these conditions"],
                correct: 1,
                explanation: "A_2 â†‘: (1) Investment: I_1 = I(r_1^-, A_2^+) shifts right (higher MPK â†’ more investment). (2) Saving: S_1 = S(r_1^+, A_1^+, A_2^-) shifts left (good news â†’ borrow â†’ S_1 â†“). (3) CA_1 = S_1 - I_1 shifts left (deteriorates)."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Giant Oil Discoveries",
                question: "The giant oil discoveries application shows that when large oil fields are discovered (future productivity shock A<sub>2</sub> â†‘), the empirical evidence supports:",
                options: ["Investment remains unchanged",
                    "CA<sub>1</sub> deteriorates: countries invest heavily (I<sub>1</sub> â†‘) and borrow against future oil income (S<sub>1</sub> â†“), confirming model predictions",
                    "CA<sub>1</sub> improves due to precautionary saving in the economy",
                    "CA<sub>1</sub> is unaffected by oil discoveries under these conditions"],
                correct: 1,
                explanation: "Giant oil discoveries represent large anticipated productivity shocks (A<sub>2</sub> â†‘). Model predicts: I<sub>1</sub> â†‘ (building infrastructure to extract oil) and S<sub>1</sub> â†“ (borrowing against future oil revenue) â†’ CA<sub>1</sub> deteriorates. Empirical evidence confirms this pattern."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Production Economy",
                question: "The production function Q_t = A_t F(I_{t-1}) exhibits diminishing marginal product of capital: F''(I) < 0. What does this imply for the investment response to A<sub>2</sub>?",
                options: ["Investment becomes negative",
                    "F''(I) < 0 ensures a finite investment response: as I<sub>1</sub> rises, F'(I<sub>1</sub>) falls, limiting how much investment increases",
                    "Diminishing returns prevent any investment in the economy",
                    "Higher A<sub>2</sub> leads to infinite investment in the economy"],
                correct: 1,
                explanation: "Diminishing returns (F''(I) < 0) mean F'(I<sub>1</sub>) falls as I<sub>1</sub> rises. From A<sub>2</sub>F'(I<sub>1</sub>) = 1 + r<sub>1</sub>: even if A<sub>2</sub> rises, the decline in F'(I<sub>1</sub>) as I<sub>1</sub> increases ensures a finite, determinate level of optimal investment."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Current Account Schedule",
                question: "In a small open economy with free capital mobility, r<sub>1</sub> = r* (world rate). If the world rate rises (r* â†‘), what happens to CA<sub>1</sub> in the production economy?",
                options: ["CA<sub>1</sub> worsens as investment increases",
                    "CA<sub>1</sub> unchanged",
                    "CA<sub>1</sub> improves: S<sub>1</sub> rises (substitution effect in saving) and I<sub>1</sub> falls (higher opportunity cost) â†’ CA<sub>1</sub> = S<sub>1</sub> - I<sub>1</sub> unambiguously improves",
                    "Effect depends on productivity shocks"],
                correct: 2,
                explanation: "r<sub>1</sub> = r* rises: (1) S<sub>1</sub> = S(r<sub>1</sub>âº, ...) increases (saving more attractive). (2) I<sub>1</sub> = I(r<sub>1</sub>â», ...) decreases (investment less profitable). (3) CA<sub>1</sub> = S<sub>1</sub> - I<sub>1</sub> unambiguously improves. Both effects work in same direction."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Production Economy",
                question: "How does the production economy model differ from the endowment economy in Week 3?",
                options: ["Production economy has no consumption under these conditions",
                    "No difference; both are identical",
                    "Endowment economy includes investment under these conditions",
                    "Production economy introduces investment decisions and physical capital: Q_t = A_t F(I_{t-1}); Endowment economy has exogenous output Q_t"],
                correct: 3,
                explanation: "Key difference: Endowment economy (Week 3) has exogenous output Q_t. Production economy (Week 5) has endogenous output Q_t = A_t F(I_{t-1}) determined by investment I_{t-1} and productivity A_t. Investment decisions introduce new channels for CA determination."
            },
        ];

        let currentWeek = 'all';
        let currentDifficulty = 'easy';
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let answeredCorrectly = []; // Track if answer was correct on first attempt
        let hasAnswered = []; // Track if question has been answered
        let filteredQuestions = [];
        let userName = '';

        // Week selector
        document.querySelectorAll('.week-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.week-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentWeek = this.dataset.week;
            });
        });

        // Difficulty selector
        document.querySelectorAll('.difficulty-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentDifficulty = this.dataset.difficulty;
            });
        });

        // Leaderboard functions - now using Firebase for global leaderboard
        function saveToLeaderboard(name, score, correct, total, week) {
            const entry = {
                name: name,
                score: score,
                correct: correct,
                total: total,
                week: week,
                date: new Date().toISOString(),
                timestamp: Date.now()
            };

            if (database) {
                // Save to Firebase (global leaderboard)
                const leaderboardRef = database.ref('leaderboard');
                leaderboardRef.push(entry).then(() => {
                    console.log('Score saved to global leaderboard');
                }).catch((error) => {
                    console.error('Error saving to Firebase:', error);
                    // Fallback to localStorage if Firebase fails
                    saveToLocalStorage(entry);
                });
            } else {
                // Fallback to localStorage if Firebase not available
                saveToLocalStorage(entry);
            }
        }

        function saveToLocalStorage(entry) {
            const saved = localStorage.getItem('ec201_leaderboard');
            const leaderboard = saved ? JSON.parse(saved) : [];
            leaderboard.push(entry);
            leaderboard.sort((a, b) => b.score - a.score || b.timestamp - a.timestamp);
            localStorage.setItem('ec201_leaderboard', JSON.stringify(leaderboard));
        }

        function displayLeaderboard(elementId) {
            const element = document.getElementById(elementId);
            element.innerHTML = '<div style="text-align: center; padding: 20px;">Loading global leaderboard...</div>';

            if (database) {
                // Fetch from Firebase (global leaderboard)
                const leaderboardRef = database.ref('leaderboard');
                leaderboardRef.orderByChild('score').limitToLast(100).once('value').then((snapshot) => {
                    const leaderboard = [];
                    snapshot.forEach((childSnapshot) => {
                        leaderboard.push(childSnapshot.val());
                    });

                    // Sort by score descending, then by timestamp
                    leaderboard.sort((a, b) => b.score - a.score || b.timestamp - a.timestamp);

                    renderLeaderboard(leaderboard, element);
                }).catch((error) => {
                    console.error('Error fetching leaderboard:', error);
                    // Fallback to localStorage
                    displayLocalLeaderboard(element);
                });
            } else {
                // Fallback to localStorage
                displayLocalLeaderboard(element);
            }
        }

        function displayLocalLeaderboard(element) {
            const saved = localStorage.getItem('ec201_leaderboard');
            const leaderboard = saved ? JSON.parse(saved) : [];
            renderLeaderboard(leaderboard, element);
        }

        function renderLeaderboard(leaderboard, element) {
            if (leaderboard.length === 0) {
                element.innerHTML = '<div class="no-leaderboard">No scores yet. Be the first!</div>';
                return;
            }

            let html = `
                <div style="text-align: center; margin-bottom: 15px; color: #667eea; font-weight: 600;">
                    ðŸŒ Global Leaderboard - ${leaderboard.length} students competing!
                </div>
                <table class="leaderboard-table">
                <thead><tr><th>Rank</th><th>Name</th><th>Score</th><th>Week</th><th>Date</th></tr></thead>
                <tbody>
            `;

            leaderboard.slice(0, 20).forEach((entry, index) => {
                const rankClass = index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : '';
                const date = new Date(entry.date).toLocaleDateString();
                const weekText = entry.week === 'all' ? 'All Weeks' : `Week ${entry.week}`;

                html += `
                    <tr>
                        <td><span class="rank-badge ${rankClass}">${index + 1}</span></td>
                        <td><strong>${entry.name}</strong></td>
                        <td>${entry.score}% (${entry.correct}/${entry.total})</td>
                        <td>${weekText}</td>
                        <td>${date}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            element.innerHTML = html;
        }

        function showLeaderboardOnly() {
            const display = document.getElementById('leaderboardDisplay');
            if (display.style.display === 'none') {
                display.style.display = 'block';
                displayLeaderboard('leaderboardContent');
            } else {
                display.style.display = 'none';
            }
        }

        function toggleBelgradeTracker() {
            const tracker = document.getElementById('belgradeTracker');
            if (tracker.style.display === 'none') {
                tracker.style.display = 'block';
                // Scroll to tracker
                tracker.scrollIntoView({ behaviour: 'smooth', block: 'start' });
            } else {
                tracker.style.display = 'none';
            }
        }

        function startQuiz() {
            // Get user name
            userName = document.getElementById('userName').value.trim();
            if (!userName) {
                alert('Please enter your name before starting the quiz!');
                return;
            }
            // Filter questions based on selected week and difficulty
            let filtered = questions;

            // Filter by difficulty
            filtered = filtered.filter(q => q.difficulty === currentDifficulty);

            // Filter by week
            if (currentWeek === 'all') {
                filteredQuestions = [...filtered];
            } else {
                filteredQuestions = filtered.filter(q => q.week === parseInt(currentWeek));
            }

            // Reset state
            currentQuestionIndex = 0;
            userAnswers = new Array(filteredQuestions.length).fill(null);
            answeredCorrectly = new Array(filteredQuestions.length).fill(false);
            hasAnswered = new Array(filteredQuestions.length).fill(false);

            // Show quiz area
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('quizArea').style.display = 'block';
            document.getElementById('results').classList.remove('show');

            // Display user greeting
            document.getElementById('userGreeting').innerHTML = `Good luck, <strong>${userName}</strong>! ðŸŽ“`;

            displayQuestion();
        }

        function displayQuestion() {
            const container = document.getElementById('questionContainer');
            const question = filteredQuestions[currentQuestionIndex];

            container.innerHTML = `
                <div class="question-card active">
                    <div class="question-header">
                        <span class="question-number">Question ${currentQuestionIndex + 1} of ${filteredQuestions.length}</span>
                        <span class="question-number">Week ${question.week}</span>
                    </div>
                    <div class="question-text">${question.question}</div>
                    <div class="options">
                        ${question.options.map((option, index) => `
                            <div class="option" onclick="selectAnswer(${index})" data-index="${index}">
                                <span class="option-label">${String.fromCharCode(65 + index)}.</span>
                                ${option}
                            </div>
                        `).join('')}
                    </div>
                    <div class="feedback" id="feedback"></div>
                </div>
            `;

            // Restore previous answer if exists
            if (userAnswers[currentQuestionIndex] !== null) {
                selectAnswer(userAnswers[currentQuestionIndex], true);
            }

            updateProgress();
            updateButtons();
        }

        function selectAnswer(index, skipFeedback = false) {
            // If already answered, don't allow changing
            if (hasAnswered[currentQuestionIndex] && !skipFeedback) {
                return;
            }

            const options = document.querySelectorAll('.option');
            options.forEach(opt => {
                opt.classList.remove('selected', 'correct', 'incorrect');
            });

            options[index].classList.add('selected');
            userAnswers[currentQuestionIndex] = index;

            if (!skipFeedback) {
                showFeedback(index);
            }

            document.getElementById('nextBtn').disabled = false;
        }

        function showFeedback(selectedIndex) {
            const question = filteredQuestions[currentQuestionIndex];
            const feedback = document.getElementById('feedback');
            const options = document.querySelectorAll('.option');

            // Mark as answered
            hasAnswered[currentQuestionIndex] = true;

            // Disable all options after first attempt
            options.forEach(opt => {
                opt.style.cursor = 'not-allowed';
                opt.style.opacity = '0.7';
                opt.onclick = null;
            });

            if (selectedIndex === question.correct) {
                // Only count as correct if it's the first attempt
                answeredCorrectly[currentQuestionIndex] = true;
                feedback.className = 'feedback correct show';
                feedback.innerHTML = `<strong>âœ“ Correct!</strong> ${question.explanation}`;
                options[selectedIndex].classList.add('correct');
            } else {
                // Wrong answer - will NOT count toward score
                answeredCorrectly[currentQuestionIndex] = false;
                feedback.className = 'feedback incorrect show';
                feedback.innerHTML = `<strong>âœ— Incorrect.</strong> ${question.explanation}<br><br><em>Note: You cannot change your answer. This will count as incorrect in your final score.</em>`;
                options[selectedIndex].classList.add('incorrect');
                options[question.correct].classList.add('correct');
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < filteredQuestions.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                showResults();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / filteredQuestions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function updateButtons() {
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;

            if (currentQuestionIndex === filteredQuestions.length - 1) {
                document.getElementById('nextBtn').textContent = 'Finish Quiz';
            } else {
                document.getElementById('nextBtn').textContent = 'Next Question';
            }
        }

        function analyzePerformance() {
            // Analyse performance by topic
            const topicStats = {};

            filteredQuestions.forEach((question, index) => {
                const topic = question.topic || 'General';
                const week = question.week;

                if (!topicStats[week]) {
                    topicStats[week] = {};
                }

                if (!topicStats[week][topic]) {
                    topicStats[week][topic] = {
                        correct: 0,
                        total: 0,
                        questions: []
                    };
                }

                topicStats[week][topic].total++;
                topicStats[week][topic].questions.push(question.question);

                if (answeredCorrectly[index]) {
                    topicStats[week][topic].correct++;
                }
            });

            // Generate AI review
            let reviewHTML = '';
            let weakTopics = [];
            let strongTopics = [];

            // Analyse each week
            Object.keys(topicStats).sort().forEach(week => {
                const topics = topicStats[week];

                Object.keys(topics).forEach(topicName => {
                    const stat = topics[topicName];
                    const accuracy = (stat.correct / stat.total) * 100;

                    const topicData = {
                        week: week,
                        topic: topicName,
                        accuracy: accuracy,
                        correct: stat.correct,
                        total: stat.total
                    };

                    if (accuracy < 60) {
                        weakTopics.push(topicData);
                    } else if (accuracy >= 80) {
                        strongTopics.push(topicData);
                    }
                });
            });

            // Sort weak topics by accuracy (worst first)
            weakTopics.sort((a, b) => a.accuracy - b.accuracy);

            // Generate summary
            if (weakTopics.length > 0) {
                reviewHTML += '<div class="ai-summary">';
                reviewHTML += `<strong>Key Finding:</strong> You should focus on improving your understanding of `;
                reviewHTML += weakTopics.slice(0, 3).map(t => `<strong>${t.topic}</strong> (Week ${t.week})`).join(', ');
                reviewHTML += '.</div>';
            } else {
                reviewHTML += '<div class="ai-summary">';
                reviewHTML += `<strong>Excellent!</strong> You have a strong grasp across all topics. Keep up the great work!`;
                reviewHTML += '</div>';
            }

            // Show weak topics first
            if (weakTopics.length > 0) {
                reviewHTML += '<h4 style="color: #dc3545; margin-top: 20px;">âš ï¸ Topics Needing Attention:</h4>';
                weakTopics.forEach(topic => {
                    reviewHTML += `<div class="topic-analysis">`;
                    reviewHTML += `<div class="topic-name">Week ${topic.week}: ${topic.topic}</div>`;
                    reviewHTML += `<div class="topic-score">Accuracy: ${Math.round(topic.accuracy)}% (${topic.correct}/${topic.total} correct)</div>`;
                    reviewHTML += `</div>`;
                });
            }

            // Show strong topics
            if (strongTopics.length > 0) {
                reviewHTML += '<h4 style="color: #28a745; margin-top: 20px;">âœ… Topics You Mastered:</h4>';
                strongTopics.forEach(topic => {
                    reviewHTML += `<div class="topic-analysis good">`;
                    reviewHTML += `<div class="topic-name">Week ${topic.week}: ${topic.topic}</div>`;
                    reviewHTML += `<div class="topic-score">Accuracy: ${Math.round(topic.accuracy)}% (${topic.correct}/${topic.total} correct)</div>`;
                    reviewHTML += `</div>`;
                });
            }

            // Add recommendations
            if (weakTopics.length > 0) {
                reviewHTML += '<div class="recommendations">';
                reviewHTML += '<h4 style="color: #667eea;">ðŸ’¡ Recommendations:</h4>';

                weakTopics.slice(0, 3).forEach(topic => {
                    let recommendation = '';

                    // Customized recommendations based on topic
                    if (topic.topic.includes('NIIP')) {
                        recommendation = 'Review the relationship between Current Account flows and valuation changes. Practice calculating NIIP changes.';
                    } else if (topic.topic.includes('Dark Matter')) {
                        recommendation = 'Revisit the US NIIP-NII paradox. Understand both the Dark Matter hypothesis and Return Differential hypothesis.';
                    } else if (topic.topic.includes('Finite vs Infinite')) {
                        recommendation = 'Focus on the key difference: finite horizon has hard constraints (B_T=0), while infinite horizon has soft constraints (PVâ†’0).';
                    } else if (topic.topic.includes('Transversality')) {
                        recommendation = 'Remember: the transversality condition states that the PRESENT VALUE of debt must vanish, not the debt itself.';
                    } else if (topic.topic.includes('Perpetual Deficits')) {
                        recommendation = 'Study when perpetual CA deficits are sustainable. Key: debt must grow slower than interest rate (g < r).';
                    } else if (topic.topic.includes('Temporary vs Permanent')) {
                        recommendation = 'Master the principle: economies FINANCE temporary shocks (through borrowing) and ADJUST to permanent shocks (by changing consumption).';
                    } else if (topic.topic.includes('Euler')) {
                        recommendation = 'Practice deriving and interpreting the Euler equation. Understand how it relates to optimal intertemporal consumption choice.';
                    } else if (topic.topic.includes('Consumption Smoothing')) {
                        recommendation = 'Understand why households prefer stable consumption over time due to concave utility functions.';
                    } else {
                        recommendation = `Re-read the lecture notes on ${topic.topic} and try practice problems to strengthen your understanding.`;
                    }

                    reviewHTML += `<div class="recommendation-item">`;
                    reviewHTML += `<strong>Week ${topic.week} - ${topic.topic}:</strong> ${recommendation}`;
                    reviewHTML += `</div>`;
                });

                reviewHTML += '</div>';
            }

            document.getElementById('aiReview').innerHTML = reviewHTML;
        }

        function showResults() {
            // Count only answers that were correct on FIRST attempt
            let correct = 0;
            answeredCorrectly.forEach((isCorrect) => {
                if (isCorrect) {
                    correct++;
                }
            });

            const percentage = Math.round((correct / filteredQuestions.length) * 100);

            // Save to leaderboard
            saveToLeaderboard(userName, percentage, correct, filteredQuestions.length, currentWeek);

            document.getElementById('quizArea').style.display = 'none';
            document.getElementById('results').classList.add('show');

            document.getElementById('scoreCircle').textContent = percentage + '%';
            document.getElementById('correctCount').textContent = correct;
            document.getElementById('incorrectCount').textContent = filteredQuestions.length - correct;
            document.getElementById('totalCount').textContent = filteredQuestions.length;

            let title = 'Quiz Complete!';
            if (percentage === 100) title = `Perfect Score, ${userName}!`;
            else if (percentage >= 80) title = `Excellent Work, ${userName}!`;
            else if (percentage >= 60) title = `Good Job, ${userName}!`;
            else if (percentage >= 40) title = `Keep Practicing, ${userName}!`;

            document.getElementById('resultsTitle').textContent = title;

            // Generate AI performance analysis
            analyzePerformance();

            // Display leaderboard
            displayLeaderboard('finalLeaderboard');
        }

        function restartQuiz() {
            document.getElementById('results').classList.remove('show');
            document.getElementById('startScreen').style.display = 'block';
        }

        // ============== CHAT FUNCTIONALITY ==============
        let chatDatabase;
        let chatMessagesRef;

        // Initialize chat when Firebase loads
        function initializeChat() {
            if (typeof firebase !== 'undefined' && firebase.database) {
                chatDatabase = firebase.database();
                chatMessagesRef = chatDatabase.ref('chat');

                // Listen for new messages
                chatMessagesRef.on('child_added', (snapshot) => {
                    const message = snapshot.val();
                    displayChatMessage(message);
                });

                console.log('Chat initialized successfully');
            } else {
                console.error('Firebase not available for chat');
            }
        }

        function toggleChat() {
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.classList.toggle('show');

            if (chatContainer.classList.contains('show')) {
                // Scroll to bottom when opening
                setTimeout(() => {
                    const messagesContainer = document.getElementById('chatMessages');
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }, 100);
            }
        }

        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();

            if (!message) return;

            const userName = document.getElementById('userName').value.trim() || 'Anonymous';

            const messageData = {
                name: userName,
                message: message,
                timestamp: Date.now(),
                date: new Date().toLocaleString()
            };

            // Send to Firebase
            if (chatMessagesRef) {
                chatMessagesRef.push(messageData)
                    .then(() => {
                        input.value = '';
                        console.log('Message sent to chat');
                    })
                    .catch((error) => {
                        console.error('Error sending message:', error);
                        alert('Failed to send message. Please try again.');
                    });
            } else {
                alert('Chat is not connected. Please refresh the page.');
            }
        }

        function displayChatMessage(messageData) {
            const messagesContainer = document.getElementById('chatMessages');

            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message';

            const authorDiv = document.createElement('div');
            authorDiv.className = 'chat-message-author';
            authorDiv.textContent = messageData.name;

            const textDiv = document.createElement('div');
            textDiv.className = 'chat-message-text';
            textDiv.textContent = messageData.message;

            const timeDiv = document.createElement('div');
            timeDiv.className = 'chat-message-time';
            const messageDate = new Date(messageData.timestamp);
            timeDiv.textContent = messageDate.toLocaleTimeString();

            messageDiv.appendChild(authorDiv);
            messageDiv.appendChild(textDiv);
            messageDiv.appendChild(timeDiv);

            messagesContainer.appendChild(messageDiv);

            // Auto-scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Handle Enter key in chat input
        document.addEventListener('DOMContentLoaded', function() {
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendChatMessage();
                    }
                });
            }

            // Initialize chat after Firebase loads
            setTimeout(() => {
                initializeChat();
            }, 1000);
        });
    </script>

    <!-- Chat UI -->
    <button class="chat-toggle-btn" onclick="toggleChat()" title="Open Chat">
        ðŸ’¬
    </button>

    <div class="chat-container" id="chatContainer">
        <div class="chat-header">
            <span>ðŸ’¬ EC201 Chat</span>
            <button class="chat-close-btn" onclick="toggleChat()">Ã—</button>
        </div>
        <div class="chat-messages" id="chatMessages">
            <!-- Messages will appear here -->
        </div>
        <div class="chat-input-container">
            <input
                type="text"
                class="chat-input"
                id="chatInput"
                placeholder="Type a message..."
                maxlength="500"
            >
            <button class="chat-send-btn" onclick="sendChatMessage()">Send</button>
        </div>
    </div>
</body>
</html>
