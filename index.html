<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EC201 International Macroeconomics Quiz - Weeks 1-3</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            background-attachment: fixed;
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3), transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(102, 126, 234, 0.2), transparent 50%);
            pointer-events: none;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            box-shadow: 0 30px 80px rgba(0,0,0,0.4), 0 0 0 1px rgba(255,255,255,0.1);
            overflow: hidden;
            position: relative;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse"><path d="M 40 0 L 0 0 0 40" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            opacity: 0.5;
        }

        .logos-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            margin-bottom: 25px;
            position: relative;
            z-index: 1;
        }

        .header-logo {
            height: 70px;
            width: auto;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
            transition: transform 0.3s ease;
        }

        .header-logo:hover {
            transform: scale(1.05);
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 12px;
            font-weight: 700;
            letter-spacing: -0.5px;
            position: relative;
            z-index: 1;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 17px;
            opacity: 0.95;
            font-weight: 400;
            position: relative;
            z-index: 1;
        }

        .week-selector {
            display: flex;
            justify-content: center;
            gap: 12px;
            padding: 30px 20px;
            background: linear-gradient(180deg, #f8f9fa 0%, #ffffff 100%);
            flex-wrap: wrap;
            border-bottom: 1px solid #e9ecef;
        }

        .week-btn {
            padding: 14px 28px;
            border: 2px solid transparent;
            background: white;
            color: #667eea;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
            position: relative;
            overflow: hidden;
        }

        .week-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .week-btn:hover::before {
            left: 100%;
        }

        .week-btn:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
            border-color: transparent;
        }

        .week-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .quiz-area {
            padding: 30px;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e9ecef;
            border-radius: 10px;
            margin-bottom: 35px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.06);
            position: relative;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, rgba(255,255,255,0.3), transparent);
            border-radius: 10px 10px 0 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 30px;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4));
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        .question-card {
            display: none;
        }

        .question-card.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .question-number {
            font-size: 14px;
            color: #667eea;
            font-weight: 600;
        }

        .question-text {
            font-size: 20px;
            color: #2d3748;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option {
            padding: 20px 24px;
            border: 2px solid #e9ecef;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            position: relative;
            overflow: hidden;
        }

        .option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .option:hover::before {
            transform: scaleY(1);
        }

        .option:hover {
            border-color: #667eea;
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            transform: translateX(8px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #edf2f7 0%, #e6f2ff 100%);
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.2);
        }

        .option.selected::before {
            transform: scaleY(1);
        }

        .option.correct {
            border-color: #48bb78;
            background: linear-gradient(135deg, #f0fff4 0%, #dcffe4 100%);
            box-shadow: 0 4px 16px rgba(72, 187, 120, 0.2);
        }

        .option.correct::before {
            background: #48bb78;
            transform: scaleY(1);
        }

        .option.incorrect {
            border-color: #f56565;
            background: linear-gradient(135deg, #fff5f5 0%, #ffebeb 100%);
            box-shadow: 0 4px 16px rgba(245, 101, 101, 0.2);
        }

        .option.incorrect::before {
            background: #f56565;
            transform: scaleY(1);
        }

        .option-label {
            font-weight: 600;
            color: #667eea;
            margin-right: 10px;
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }

        .feedback.show {
            display: block;
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .feedback.correct {
            background: #f0fff4;
            border-left: 4px solid #48bb78;
            color: #22543d;
        }

        .feedback.incorrect {
            background: #fff5f5;
            border-left: 4px solid #f56565;
            color: #742a2a;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: space-between;
        }

        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%);
            color: #2d3748;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #dee2e6 0%, #e9ecef 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .results {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .results.show {
            display: block;
            animation: fadeIn 0.5s;
        }

        .score-circle {
            width: 220px;
            height: 220px;
            margin: 0 auto 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 56px;
            font-weight: 800;
            box-shadow:
                0 15px 40px rgba(102, 126, 234, 0.4),
                0 0 0 10px rgba(102, 126, 234, 0.1),
                0 0 0 20px rgba(102, 126, 234, 0.05);
            position: relative;
            animation: scoreReveal 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes scoreReveal {
            0% {
                transform: scale(0) rotate(-180deg);
                opacity: 0;
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        .score-circle::before {
            content: '';
            position: absolute;
            inset: -3px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            opacity: 0.5;
            filter: blur(10px);
            z-index: -1;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 0.5;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.3;
            }
        }

        .results h2 {
            font-size: 32px;
            color: #2d3748;
            margin-bottom: 20px;
        }

        .results-details {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .result-stat {
            text-align: center;
        }

        .result-stat-value {
            font-size: 36px;
            font-weight: bold;
            color: #667eea;
        }

        .result-stat-label {
            font-size: 14px;
            color: #718096;
            margin-top: 5px;
        }

        .start-screen {
            text-align: center;
            padding: 60px 40px;
        }

        .start-screen h2 {
            font-size: 32px;
            color: #2d3748;
            margin-bottom: 20px;
        }

        .start-screen p {
            font-size: 18px;
            color: #718096;
            margin-bottom: 40px;
            line-height: 1.8;
        }

        .week-description {
            background: #f7fafc;
            padding: 20px;
            border-radius: 12px;
            margin: 30px 0;
            text-align: left;
        }

        .week-description h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .week-description ul {
            list-style-position: inside;
            color: #4a5568;
            line-height: 2;
        }

        .name-input-section {
            margin: 30px 0;
        }

        .name-input {
            padding: 18px 24px;
            font-size: 17px;
            border: 2px solid #e9ecef;
            border-radius: 14px;
            width: 100%;
            max-width: 450px;
            margin: 10px auto;
            display: block;
            text-align: center;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .name-input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.15);
            transform: translateY(-2px);
        }

        .name-input::placeholder {
            color: #adb5bd;
            font-weight: 400;
        }

        .ai-review-section {
            background: linear-gradient(135deg, #f5f7fa 0%, #e8edf4 100%);
            padding: 30px;
            border-radius: 12px;
            margin-top: 30px;
            text-align: left;
            border: 2px solid #667eea;
        }

        .ai-review-section h3 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
            font-size: 24px;
        }

        .ai-review-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            line-height: 1.8;
        }

        .ai-loading {
            text-align: center;
            color: #667eea;
            font-style: italic;
            padding: 20px;
        }

        .topic-analysis {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #dc3545;
            border-radius: 4px;
        }

        .topic-analysis.good {
            border-left-color: #28a745;
        }

        .topic-analysis.okay {
            border-left-color: #ffc107;
        }

        .topic-name {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .topic-score {
            font-size: 14px;
            color: #718096;
        }

        .ai-summary {
            background: #667eea;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .recommendations {
            margin-top: 20px;
        }

        .recommendation-item {
            padding: 10px;
            margin: 10px 0;
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            border-radius: 4px;
        }

        .leaderboard-section {
            background: #f7fafc;
            padding: 30px;
            border-radius: 12px;
            margin-top: 30px;
            text-align: left;
        }

        .leaderboard-section h3 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
            font-size: 24px;
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
        }

        .leaderboard-table th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        .leaderboard-table td {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
        }

        .leaderboard-table tr:hover {
            background: #edf2f7;
        }

        .rank-badge {
            display: inline-block;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            font-size: 14px;
        }

        .rank-badge.gold {
            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
        }

        .rank-badge.silver {
            background: linear-gradient(135deg, #a8b8d8 0%, #c7d2e9 100%);
        }

        .rank-badge.bronze {
            background: linear-gradient(135deg, #cd7f32 0%, #d4926f 100%);
        }

        .share-section {
            margin-top: 30px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 12px;
        }

        .share-section h4 {
            color: #2d3748;
            margin-bottom: 15px;
        }

        .share-link {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .share-link input {
            flex: 1;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
        }

        .btn-copy {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-copy:hover {
            background: #5568d3;
        }

        .user-greeting {
            text-align: center;
            padding: 20px;
            background: #f7fafc;
            color: #2d3748;
            font-size: 18px;
        }

        .user-greeting strong {
            color: #667eea;
        }

        .no-leaderboard {
            text-align: center;
            color: #718096;
            padding: 20px;
            font-style: italic;
        }

        .view-leaderboard-btn {
            margin-top: 20px;
            padding: 12px 24px;
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
        }

        .view-leaderboard-btn:hover {
            background: #667eea;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logos-container">
                <img src="Warwick_University_Shield.svg.png" alt="Warwick Shield" class="header-logo">
                <img src="u_of_w_third_party_lockup_positive_rgb.jpg" alt="University of Warwick" class="header-logo">
            </div>
            <h1>EC201 International Macroeconomics</h1>
            <p>MCQ Assessment - Weeks 1-5</p>
        </div>

        <div style="background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); border-radius: 15px; padding: 20px; margin: 20px auto; max-width: 900px; border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);">
            <p style="margin: 0; font-size: 0.95em; line-height: 1.6; color: #fff; text-align: center;">
                <strong>üìä AI-Enhanced Assessment:</strong> These questions have been derived from all content uploaded to Moodle for EC201 using AI analysis, including pre-class questions, pre-class answers, in-class questions, lecture slides, and course materials. The questions are designed to reflect concepts with higher likelihood of exam appearance based on comprehensive content analysis.
            </p>
        </div>

        <div class="week-selector">
            <button class="week-btn active" data-week="all">All Weeks</button>
            <button class="week-btn" data-week="1">Week 1: Global Imbalances</button>
            <button class="week-btn" data-week="2">Week 2: Sustainability</button>
            <button class="week-btn" data-week="3">Week 3: Current Account Theory</button>
            <button class="week-btn" data-week="4">Week 4: Terms of Trade & Tariffs</button>
            <button class="week-btn" data-week="5">Week 5: Production Economy</button>
        </div>

        <div id="startScreen" class="start-screen">
            <h2>Ready to Test Your Knowledge?</h2>
            <p>This quiz covers key concepts from the first three weeks of EC201 International Macroeconomics.</p>

            <div class="name-input-section">
                <label for="userName" style="display: block; margin-bottom: 10px; font-weight: 600; color: #2d3748;">Enter Your Name:</label>
                <input type="text" id="userName" class="name-input" placeholder="Your name..." required>
            </div>

            <div class="week-description">
                <h3>Topics Covered:</h3>
                <ul>
                    <li>Balance of Payments and Current Account components</li>
                    <li>Net International Investment Position (NIIP)</li>
                    <li>Global imbalances and creditor/debtor nations</li>
                    <li>Trade balance and current account sustainability</li>
                    <li>Small open economy model</li>
                    <li>Temporary vs permanent shocks</li>
                    <li>Consumption smoothing and intertemporal choice</li>
                </ul>
            </div>

            <button class="btn btn-primary" onclick="startQuiz()" style="font-size: 18px; padding: 18px 36px;">Start Quiz</button>
            <button class="btn view-leaderboard-btn" onclick="showLeaderboardOnly()">View Leaderboard</button>

            <div id="leaderboardDisplay" class="leaderboard-section" style="display: none;">
                <h3>üèÜ Leaderboard</h3>
                <div id="leaderboardContent"></div>
            </div>
        </div>

        <div id="quizArea" class="quiz-area" style="display: none;">
            <div class="user-greeting" id="userGreeting"></div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div id="questionContainer"></div>

            <div class="button-group">
                <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()">Previous</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" disabled>Next Question</button>
            </div>
        </div>

        <div id="results" class="results">
            <div class="score-circle" id="scoreCircle">0%</div>
            <h2 id="resultsTitle">Quiz Complete!</h2>
            <div class="results-details">
                <div class="result-stat">
                    <div class="result-stat-value" id="correctCount">0</div>
                    <div class="result-stat-label">Correct</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-value" id="incorrectCount">0</div>
                    <div class="result-stat-label">Incorrect</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-value" id="totalCount">0</div>
                    <div class="result-stat-label">Total Questions</div>
                </div>
            </div>

            <div id="aiReviewSection" class="ai-review-section">
                <h3>üìä AI Performance Analysis</h3>
                <div id="aiReview" class="ai-review-content">
                    <div class="ai-loading">Analyzing your performance...</div>
                </div>
            </div>

            <div class="leaderboard-section">
                <h3>üèÜ Leaderboard</h3>
                <div id="finalLeaderboard"></div>
            </div>

            <button class="btn btn-primary" onclick="restartQuiz()" style="margin-top: 30px;">Restart Quiz</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAeRv3FnOy8-pNoqZWRmh-Wbj41rpQExlo",
            authDomain: "ec201-c1bb6.firebaseapp.com",
            databaseURL: "https://ec201-c1bb6-default-rtdb.firebaseio.com",
            projectId: "ec201-c1bb6",
            storageBucket: "ec201-c1bb6.firebasestorage.app",
            messagingSenderId: "579096241028",
            appId: "1:579096241028:web:972f85a4161e1309c9f3d1",
            measurementId: "G-94G3LFX721"
        };

        // Initialize Firebase
        let database;
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            console.log('Firebase initialized successfully');
        } catch (error) {
            console.error('Firebase initialization error:', error);
            database = null;
        }

        const questions = [
            // Week 1: Global Imbalances (15 challenging questions)
            {
                week: 1,
                topic: "Balance of Payments Components",
                question: "Consider a country with TB = -50, Net Investment Income = 30, Net Compensation to Employees = -5, and Net Unilateral Transfers = 10. What is the Current Account balance?",
                options: [
                    "CA = -35 (the trade deficit partially offsets the investment income surplus)",
                    "CA = -15 (TB + NII + NCE + NUT = -50 + 30 - 5 + 10)",
                    "CA = -25 (only TB and NII are included in CA)",
                    "CA = 15 (net investment income dominates the calculation)"
                ],
                correct: 1,
                explanation: "CA = TB + Net Investment Income + Net Compensation to Employees + Net Unilateral Transfers = -50 + 30 - 5 + 10 = -15. All four components must be included."
            },
            {
                week: 1,
                topic: "Balance of Payments Components",
                question: "If a country's Financial Account shows +$200 billion (capital inflows), the BoP identity implies:",
                options: [
                    "Current Account must be approximately -$200 billion (BoP ‚âà 0)",
                    "Current Account must be +$200 billion (they move together)",
                    "Trade Balance must equal +$200 billion exactly",
                    "Capital Account must be -$200 billion to offset the Financial Account"
                ],
                correct: 0,
                explanation: "By the BoP identity: CA + Financial Account + Capital Account ‚âà 0. Large capital inflows (+$200B FA) typically reflect financing of a CA deficit (approximately -$200B CA)."
            },
            {
                week: 1,
                topic: "NIIP and Valuation",
                question: "A country has NIIP‚ÇÄ = -$500B. Over one year, it runs CA = -$100B, but NIIP‚ÇÅ = -$550B (not -$600B). What explains the $50B discrepancy?",
                options: [
                    "Measurement error in the current account statistics",
                    "+$50B positive valuation effect (e.g., domestic currency depreciation increased value of foreign assets)",
                    "-$50B negative valuation effect (e.g., foreign liabilities appreciated more than assets)",
                    "The Financial Account must have been incorrectly recorded"
                ],
                correct: 1,
                explanation: "NIIP‚ÇÅ = NIIP‚ÇÄ + CA + Valuation Changes. Expected: -500 - 100 = -600, but actual is -550. The +$50B difference comes from positive valuation effects (e.g., FX movements, asset price changes)."
            },
            {
                week: 1,
                topic: "NIIP and Valuation",
                question: "During a period of domestic currency depreciation, which valuation effect is most likely for a country whose foreign assets are denominated in foreign currency and foreign liabilities in domestic currency?",
                options: [
                    "Negative valuation effect: both assets and liabilities increase proportionally",
                    "Positive valuation effect: foreign assets rise in domestic currency value while liabilities remain stable",
                    "Neutral effect: currency movements don't affect NIIP",
                    "Ambiguous effect: depends entirely on the magnitude of the trade balance"
                ],
                correct: 1,
                explanation: "Currency depreciation causes foreign-currency-denominated assets to rise in domestic currency value, while domestic-currency liabilities remain constant‚Äîcreating positive valuation effects that improve NIIP."
            },
            {
                week: 1,
                topic: "Global Creditors and Debtors",
                question: "How can the US maintain a large negative NIIP (-$18 trillion, 2023) but still receive positive Net Investment Income?",
                options: [
                    "This is impossible‚Äînegative NIIP must imply negative NII",
                    "Return Differential: US foreign assets (equity, FDI) earn higher returns than US liabilities (bonds)",
                    "Dark Matter: unmeasured intangible assets generate hidden income streams",
                    "Both B and C contribute to explaining the NIIP-NII paradox"
                ],
                correct: 3,
                explanation: "Both hypotheses explain the paradox: (1) Return Differential‚ÄîUS invests abroad in high-return equity/FDI while foreigners hold low-return US Treasuries; (2) Dark Matter‚Äîunmeasured intangibles (brands, know-how) generate income."
            },
            {
                week: 1,
                topic: "NIIP and Valuation",
                question: "Between 2002-2007, the US ran cumulative CA deficits of $3.9 trillion, yet NIIP improved by $80 billion. If valuation effects were +$4 trillion, what is the approximate breakdown?",
                options: [
                    "NIIP change = CA + Valuation: +$80B = -$3.9T + $4T",
                    "NIIP change = CA only: the $4T valuation is separate",
                    "NIIP change = Valuation only: CA deficits don't affect NIIP",
                    "The numbers are inconsistent and indicate measurement error"
                ],
                correct: 0,
                explanation: "ŒîNIIP = CA + Valuation. Here: +$80B = -$3,900B + $4,000B. The massive positive valuation effects (+$4T) more than offset the CA deficits (-$3.9T), improving NIIP."
            },
            {
                week: 1,
                topic: "Dark Matter and Return Differential",
                question: "The Return Differential hypothesis suggests the US benefits from 'exorbitant privilege.' Which statement best characterizes this privilege?",
                options: [
                    "The US can print unlimited currency without inflationary consequences",
                    "The US borrows cheaply (safe Treasury bonds at low rates) and invests abroad in high-return risky assets (equity, FDI)",
                    "The US pays no interest on its foreign liabilities",
                    "Foreign countries are legally required to hold US assets regardless of returns"
                ],
                correct: 1,
                explanation: "Exorbitant privilege: US borrows globally at low rates (safe haven status‚Äîforeigners hold Treasuries) while investing abroad in high-return assets (stocks, FDI), earning positive return differential despite negative NIIP."
            },
            {
                week: 1,
                topic: "Dark Matter and Return Differential",
                question: "Hausmann and Sturzenegger's 'Dark Matter' hypothesis posits that US NIIP is mismeasured. Which of these is the strongest criticism of this hypothesis?",
                options: [
                    "Intangible assets (brands, know-how) are impossible to value precisely",
                    "Return differentials can explain the NIIP-NII paradox without assuming hidden assets",
                    "Dark matter violates international accounting standards",
                    "The hypothesis has been definitively proven false by empirical data"
                ],
                correct: 1,
                explanation: "The main criticism is that return differentials (observable differences in asset returns) can explain the paradox without invoking unmeasured intangibles. Dark matter is hard to verify empirically; return differentials are measurable."
            },
            {
                week: 1,
                topic: "Balance of Payments Components",
                question: "A country has Net Investment Income = +50 but NIIP = -1000 (net debtor). Which scenario best explains this?",
                options: [
                    "Impossible: net debtors must have negative investment income",
                    "Rate of return earned on foreign assets exceeds rate paid on foreign liabilities despite negative NIIP",
                    "Current account surplus is so large it dominates the calculation",
                    "The country has defaulted on its foreign debt obligations"
                ],
                correct: 1,
                explanation: "NII = (return on assets √ó assets) - (return on liabilities √ó liabilities). Even with negative NIIP, if return on assets >> return on liabilities, NII can be positive (the NIIP-NII paradox)."
            },
            {
                week: 1,
                topic: "NIIP and Valuation",
                question: "Suppose Country A's foreign assets are primarily equity holdings, and foreign liabilities are primarily bonds. A global stock market boom would most likely:",
                options: [
                    "Deteriorate NIIP as both assets and liabilities rise equally",
                    "Improve NIIP as foreign equity assets appreciate while bond liabilities remain stable",
                    "Have no effect on NIIP since market values don't matter for BoP accounting",
                    "Improve NIIP only if the country simultaneously runs a current account surplus"
                ],
                correct: 1,
                explanation: "Stock market boom increases value of equity assets while bond liabilities remain stable (bonds are fixed-income), creating positive valuation effects that improve NIIP. This is independent of current CA position."
            },
            {
                week: 1,
                topic: "Global Creditors and Debtors",
                question: "Japan, China, and Germany are major net creditors with NIIP > 0. Which of the following is the most accurate implication?",
                options: [
                    "These countries must always run current account surpluses",
                    "These countries likely earn positive Net Investment Income, reinforcing CA surpluses",
                    "These countries have no foreign liabilities",
                    "These countries cannot experience valuation losses on their foreign assets"
                ],
                correct: 1,
                explanation: "Positive NIIP (net creditors) typically generates positive NII (investment income on net foreign assets), which reinforces CA surpluses. However, they can run CA deficits in some periods, and valuation losses are possible."
            },
            {
                week: 1,
                topic: "Balance of Payments Components",
                question: "The Income Balance includes Net Investment Income (NII) and Net Compensation to Employees (NCE). If NII = +100 and NCE = -20, what does this indicate?",
                options: [
                    "The country's workers abroad send home more than foreign workers in the country",
                    "The country earns net +80 from both capital income and labor income combined",
                    "The country's foreign investment returns (+100) exceed compensation paid to foreign workers domestically (-20), netting +80",
                    "The trade balance must be positive to offset the negative NCE"
                ],
                correct: 2,
                explanation: "Income Balance = NII + NCE = 100 - 20 = +80. NII > 0 means returns on foreign assets exceed payments on liabilities; NCE < 0 means compensation paid to foreign workers domestically exceeds compensation to domestic workers abroad."
            },
            {
                week: 1,
                topic: "NIIP and Valuation",
                question: "Which of the following events would cause valuation changes to NIIP without affecting the current account?",
                options: [
                    "An increase in exports due to higher global demand",
                    "A domestic stock market crash that reduces the value of foreigners' equity holdings in the country",
                    "A reduction in government spending on imports",
                    "An increase in Net Investment Income due to higher interest rates abroad"
                ],
                correct: 1,
                explanation: "Stock market crash affecting foreign-held domestic equity creates valuation changes (reduces foreign liabilities ‚Üí improves NIIP) without affecting CA. Options A, C, D all affect CA directly through trade or income flows."
            },
            {
                week: 1,
                topic: "Dark Matter and Return Differential",
                question: "A refined version of the Dark Matter hypothesis would suggest that if US intangible assets (brands, technology, know-how) were properly measured and capitalized, the US NIIP would be:",
                options: [
                    "Even more negative (larger debtor position)",
                    "Less negative or possibly positive (hidden assets reduce net liability position)",
                    "Unchanged (intangibles don't appear in NIIP calculations)",
                    "Exactly zero (intangibles perfectly offset measured liabilities)"
                ],
                correct: 1,
                explanation: "Dark Matter posits unmeasured intangible assets (brands like Coca-Cola, tech like Microsoft, managerial know-how) that generate income. Capitalizing these would add to US foreign assets, improving (making less negative or positive) NIIP."
            },
            {
                week: 1,
                topic: "Global Creditors and Debtors",
                question: "Consider two countries: Country X (NIIP = +500, NII = +30) and Country Y (NIIP = -500, NII = -10). The return differential (rate of return gap) is larger for:",
                options: [
                    "Country X: earning 6% average return on net assets",
                    "Country Y: paying only 2% average on net liabilities (expected would be higher)",
                    "Both countries exhibit similar return profiles",
                    "Cannot determine without knowing the composition of assets and liabilities"
                ],
                correct: 1,
                explanation: "Country X: 30/500 = 6% (normal return). Country Y: 10/500 = 2% payment rate on net liabilities‚Äîsurprisingly low for a debtor. This suggests Y has a favorable return differential (paying less than expected), similar to US 'exorbitant privilege'."
            },

            // Week 2: Sustainability (15 challenging questions)
            {
                week: 2,
                topic: "Finite vs Infinite Horizon",
                question: "In a two-period model with B‚ÇÄ = -200, r = 0.05, if TB‚ÇÅ = -10, what TB‚ÇÇ is required to satisfy the terminal condition B‚ÇÇ = 0?",
                options: [
                    "TB‚ÇÇ = 210 (simply repay the initial debt)",
                    "TB‚ÇÇ = 220.5 (must cover accumulated debt: (1+r)(B‚ÇÄ(1+r) + TB‚ÇÅ) = (1.05)(-210 - 10) = -220.5)",
                    "TB‚ÇÇ = 200 (only repay principal)",
                    "TB‚ÇÇ = 231 (account for compounding on both periods)"
                ],
                correct: 1,
                explanation: "B‚ÇÅ = (1+r)B‚ÇÄ + TB‚ÇÅ = 1.05(-200) + (-10) = -220. Then B‚ÇÇ = (1+r)B‚ÇÅ + TB‚ÇÇ = 0 implies TB‚ÇÇ = -1.05(-220) = 231. But using the PV formula: (1+r)B‚ÇÄ = -TB‚ÇÅ - TB‚ÇÇ/(1+r) ‚Üí 1.05(-200) = -(-10) - TB‚ÇÇ/1.05 ‚Üí TB‚ÇÇ = 220.5."
            },
            {
                week: 2,
                topic: "Transversality Condition",
                question: "The transversality condition states lim(T‚Üí‚àû) B‚Çú/(1+r)·µÄ = 0. Which debt path satisfies this for r = 0.05?",
                options: [
                    "B‚Çú = -100(1.05)·µó (debt grows at rate r)",
                    "B‚Çú = -100(1.03)·µó (debt grows slower than r at 3%)",
                    "B‚Çú = -100(1.07)·µó (debt grows faster than r at 7%)",
                    "B‚Çú = -100 for all t (constant debt)"
                ],
                correct: 1,
                explanation: "For transversality: lim B‚Çú/(1+r)·µÄ = 0. (A) lim -100(1.05)·µó/(1.05)·µó = -100 ‚â† 0. (B) lim -100(1.03)·µó/(1.05)·µó = 0 since 1.03 < 1.05. (C) grows too fast. (D) lim -100/(1.05)·µó = 0 also works, but B is the debt-growth scenario."
            },
            {
                week: 2,
                topic: "Perpetual Deficits",
                question: "A country with B‚ÇÄ = -1000 and r = 0.04 follows the policy TB‚Çú = -Œ±rB‚Çú‚Çã‚ÇÅ with Œ± = 0.5. What is TB‚ÇÅ and the resulting CA‚ÇÅ?",
                options: [
                    "TB‚ÇÅ = +20, CA‚ÇÅ = -20 (must run trade surplus, but CA still in deficit)",
                    "TB‚ÇÅ = -20, CA‚ÇÅ = +20 (trade deficit dominates)",
                    "TB‚ÇÅ = +20, CA‚ÇÅ = +20 (both in surplus)",
                    "TB‚ÇÅ = -20, CA‚ÇÅ = -60 (trade deficit plus interest payments)"
                ],
                correct: 0,
                explanation: "TB‚ÇÅ = -Œ±rB‚ÇÄ = -0.5(0.04)(-1000) = +20 (trade surplus pays half the interest). CA‚ÇÅ = TB‚ÇÅ + rB‚ÇÄ = 20 + 0.04(-1000) = 20 - 40 = -20 (CA deficit as only half interest is paid via TB)."
            },
            {
                week: 2,
                topic: "Debt Growth and Sustainability",
                question: "Following the debt-servicing policy TB‚Çú = -Œ±rB‚Çú‚Çã‚ÇÅ with Œ± = 0.6 and r = 0.05, at what rate does debt grow?",
                options: [
                    "g = 0.05 (same as interest rate)",
                    "g = 0.03 (explicitly r(1-Œ±) = 0.05(1-0.6) = 0.02)",
                    "g = 0.02 (g = r(1-Œ±) = 0.05(0.4) = 0.02)",
                    "g = 0.08 (compounds both r and Œ±)"
                ],
                correct: 2,
                explanation: "Under debt-servicing policy, debt grows at g = r(1-Œ±). Here: g = 0.05(1 - 0.6) = 0.05(0.4) = 0.02 or 2%. This is slower than r, ensuring transversality is satisfied."
            },
            {
                week: 2,
                topic: "Finite vs Infinite Horizon",
                question: "Compare finite vs infinite horizon for a net debtor (B‚ÇÄ < 0). Which statement is correct?",
                options: [
                    "Both require TB surpluses in every period",
                    "Finite: must eventually run TB surpluses to reach B_T=0; Infinite: can run perpetual CA deficits if g < r",
                    "Infinite is stricter because it requires immediate debt repayment",
                    "Both allow perpetual TB deficits as long as GDP grows"
                ],
                correct: 1,
                explanation: "Finite horizon (B_T = 0) requires actual repayment via TB surpluses eventually. Infinite horizon allows perpetual CA deficits (but not TB deficits) if debt grows slower than interest rate (transversality: g < r)."
            },
            {
                week: 2,
                topic: "Accounting Identities",
                question: "Given B‚ÇÄ = -500, r = 0.06, TB‚ÇÅ = +15, calculate B‚ÇÅ using B‚Çú = (1+r)B‚Çú‚Çã‚ÇÅ + TB‚Çú:",
                options: [
                    "B‚ÇÅ = -530 (lose track of interest compounding)",
                    "B‚ÇÅ = -515 (simple addition: -500 + 15)",
                    "B‚ÇÅ = -515 (B‚ÇÅ = 1.06(-500) + 15 = -530 + 15 = -515)",
                    "B‚ÇÅ = -470 (incorrectly add interest)"
                ],
                correct: 2,
                explanation: "B‚ÇÅ = (1+r)B‚ÇÄ + TB‚ÇÅ = 1.06(-500) + 15 = -530 + 15 = -515. The debt accumulates interest, then trade surplus partially offsets it."
            },
            {
                week: 2,
                topic: "Accounting Identities",
                question: "If CA‚ÇÅ = -50 and B‚ÇÄ = -300 with r = 0.05, what is TB‚ÇÅ? Use CA‚ÇÅ = TB‚ÇÅ + rB‚ÇÄ:",
                options: [
                    "TB‚ÇÅ = -50 (CA and TB are the same)",
                    "TB‚ÇÅ = -35 (CA‚ÇÅ = TB‚ÇÅ + rB‚ÇÄ ‚Üí -50 = TB‚ÇÅ + 0.05(-300) ‚Üí TB‚ÇÅ = -50 + 15 = -35)",
                    "TB‚ÇÅ = -65 (CA‚ÇÅ = TB‚ÇÅ - rB‚ÇÄ ‚Üí TB‚ÇÅ = -50 - 15)",
                    "TB‚ÇÅ = -15 (only interest component)"
                ],
                correct: 1,
                explanation: "CA‚ÇÅ = TB‚ÇÅ + rB‚ÇÄ. Given CA‚ÇÅ = -50, B‚ÇÄ = -300, r = 0.05: -50 = TB‚ÇÅ + 0.05(-300) ‚Üí -50 = TB‚ÇÅ - 15 ‚Üí TB‚ÇÅ = -35. Net investment income = rB‚ÇÄ = -15 worsens the CA relative to TB."
            },
            {
                week: 2,
                topic: "Perpetual Deficits",
                question: "In infinite horizon, which combination is possible for a net debtor under a sustainable debt-servicing policy?",
                options: [
                    "Perpetual CA deficits + Perpetual TB deficits (both can be sustained indefinitely)",
                    "Perpetual CA deficits + Perpetual TB surpluses (CA deficit as only partial interest paid via TB surplus)",
                    "Perpetual CA surpluses + Perpetual TB deficits (interest income dominates trade)",
                    "Neither CA nor TB deficits are sustainable for a net debtor"
                ],
                correct: 1,
                explanation: "Net debtor with TB‚Çú = -Œ±rB‚Çú‚Çã‚ÇÅ (Œ± ‚àà (0,1)): TB > 0 (surplus pays fraction of interest), but CA = TB + rB < 0 (deficit as only partial interest paid). Perpetual TB deficits violate resource constraints."
            },
            {
                week: 2,
                topic: "Debt Growth and Sustainability",
                question: "A country maintains Œ± = 0.4 (pays 40% of interest via trade surplus), r = 0.05, and GDP grows at 3% annually. Is this sustainable in infinite horizon?",
                options: [
                    "Yes, because GDP growth (3%) > debt growth g = r(1-Œ±) = 0.05(0.6) = 3%",
                    "No, because GDP growth (3%) = debt growth (3%), creating instability",
                    "Yes, because GDP growth (3%) ‚â• debt growth (3%), maintaining debt-to-GDP ratio stability",
                    "No, because GDP growth must exceed r, not just g"
                ],
                correct: 2,
                explanation: "Debt grows at g = r(1-Œ±) = 0.05(0.6) = 0.03 = 3%. GDP also grows at 3%. Since GDP growth ‚â• debt growth, debt-to-GDP ratio is stable/declining. This satisfies sustainability (transversality + economic feasibility)."
            },
            {
                week: 2,
                topic: "Finite vs Infinite Horizon",
                question: "In a two-period model (T=2), the present value sustainability condition is (1+r)B‚ÇÄ = -TB‚ÇÅ - TB‚ÇÇ/(1+r). If B‚ÇÄ = -100, r = 0.1, TB‚ÇÅ = 20, what TB‚ÇÇ is required?",
                options: [
                    "TB‚ÇÇ = 80 (simple arithmetic: 100 - 20)",
                    "TB‚ÇÇ = 90 (PV calculation: 1.1(-100) = -20 - TB‚ÇÇ/1.1 ‚Üí -110 = -20 - TB‚ÇÇ/1.1 ‚Üí TB‚ÇÇ/1.1 = 90 ‚Üí TB‚ÇÇ = 99)",
                    "TB‚ÇÇ = 99 (from rearranging: TB‚ÇÇ = 1.1[20 + 1.1(-100)] = 1.1[20 - 110] = 1.1(-90) magnitude error)",
                    "TB‚ÇÇ = 99 (correctly: (1+r)B‚ÇÄ = -TB‚ÇÅ - TB‚ÇÇ/(1+r) ‚Üí 1.1(-100) = -20 - TB‚ÇÇ/1.1 ‚Üí -110 + 20 = -TB‚ÇÇ/1.1 ‚Üí -90 = -TB‚ÇÇ/1.1 ‚Üí TB‚ÇÇ = 99)"
                ],
                correct: 3,
                explanation: "(1+r)B‚ÇÄ = -TB‚ÇÅ - TB‚ÇÇ/(1+r). Substituting: 1.1(-100) = -20 - TB‚ÇÇ/1.1 ‚Üí -110 = -20 - TB‚ÇÇ/1.1 ‚Üí -90 = -TB‚ÇÇ/1.1 ‚Üí TB‚ÇÇ = 99. Need a large period-2 surplus to satisfy terminal condition."
            },
            {
                week: 2,
                topic: "Transversality Condition",
                question: "Which economic interpretation best describes why the transversality condition lim B‚Çú/(1+r)·µó = 0 is called the 'No-Ponzi-Game' condition?",
                options: [
                    "It prevents governments from running any deficits",
                    "It prevents perpetual 'rolling over' of debt without ever repaying in present value terms",
                    "It requires debt to be exactly zero in finite time",
                    "It mandates balanced budgets in every period"
                ],
                correct: 1,
                explanation: "The No-Ponzi-Game condition prevents countries from perpetually borrowing new funds to pay interest without ever repaying in present value. Debt can grow, but not faster than r‚Äîits present value must eventually vanish."
            },
            {
                week: 2,
                topic: "Perpetual Deficits",
                question: "Why can a net debtor run perpetual CA deficits in infinite horizon but NOT perpetual TB deficits?",
                options: [
                    "TB involves real resources (goods/services) that must be repaid eventually; CA includes financial flows that can be rolled over",
                    "CA is measured incorrectly in national accounts",
                    "TB deficits are prohibited by international law",
                    "CA deficits don't affect debt, but TB deficits do"
                ],
                correct: 0,
                explanation: "TB represents real resource flows (exports minus imports). Perpetual TB deficit means never repaying real resources‚Äîviolates resource constraints. CA includes interest payments; running CA deficits while maintaining TB surpluses (paying partial interest) is feasible."
            },
            {
                week: 2,
                topic: "Accounting Identities",
                question: "The evolution equation B‚Çú = (1+r)B‚Çú‚Çã‚ÇÅ + TB‚Çú can be rearranged to show TB‚Çú = B‚Çú - (1+r)B‚Çú‚Çã‚ÇÅ. What does this reveal about TB when debt is constant (B‚Çú = B‚Çú‚Çã‚ÇÅ = B)?",
                options: [
                    "TB = 0 (no trade activity)",
                    "TB = rB (trade balance exactly offsets interest to keep debt constant)",
                    "TB = -rB (need a surplus of rB magnitude to offset interest on negative B; if B < 0, TB > 0)",
                    "TB = B (trade equals debt)"
                ],
                correct: 2,
                explanation: "If B‚Çú = B‚Çú‚Çã‚ÇÅ = B (constant debt): TB = B - (1+r)B = B - B - rB = -rB. For net debtor (B < 0), this means TB = -r(B) > 0‚Äîmust run trade surplus equal to interest to stabilize debt."
            },
            {
                week: 2,
                topic: "Debt Growth and Sustainability",
                question: "A country with B‚ÇÄ = -2000, r = 0.04, follows Œ± = 0.75 policy. After many periods, if this is sustained, the debt-to-GDP ratio will:",
                options: [
                    "Explode to infinity as debt grows without bound",
                    "Converge to a stable ratio if GDP growth g_Y ‚â• r(1-Œ±) = 0.01",
                    "Immediately jump to zero",
                    "Oscillate unpredictably"
                ],
                correct: 1,
                explanation: "Debt grows at g = r(1-Œ±) = 0.04(0.25) = 0.01 = 1%. If GDP grows ‚â•1%, debt-to-GDP ratio stabilizes or declines. If GDP growth < 1%, ratio rises (unsustainable). The policy is sustainable if g_Y ‚â• 0.01."
            },
            {
                week: 2,
                topic: "Finite vs Infinite Horizon",
                question: "In the two-period model, suppose B‚ÇÄ = 0 (initial balanced position), and the country wishes to run TB‚ÇÅ = -100 (deficit). What TB‚ÇÇ is needed to satisfy B‚ÇÇ = 0 if r = 0.05?",
                options: [
                    "TB‚ÇÇ = +100 (simply reverse the deficit)",
                    "TB‚ÇÇ = +105 (repay principal plus interest: (1+r) √ó 100)",
                    "TB‚ÇÇ = +110.25 (compound interest on borrowed amount)",
                    "TB‚ÇÇ = +95 (discount back)"
                ],
                correct: 1,
                explanation: "B‚ÇÅ = (1+r)B‚ÇÄ + TB‚ÇÅ = 1.05(0) + (-100) = -100. To reach B‚ÇÇ = 0: B‚ÇÇ = (1+r)B‚ÇÅ + TB‚ÇÇ = 0 ‚Üí 1.05(-100) + TB‚ÇÇ = 0 ‚Üí TB‚ÇÇ = 105. Must repay principal (100) plus interest (5)."
            },

            // Week 3: Theory of Current Account (15 challenging questions)
            {
                week: 3,
                topic: "Small Open Economy Model",
                question: "A small open economy has B‚ÇÄ = 0, Q‚ÇÅ = 100, Q‚ÇÇ = 110, r* = 0.10, and Œ≤ = 0.95. If households optimize with log utility U(C) = ln(C), what is the equilibrium C‚ÇÅ?",
                options: [
                    "C‚ÇÅ = 100 (consume endowment each period)",
                    "C‚ÇÅ ‚âà 103.8 (solving Euler equation: C‚ÇÅ/(C‚ÇÇ) = Œ≤(1+r*) = 0.95(1.1) = 1.045, with PV budget constraint)",
                    "C‚ÇÅ = 105 (simple average of endowments)",
                    "C‚ÇÅ ‚âà 98.5 (save in period 1 due to patient preferences)"
                ],
                correct: 1,
                explanation: "With log utility, Euler equation: C‚ÇÅ/C‚ÇÇ = Œ≤(1+r*). Budget: C‚ÇÅ + C‚ÇÇ/1.1 = 100 + 110/1.1 = 200. From Euler: C‚ÇÇ = C‚ÇÅ/[Œ≤(1+r*)] = C‚ÇÅ/1.045. Substituting: C‚ÇÅ + C‚ÇÅ/(1.045√ó1.1) ‚âà C‚ÇÅ(1 + 0.870) = 200 ‚Üí C‚ÇÅ ‚âà 103.8."
            },
            {
                week: 3,
                topic: "Euler Equation and Optimization",
                question: "The Euler equation U'(C‚ÇÅ) = Œ≤(1+r‚ÇÅ)U'(C‚ÇÇ) can be rewritten for log utility as C‚ÇÅ/C‚ÇÇ = Œ≤(1+r‚ÇÅ). If Œ≤ = 1.0 and r‚ÇÅ = 0, what does this imply?",
                options: [
                    "C‚ÇÅ = C‚ÇÇ (perfect consumption smoothing when time preference equals interest rate)",
                    "C‚ÇÅ > C‚ÇÇ (consume more in period 1)",
                    "C‚ÇÅ < C‚ÇÇ (save for future)",
                    "Consumption is indeterminate"
                ],
                correct: 0,
                explanation: "If Œ≤ = 1.0 (no time preference) and r‚ÇÅ = 0 (no return on saving), then C‚ÇÅ/C‚ÇÇ = 1.0(1.0) = 1 ‚Üí C‚ÇÅ = C‚ÇÇ. Households perfectly smooth consumption across periods."
            },
            {
                week: 3,
                topic: "Temporary vs Permanent Shocks",
                question: "An economy has Q‚ÇÅ = Q‚ÇÇ = 100, B‚ÇÄ = 0, r* = 0. A temporary shock reduces Q‚ÇÅ to 80 (Q‚ÇÇ unchanged). With perfect consumption smoothing (Œ≤(1+r) = 1), what is the new CA‚ÇÅ?",
                options: [
                    "CA‚ÇÅ = -20 (households borrow to maintain C‚ÇÅ = 90, borrowing 10)",
                    "CA‚ÇÅ = 0 (no effect on CA)",
                    "CA‚ÇÅ = -10 (households borrow to smooth: C‚ÇÅ = C‚ÇÇ = 90, CA‚ÇÅ = TB‚ÇÅ = Q‚ÇÅ - C‚ÇÅ = 80 - 90 = -10)",
                    "CA‚ÇÅ = +20 (households save the shock)"
                ],
                correct: 2,
                explanation: "With smoothing: C‚ÇÅ = C‚ÇÇ. Budget: C‚ÇÅ + C‚ÇÇ = 80 + 100 = 180 ‚Üí C‚ÇÅ = C‚ÇÇ = 90. CA‚ÇÅ = TB‚ÇÅ = Q‚ÇÅ - C‚ÇÅ = 80 - 90 = -10. Households borrow to smooth the temporary decline."
            },
            {
                week: 3,
                topic: "Temporary vs Permanent Shocks",
                question: "Compare two scenarios: (A) Q‚ÇÅ drops by 20 (temporary), (B) Q‚ÇÅ and Q‚ÇÇ each drop by 10 (permanent). With smoothing, which has larger |CA‚ÇÅ| impact?",
                options: [
                    "Scenario A: |CA‚ÇÅ| = 10 (smooth temporary shock); Scenario B: |CA‚ÇÅ| = 0 (adjust to permanent shock). Temporary shock causes larger CA movement.",
                    "Scenario B has larger impact as permanent shocks are more severe",
                    "Both have identical CA impacts",
                    "Neither affects CA"
                ],
                correct: 0,
                explanation: "Scenario A (temporary): PV income drops by 10 (20/2), so C‚ÇÅ = C‚ÇÇ drop by 10 each. CA‚ÇÅ = Q‚ÇÅ - C‚ÇÅ = (Q‚ÇÅ - 20) - (C‚ÇÅ - 10) = -10. Scenario B (permanent): C‚ÇÅ, C‚ÇÇ each drop by 10, matching output declines ‚Üí CA‚ÇÅ ‚âà 0. Temporary shocks cause large CA movements."
            },
            {
                week: 3,
                topic: "Anticipated Income Shocks",
                question: "An economy learns in period 1 that Q‚ÇÇ will increase from 100 to 120 (Q‚ÇÅ = 100 unchanged). With r* = 0 and perfect smoothing, what happens?",
                options: [
                    "CA‚ÇÅ = -10 (households increase C‚ÇÅ from 100 to 110, borrowing against future income)",
                    "CA‚ÇÅ = 0 (no change until period 2)",
                    "CA‚ÇÅ = +10 (save in anticipation)",
                    "CA‚ÇÅ = -20 (households over-borrow)"
                ],
                correct: 0,
                explanation: "Original: C‚ÇÅ = C‚ÇÇ = 100. New PV income: 100 + 120 = 220 ‚Üí C‚ÇÅ = C‚ÇÇ = 110. Since Q‚ÇÅ = 100 but C‚ÇÅ = 110, CA‚ÇÅ = TB‚ÇÅ = 100 - 110 = -10. Good news about future causes current CA deterioration."
            },
            {
                week: 3,
                topic: "Budget Constraint",
                question: "Given B‚ÇÄ = -50, Q‚ÇÅ = 100, Q‚ÇÇ = 110, r* = 0.10, the intertemporal budget constraint is C‚ÇÅ + C‚ÇÇ/(1.1) = (1.1)(-50) + 100 + 110/1.1. Calculate the RHS (present value of resources):",
                options: [
                    "PV = 155 (accurately: -55 + 100 + 100 = 145)",
                    "PV = 145 (correct: 1.1(-50) + 100 + 110/1.1 = -55 + 100 + 100 = 145)",
                    "PV = 160 (ignoring initial debt)",
                    "PV = 210 (summing without discounting)"
                ],
                correct: 1,
                explanation: "PV of resources = (1+r‚ÇÄ)B‚ÇÄ + Q‚ÇÅ + Q‚ÇÇ/(1+r‚ÇÅ) = 1.1(-50) + 100 + 110/1.1 = -55 + 100 + 100 = 145. The initial debt reduces available resources for consumption."
            },
            {
                week: 3,
                topic: "Budget Constraint",
                question: "If the intertemporal budget constraint is satisfied with C‚ÇÅ = 105, C‚ÇÇ = 115, Q‚ÇÅ = 100, Q‚ÇÇ = 110, r = 0, and B‚ÇÄ = 0, what is TB‚ÇÅ?",
                options: [
                    "TB‚ÇÅ = -5 (Q‚ÇÅ - C‚ÇÅ = 100 - 105 = -5, trade deficit to finance excess consumption)",
                    "TB‚ÇÅ = +5 (trade surplus)",
                    "TB‚ÇÅ = 0 (balanced trade)",
                    "TB‚ÇÅ = -10 (larger deficit)"
                ],
                correct: 0,
                explanation: "TB‚ÇÅ = Q‚ÇÅ - C‚ÇÅ = 100 - 105 = -5. The household consumes more than output in period 1, running a trade deficit, borrowing to finance it."
            },
            {
                week: 3,
                topic: "Small Open Economy Model",
                question: "With free capital mobility, if the world interest rate r* = 0.05 and domestic agents try to set domestic rate r‚ÇÅ = 0.03, what happens?",
                options: [
                    "Massive capital outflows drive domestic rate back to r‚ÇÅ = r* = 0.05 (arbitrage ensures interest rate parity)",
                    "Domestic rate stays at 0.03 due to government policy",
                    "Equilibrium at r‚ÇÅ = 0.04 (average of the two rates)",
                    "No capital flows occur"
                ],
                correct: 0,
                explanation: "Free capital mobility implies r‚ÇÅ = r* via arbitrage. If domestic r < world r, capital flows out (domestic agents invest abroad at higher return), raising domestic rate until r‚ÇÅ = r* = 0.05."
            },
            {
                week: 3,
                topic: "Euler Equation and Optimization",
                question: "For CRRA utility U(C) = C^(1-œÉ)/(1-œÉ) with œÉ = 2 (high risk aversion), the Euler equation is C‚ÇÅ^(-2) / C‚ÇÇ^(-2) = Œ≤(1+r). If Œ≤ = 0.96 and r = 0.05, and C‚ÇÇ = 100, what is C‚ÇÅ?",
                options: [
                    "C‚ÇÅ ‚âà 99.0 (C‚ÇÇ/C‚ÇÅ)¬≤ = Œ≤(1+r) = 0.96(1.05) = 1.008 ‚Üí C‚ÇÇ/C‚ÇÅ ‚âà 1.004 ‚Üí C‚ÇÅ ‚âà 99.6)",
                    "C‚ÇÅ ‚âà 99.6 (correctly solving: (C‚ÇÇ/C‚ÇÅ)¬≤ = 1.008 ‚Üí C‚ÇÇ/C‚ÇÅ ‚âà 1.004 ‚Üí C‚ÇÅ = 100/1.004 ‚âà 99.6)",
                    "C‚ÇÅ = 100 (equal consumption)",
                    "C‚ÇÅ ‚âà 95 (much lower due to high risk aversion)"
                ],
                correct: 1,
                explanation: "Euler: (C‚ÇÅ/C‚ÇÇ)^œÉ = Œ≤(1+r) ‚Üí (C‚ÇÅ/C‚ÇÇ)¬≤ = 0.96(1.05) = 1.008 ‚Üí C‚ÇÅ/C‚ÇÇ = ‚àö1.008 ‚âà 1.004 ‚Üí C‚ÇÅ = C‚ÇÇ/1.004 ‚âà 100/1.004 ‚âà 99.6. Slight tilt toward period-2 consumption given Œ≤ < 1/(1+r)."
            },
            {
                week: 3,
                topic: "Consumption Smoothing",
                question: "Why do households prefer consumption smoothing (due to concave utility U''(C) < 0)?",
                options: [
                    "Diminishing marginal utility: the utility gain from extra consumption when C is low exceeds the utility loss from reduced consumption when C is high",
                    "Households dislike variety in consumption baskets",
                    "Government mandates smooth consumption",
                    "Inflation erodes purchasing power"
                ],
                correct: 0,
                explanation: "Concave utility (U''(C) < 0) means diminishing marginal utility. Transferring consumption from high-C period to low-C period increases total utility, as marginal utility is higher when C is low. This drives smoothing."
            },
            {
                week: 3,
                topic: "Temporary vs Permanent Shocks",
                question: "An oil-exporting country experiences a temporary oil price boom that increases Q‚ÇÅ by 50 (Q‚ÇÇ unchanged). With perfect smoothing and r = 0, how much does C‚ÇÅ increase, and what is the CA‚ÇÅ response?",
                options: [
                    "C‚ÇÅ increases by 50, CA‚ÇÅ = 0 (consume all the windfall)",
                    "C‚ÇÅ increases by 25, CA‚ÇÅ = +25 (save half the windfall to smooth consumption: ŒîC‚ÇÅ = ŒîC‚ÇÇ = 25)",
                    "C‚ÇÅ increases by 10, CA‚ÇÅ = +40 (mostly save)",
                    "C‚ÇÅ unchanged, CA‚ÇÅ = +50 (save all windfall)"
                ],
                correct: 1,
                explanation: "Temporary windfall increases PV income by 50. With smoothing and r = 0: ŒîC‚ÇÅ = ŒîC‚ÇÇ = 25. Since Q‚ÇÅ rises by 50 but C‚ÇÅ rises by 25, CA‚ÇÅ improves by 50 - 25 = +25. Save half the windfall."
            },
            {
                week: 3,
                topic: "Anticipated Income Shocks",
                question: "A developing country announces major reforms expected to boost Q‚ÇÇ from 100 to 150 (Q‚ÇÅ = 100). Markets believe the reforms. If r = 0.10 and households smooth consumption, how does CA‚ÇÅ respond?",
                options: [
                    "CA‚ÇÅ deteriorates by approximately 22.7 (households increase C‚ÇÅ from baseline by borrowing against future prosperity)",
                    "CA‚ÇÅ improves as households save in anticipation",
                    "CA‚ÇÅ unchanged until reforms materialize",
                    "CA‚ÇÅ deteriorates by 50 (households borrow the full future increase)"
                ],
                correct: 0,
                explanation: "Original PV: 100 + 100/1.1 ‚âà 190.9 ‚Üí C‚ÇÅ = C‚ÇÇ/(1+r). New PV: 100 + 150/1.1 ‚âà 236.4. Solving Euler + budget (simplified with log utility Œ≤(1+r) = 1): C‚ÇÅ ‚âà 122.7. CA‚ÇÅ = TB‚ÇÅ = Q‚ÇÅ - C‚ÇÅ = 100 - 122.7 ‚âà -22.7."
            },
            {
                week: 3,
                topic: "Small Open Economy Model",
                question: "In equilibrium, the three key conditions are: (1) Intertemporal budget constraint, (2) Euler equation (optimality), (3) Interest rate parity (r‚ÇÅ = r*). If a country imposes capital controls preventing capital outflows, which condition is violated?",
                options: [
                    "Condition (3): interest rate parity breaks down (domestic r‚ÇÅ can deviate from r*)",
                    "Condition (1): budget constraint is no longer binding",
                    "Condition (2): households no longer optimize",
                    "All three conditions are maintained"
                ],
                correct: 0,
                explanation: "Capital controls prevent free capital mobility, breaking the arbitrage that enforces r‚ÇÅ = r*. The domestic interest rate can deviate from the world rate. Budget constraint and household optimization still hold domestically."
            },
            {
                week: 3,
                topic: "Budget Constraint",
                question: "An economy with B‚ÇÄ = 0, Q‚ÇÅ = 100, Q‚ÇÇ = 121, r* = 0.10, and Œ≤ = 1/1.1 (implying Œ≤(1+r) = 1) optimizes consumption. What is the equilibrium CA‚ÇÅ?",
                options: [
                    "CA‚ÇÅ = 0 (TB‚ÇÅ = Q‚ÇÅ - C‚ÇÅ = 100 - 110 = -10, but CA‚ÇÅ = TB‚ÇÅ + rB‚ÇÄ = -10 + 0 = -10; wait, if C‚ÇÅ=C‚ÇÇ=110 with r=0.1: PV check)",
                    "CA‚ÇÅ ‚âà -10 (with perfect smoothing C‚ÇÅ = C‚ÇÇ: budget C‚ÇÅ + C‚ÇÇ/1.1 = 100 + 121/1.1 = 210 ‚Üí C‚ÇÅ = C‚ÇÇ = 110 ‚Üí TB‚ÇÅ = -10)",
                    "CA‚ÇÅ = +10 (save in period 1)",
                    "CA‚ÇÅ = -21 (borrow heavily)"
                ],
                correct: 1,
                explanation: "Œ≤(1+r) = 1 implies perfect smoothing: C‚ÇÅ = C‚ÇÇ. Budget: C‚ÇÅ + C‚ÇÇ/1.1 = 100 + 110 = 210 ‚Üí C‚ÇÅ(1 + 1/1.1) = 210 ‚Üí C‚ÇÅ(1.909) = 210 ‚Üí C‚ÇÅ ‚âà 110. CA‚ÇÅ = TB‚ÇÅ = Q‚ÇÅ - C‚ÇÅ = 100 - 110 = -10."
            },
            {
                week: 3,
                topic: "Consumption Smoothing",
                question: "Without international borrowing/lending (financial autarky), an economy with Q‚ÇÅ = 80, Q‚ÇÇ = 120 must satisfy:",
                options: [
                    "C‚ÇÅ = Q‚ÇÅ = 80, C‚ÇÇ = Q‚ÇÇ = 120 (no smoothing possible, consumption tied to output each period)",
                    "C‚ÇÅ = C‚ÇÇ = 100 (perfect smoothing despite autarky)",
                    "C‚ÇÅ = 90, C‚ÇÇ = 110 (partial smoothing)",
                    "CA‚ÇÅ = -20 (can still borrow)"
                ],
                correct: 0,
                explanation: "Financial autarky means no international borrowing/lending: B‚ÇÅ = B‚ÇÄ = 0 always. Thus, C‚ÇÅ = Q‚ÇÅ = 80 and C‚ÇÇ = Q‚ÇÇ = 120. Consumption volatility matches output volatility‚Äîno smoothing possible."
            },

            // Week 4: Terms of Trade, World Interest Rate Shocks, and Tariffs (15 challenging questions)
            {
                week: 4,
                topic: "Terms of Trade",
                question: "The terms of trade (TT) is defined as TT = P^X / P^M. If an oil-exporting country experiences a rise in oil prices (P^X ‚Üë) while import prices remain constant (P^M unchanged), how does this affect TT‚ÇÅ and the budget constraint?",
                options: [
                    "TT‚ÇÅ falls, making the country poorer in real terms",
                    "TT‚ÇÅ rises (TT‚ÇÅ = P^X‚ÇÅ/P^M‚ÇÅ increases), improving the country's purchasing power: resources = TT‚ÇÅQ‚ÇÅ + TT‚ÇÇQ‚ÇÇ/(1+r) rise",
                    "TT‚ÇÅ unchanged as both prices move proportionally",
                    "TT‚ÇÅ effect depends on the elasticity of substitution"
                ],
                correct: 1,
                explanation: "TT = P^X/P^M. If P^X ‚Üë and P^M constant, then TT ‚Üë. This improvement in terms of trade increases the real value of exports (TT‚ÇÅQ‚ÇÅ), expanding the budget constraint and making the country richer."
            },
            {
                week: 4,
                topic: "Terms of Trade",
                question: "An economy with Q‚ÇÅ = Q‚ÇÇ = 100, TT‚ÇÅ = 1, TT‚ÇÇ = 1, experiences a temporary TT shock: TT‚ÇÅ rises to 1.2 (TT‚ÇÇ = 1 unchanged). With perfect smoothing (r = 0), what is the CA‚ÇÅ response?",
                options: [
                    "CA‚ÇÅ = 0 (temporary shocks don't affect CA)",
                    "CA‚ÇÅ ‚âà +10 (country saves most of the windfall: PV income rises by 20, so C‚ÇÅ = C‚ÇÇ rise by 10 each; CA‚ÇÅ = TT‚ÇÅQ‚ÇÅ - C‚ÇÅ = 120 - 110 = +10)",
                    "CA‚ÇÅ = +20 (save entire windfall)",
                    "CA‚ÇÅ = -10 (borrow against future income)"
                ],
                correct: 1,
                explanation: "Temporary TT improvement (TT‚ÇÅ from 1 to 1.2) increases PV income by TT‚ÇÅQ‚ÇÅ - Q‚ÇÅ = 120 - 100 = 20. With smoothing: ŒîC‚ÇÅ = ŒîC‚ÇÇ = 10. CA‚ÇÅ = TT‚ÇÅQ‚ÇÅ - C‚ÇÅ = 120 - 110 = +10. Country saves half the windfall."
            },
            {
                week: 4,
                topic: "Terms of Trade",
                question: "Compare two scenarios: (A) TT‚ÇÅ rises from 1 to 1.1 (temporary), (B) TT‚ÇÅ and TT‚ÇÇ both rise from 1 to 1.1 (permanent). Which has larger CA‚ÇÅ impact?",
                options: [
                    "Scenario B: permanent shocks have larger effects",
                    "Scenario A: CA‚ÇÅ improves significantly as country smooths by saving; Scenario B: CA‚ÇÅ changes little as consumption rises in both periods",
                    "Both have identical CA‚ÇÅ effects",
                    "Neither affects CA‚ÇÅ"
                ],
                correct: 1,
                explanation: "Temporary TT improvement: country saves windfall to smooth consumption ‚Üí large CA‚ÇÅ improvement. Permanent TT improvement: consumption rises in both periods proportionally ‚Üí little CA‚ÇÅ change. Same principle as endowment shocks."
            },
            {
                week: 4,
                topic: "World Interest Rate Shocks",
                question: "When the world interest rate r* rises, there are two effects: substitution and income. For a net borrower (B‚ÇÄ < 0), which statement is correct?",
                options: [
                    "Substitution effect: C‚ÇÅ ‚Üì (bonds more attractive); Income effect: C‚ÇÅ ‚Üì (poorer due to higher debt costs); Effects reinforce ‚Üí CA‚ÇÅ ‚Üë",
                    "Substitution and income effects oppose, making the net effect ambiguous",
                    "Only substitution effect matters; income effect is negligible",
                    "Interest rate changes don't affect consumption decisions"
                ],
                correct: 0,
                explanation: "For net borrower (B‚ÇÄ < 0): (1) Substitution effect: r ‚Üë makes saving more attractive ‚Üí C‚ÇÅ ‚Üì. (2) Income effect: r ‚Üë raises debt service costs ‚Üí poorer ‚Üí C‚ÇÅ ‚Üì. Both effects reinforce, unambiguously improving CA‚ÇÅ."
            },
            {
                week: 4,
                topic: "World Interest Rate Shocks",
                question: "For a net lender (B‚ÇÄ > 0), an increase in r* creates opposing effects. Which effect typically dominates under standard preferences?",
                options: [
                    "Income effect dominates: higher returns make lender richer ‚Üí C‚ÇÅ ‚Üë, CA‚ÇÅ ‚Üì",
                    "Substitution effect dominates: bonds more attractive ‚Üí C‚ÇÅ ‚Üì, CA‚ÇÅ ‚Üë (savings should increase with interest rate)",
                    "Both effects exactly cancel",
                    "Net effect depends entirely on the size of B‚ÇÄ"
                ],
                correct: 1,
                explanation: "For net lender (B‚ÇÄ > 0): income effect (richer ‚Üí C‚ÇÅ ‚Üë) opposes substitution effect (bonds more attractive ‚Üí C‚ÇÅ ‚Üì). Under standard preferences, substitution effect dominates‚Äîwe expect savings to increase when r rises."
            },
            {
                week: 4,
                topic: "World Interest Rate Shocks",
                question: "An economy with B‚ÇÄ = 0 experiences an increase in r* from 0.05 to 0.10. The Euler equation changes from C‚ÇÅ/C‚ÇÇ = Œ≤(1.05) to C‚ÇÅ/C‚ÇÇ = Œ≤(1.10). What happens to C‚ÇÅ relative to C‚ÇÇ?",
                options: [
                    "C‚ÇÅ/C‚ÇÇ rises (tilt consumption toward period 1)",
                    "C‚ÇÅ/C‚ÇÇ falls (tilt consumption toward period 2, as C‚ÇÇ becomes cheaper in PV terms)",
                    "C‚ÇÅ/C‚ÇÇ unchanged (B‚ÇÄ = 0 means no income effect)",
                    "Cannot determine without knowing Œ≤"
                ],
                correct: 1,
                explanation: "With B‚ÇÄ = 0 (pure substitution effect): higher r makes future consumption cheaper in present value. C‚ÇÅ/C‚ÇÇ = Œ≤(1+r) rises ‚Üí C‚ÇÅ rises relative to C‚ÇÇ. But in levels, C‚ÇÅ falls because budget constraint rotates: TB‚ÇÅ = Q‚ÇÅ - C‚ÇÅ improves."
            },
            {
                week: 4,
                topic: "Import Tariffs",
                question: "The modified Euler equation with tariffs is U'(C‚ÇÅ) = [(1+œÑ‚ÇÅ)/(1+œÑ‚ÇÇ)]Œ≤(1+r)U'(C‚ÇÇ). If œÑ‚ÇÅ = 0.10 and œÑ‚ÇÇ = 0, what is the effect?",
                options: [
                    "(1+œÑ‚ÇÅ)/(1+œÑ‚ÇÇ) = 1.10 > 1 makes current consumption relatively expensive ‚Üí C‚ÇÅ ‚Üì, CA‚ÇÅ ‚Üë",
                    "(1+œÑ‚ÇÅ)/(1+œÑ‚ÇÇ) = 1.10 > 1 makes current consumption relatively cheap ‚Üí C‚ÇÅ ‚Üë, CA‚ÇÅ ‚Üì",
                    "Temporary tariffs have no effect on consumption allocation",
                    "The ratio equals 1 since œÑ‚ÇÇ = 0"
                ],
                correct: 0,
                explanation: "Temporary tariff (œÑ‚ÇÅ = 0.10, œÑ‚ÇÇ = 0): (1+œÑ‚ÇÅ)/(1+œÑ‚ÇÇ) = 1.10/1 = 1.10 > 1. This makes current consumption relatively expensive (high tariff now, no tariff later). Households postpone consumption: C‚ÇÅ ‚Üì, CA‚ÇÅ ‚Üë."
            },
            {
                week: 4,
                topic: "Import Tariffs",
                question: "A permanent tariff is imposed: œÑ‚ÇÅ = œÑ‚ÇÇ = 0.20. What is the effect on the current account?",
                options: [
                    "CA‚ÇÅ improves significantly as tariffs reduce imports",
                    "No effect on CA‚ÇÅ: (1+œÑ‚ÇÅ)/(1+œÑ‚ÇÇ) = 1 in Euler equation, no intertemporal substitution created",
                    "CA‚ÇÅ deteriorates due to retaliation",
                    "Effect depends on elasticity of import demand"
                ],
                correct: 1,
                explanation: "Permanent tariff (œÑ‚ÇÅ = œÑ‚ÇÇ): the ratio (1+œÑ‚ÇÅ)/(1+œÑ‚ÇÇ) = 1 in Euler equation. No intertemporal distortion is created. Consumption path and CA are unchanged. Tariffs only affect CA via intertemporal substitution."
            },
            {
                week: 4,
                topic: "Import Tariffs",
                question: "An anticipated future tariff is announced: œÑ‚ÇÅ = 0, œÑ‚ÇÇ = 0.25. How does this affect CA‚ÇÅ?",
                options: [
                    "CA‚ÇÅ improves as households save in anticipation",
                    "CA‚ÇÅ deteriorates: (1+œÑ‚ÇÅ)/(1+œÑ‚ÇÇ) = 1/1.25 = 0.8 < 1 makes current consumption relatively cheap ‚Üí C‚ÇÅ ‚Üë, CA‚ÇÅ ‚Üì",
                    "No effect until œÑ‚ÇÇ is actually implemented",
                    "CA‚ÇÅ improves slightly due to precautionary saving"
                ],
                correct: 1,
                explanation: "Anticipated future tariff (œÑ‚ÇÅ = 0, œÑ‚ÇÇ = 0.25): (1+œÑ‚ÇÅ)/(1+œÑ‚ÇÇ) = 1/1.25 = 0.8 < 1. Current consumption is relatively cheap (no tariff now, high tariff later). Households front-load consumption: C‚ÇÅ ‚Üë, CA‚ÇÅ ‚Üì."
            },
            {
                week: 4,
                topic: "Import Tariffs",
                question: "Why do permanent tariffs not affect the current account in this model, despite reducing imports?",
                options: [
                    "The model assumes tariff revenues are wasted",
                    "Tariff revenues are rebated lump-sum (L_t = œÑ_t C_t), so economy-wide resource constraint is unchanged: C‚ÇÅ + C‚ÇÇ/(1+r) = (1+r)B‚ÇÄ + TT‚ÇÅQ‚ÇÅ + TT‚ÇÇQ‚ÇÇ/(1+r)",
                    "Imports don't affect the current account",
                    "The model ignores general equilibrium effects"
                ],
                correct: 1,
                explanation: "Tariff revenues are rebated lump-sum to households (L_t = œÑ_t C_t). This means the economy-wide budget constraint remains unchanged‚Äîno net resources are gained or lost. Permanent tariffs don't create intertemporal distortions, so CA is unaffected."
            },
            {
                week: 4,
                topic: "Terms of Trade",
                question: "A commodity exporter has Q‚ÇÅ = Q‚ÇÇ = 100, TT‚ÇÅ = 1, TT‚ÇÇ = 1, r = 0. A permanent TT improvement occurs: TT‚ÇÅ = TT‚ÇÇ = 1.2. With perfect smoothing, how much does C‚ÇÅ increase?",
                options: [
                    "ŒîC‚ÇÅ = 10 (half the increase)",
                    "ŒîC‚ÇÅ = 20 (full increase in both periods: PV income rises by 120 - 100 = 20 in each period, so ŒîC‚ÇÅ = ŒîC‚ÇÇ = 20)",
                    "ŒîC‚ÇÅ = 0 (permanent shocks don't affect consumption)",
                    "ŒîC‚ÇÅ = 40 (double the increase)"
                ],
                correct: 1,
                explanation: "Permanent TT improvement: PV income changes from 100 + 100 = 200 to 120 + 120 = 240. ŒîPV = 40. With smoothing: ŒîC‚ÇÅ = ŒîC‚ÇÇ = 20. Permanent shocks are fully adjusted to; no smoothing via borrowing/lending needed."
            },
            {
                week: 4,
                topic: "World Interest Rate Shocks",
                question: "An economy has B‚ÇÄ = -100, r* rises from 0.05 to 0.10. The income effect changes the budget constraint by approximately:",
                options: [
                    "+5 (additional interest income)",
                    "-5 (increased debt service: Œî(rB‚ÇÄ) = 0.05(-100) = -5, reducing PV resources)",
                    "0 (B‚ÇÄ < 0 means no income effect)",
                    "-10 (debt service doubles)"
                ],
                correct: 1,
                explanation: "Net borrower (B‚ÇÄ = -100): income effect from r rising by 0.05 is Œî(rB‚ÇÄ) = 0.05 √ó (-100) = -5. The country must pay additional interest, reducing available resources by approximately 5 in present value terms."
            },
            {
                week: 4,
                topic: "World Interest Rate Shocks",
                question: "For a country with B‚ÇÄ = +200 (net lender), r* rises from 0.04 to 0.06. The positive income effect increases resources by:",
                options: [
                    "+4 (Œî(rB‚ÇÄ) = 0.02 √ó 200 = 4)",
                    "+8 (proportional to the rate change)",
                    "+12 (including compounding)",
                    "0 (interest changes don't create income effects for lenders)"
                ],
                correct: 0,
                explanation: "Net lender (B‚ÇÄ = +200): income effect from r rising by 0.02 is Œî(rB‚ÇÄ) = 0.02 √ó 200 = +4. The country earns additional interest income, increasing available resources by 4 in present value."
            },
            {
                week: 4,
                topic: "Import Tariffs",
                question: "The household budget constraints with tariffs are (1+œÑ‚ÇÅ)C‚ÇÅ + B‚ÇÅ = TT‚ÇÅQ‚ÇÅ + L‚ÇÅ + (1+r‚ÇÄ)B‚ÇÄ where L‚ÇÅ = œÑ‚ÇÅC‚ÇÅ. Substituting the rebate, the constraint simplifies to:",
                options: [
                    "C‚ÇÅ + B‚ÇÅ = TT‚ÇÅQ‚ÇÅ + (1+r‚ÇÄ)B‚ÇÄ (tariff term cancels out as (1+œÑ‚ÇÅ)C‚ÇÅ - œÑ‚ÇÅC‚ÇÅ = C‚ÇÅ)",
                    "(1+œÑ‚ÇÅ)C‚ÇÅ + B‚ÇÅ = TT‚ÇÅQ‚ÇÅ + (1+r‚ÇÄ)B‚ÇÄ (rebate doesn't affect household)",
                    "œÑ‚ÇÅC‚ÇÅ + B‚ÇÅ = TT‚ÇÅQ‚ÇÅ (only tariff component matters)",
                    "Tariffs prevent simplification"
                ],
                correct: 0,
                explanation: "(1+œÑ‚ÇÅ)C‚ÇÅ + B‚ÇÅ = TT‚ÇÅQ‚ÇÅ + L‚ÇÅ + (1+r‚ÇÄ)B‚ÇÄ. With L‚ÇÅ = œÑ‚ÇÅC‚ÇÅ: (1+œÑ‚ÇÅ)C‚ÇÅ + B‚ÇÅ = TT‚ÇÅQ‚ÇÅ + œÑ‚ÇÅC‚ÇÅ + (1+r‚ÇÄ)B‚ÇÄ. Simplifying: C‚ÇÅ + B‚ÇÅ = TT‚ÇÅQ‚ÇÅ + (1+r‚ÇÄ)B‚ÇÄ. The economy-wide resource constraint is unaffected by tariffs when revenues are rebated."
            },
            {
                week: 4,
                topic: "Terms of Trade",
                question: "Why do terms-of-trade shocks behave identically to endowment shocks in their CA effects?",
                options: [
                    "They both affect the present value of resources in the same way: TT_t Q_t is analogous to endowment Q_t",
                    "Terms of trade don't actually affect the current account",
                    "Endowment shocks are always larger in magnitude",
                    "They affect different components of the budget constraint"
                ],
                correct: 0,
                explanation: "In the budget constraint C‚ÇÅ + C‚ÇÇ/(1+r) = (1+r)B‚ÇÄ + TT‚ÇÅQ‚ÇÅ + TT‚ÇÇQ‚ÇÇ/(1+r), terms-of-trade-adjusted output TT_t Q_t plays the same role as endowment Q_t in the single-good model. Temporary vs permanent TT shocks have identical CA effects to endowment shocks."
            },

            // Week 5: Production Economy and Current Account Determination
            {
                week: 5,
                topic: "Production Economy",
                question: "In the production economy model, output in period t is Q_t = A_t F(I_{t-1}), where I_{t-1} is investment and A_t is productivity. What is the marginal product of capital (MPK)?",
                options: [
                    "MPK = F(I_{t-1})",
                    "MPK = A_t F'(I_{t-1}) (the additional output from one more unit of investment)",
                    "MPK = A_t F(I_{t-1}) / I_{t-1}",
                    "MPK = F'(I_{t-1}) / A_t"
                ],
                correct: 1,
                explanation: "Marginal product of capital: MPK‚ÇÇ = ‚àÇQ‚ÇÇ/‚àÇI‚ÇÅ = A‚ÇÇF'(I‚ÇÅ). This represents the additional output in period 2 from investing one more unit in period 1, accounting for productivity A‚ÇÇ."
            },
            {
                week: 5,
                topic: "Production Economy",
                question: "The firm's profit maximization condition for optimal investment is A‚ÇÇF'(I‚ÇÅ) = 1 + r‚ÇÅ. What is the economic interpretation?",
                options: [
                    "Marginal product equals the interest rate",
                    "Invest until marginal benefit (MPK) equals marginal cost (1 + r‚ÇÅ, the opportunity cost of funds)",
                    "All output should be invested",
                    "Investment should equal savings"
                ],
                correct: 1,
                explanation: "A‚ÇÇF'(I‚ÇÅ) = 1 + r‚ÇÅ: invest until the marginal benefit (additional output from last unit invested, MPK = A‚ÇÇF'(I‚ÇÅ)) equals the marginal cost (opportunity cost of funds, 1 + r‚ÇÅ). This is the standard first-order condition."
            },
            {
                week: 5,
                topic: "Investment Schedule",
                question: "The investment schedule I‚ÇÅ = I(r‚ÇÅ‚Åª, A‚ÇÇ‚Å∫) shows how investment depends on r‚ÇÅ and A‚ÇÇ. Why is ‚àÇI‚ÇÅ/‚àÇr‚ÇÅ < 0?",
                options: [
                    "Higher interest rates make investment more attractive",
                    "Higher r‚ÇÅ increases the opportunity cost of investing ‚Üí firms invest less (I‚ÇÅ ‚Üì)",
                    "Investment is independent of interest rates",
                    "The relationship depends on productivity"
                ],
                correct: 1,
                explanation: "From A‚ÇÇF'(I‚ÇÅ) = 1 + r‚ÇÅ: if r‚ÇÅ rises, firms must reduce I‚ÇÅ to raise F'(I‚ÇÅ) (due to diminishing returns) to satisfy the condition. Higher interest rates ‚Üí higher opportunity cost ‚Üí less investment."
            },
            {
                week: 5,
                topic: "Investment Schedule",
                question: "Why is ‚àÇI‚ÇÅ/‚àÇA‚ÇÇ > 0 in the investment schedule I‚ÇÅ = I(r‚ÇÅ‚Åª, A‚ÇÇ‚Å∫)?",
                options: [
                    "Higher productivity A‚ÇÇ raises the marginal product A‚ÇÇF'(I‚ÇÅ), making investment more profitable ‚Üí I‚ÇÅ ‚Üë",
                    "Productivity shocks don't affect investment decisions",
                    "Higher A‚ÇÇ reduces investment due to income effects",
                    "The relationship is ambiguous"
                ],
                correct: 0,
                explanation: "From A‚ÇÇF'(I‚ÇÅ) = 1 + r‚ÇÅ: if A‚ÇÇ rises, firms can invest more (I‚ÇÅ ‚Üë) while still satisfying the condition (as A‚ÇÇF'(I‚ÇÅ) rises). Higher future productivity makes investment more profitable."
            },
            {
                week: 5,
                topic: "Saving Schedule",
                question: "The saving schedule is S‚ÇÅ = S(r‚ÇÅ‚Å∫, A‚ÇÅ‚Å∫, A‚ÇÇ‚Åª). Why is ‚àÇS‚ÇÅ/‚àÇA‚ÇÅ > 0?",
                options: [
                    "Higher A‚ÇÅ reduces output and income",
                    "Higher current productivity A‚ÇÅ increases Q‚ÇÅ = A‚ÇÅF(I‚ÇÄ), raising income ‚Üí households save more (temporary income shock)",
                    "Productivity doesn't affect saving decisions",
                    "Higher A‚ÇÅ causes households to borrow"
                ],
                correct: 1,
                explanation: "S‚ÇÅ = Q‚ÇÅ - C‚ÇÅ. Higher A‚ÇÅ raises Q‚ÇÅ = A‚ÇÅF(I‚ÇÄ). If this is a temporary shock (A‚ÇÇ unchanged), households smooth consumption: C‚ÇÅ rises less than Q‚ÇÅ ‚Üí S‚ÇÅ = Q‚ÇÅ - C‚ÇÅ rises."
            },
            {
                week: 5,
                topic: "Saving Schedule",
                question: "Why is ‚àÇS‚ÇÅ/‚àÇA‚ÇÇ < 0 in the saving schedule S‚ÇÅ = S(r‚ÇÅ‚Å∫, A‚ÇÅ‚Å∫, A‚ÇÇ‚Åª)?",
                options: [
                    "Higher future productivity A‚ÇÇ is good news ‚Üí households borrow against future income ‚Üí S‚ÇÅ ‚Üì",
                    "Future productivity doesn't affect current saving",
                    "Higher A‚ÇÇ increases current saving for precautionary reasons",
                    "The relationship depends on risk aversion"
                ],
                correct: 0,
                explanation: "Higher A‚ÇÇ means higher future income Q‚ÇÇ = A‚ÇÇF(I‚ÇÅ). Good news about future income causes households to increase C‚ÇÅ (borrowing against future) ‚Üí S‚ÇÅ = Q‚ÇÅ - C‚ÇÅ falls. This is the anticipated income effect."
            },
            {
                week: 5,
                topic: "Current Account Schedule",
                question: "The current account schedule is CA‚ÇÅ = CA(r‚ÇÅ‚Å∫, A‚ÇÅ‚Å∫, A‚ÇÇ‚Åª) = S‚ÇÅ - I‚ÇÅ. Why is ‚àÇCA‚ÇÅ/‚àÇA‚ÇÅ > 0?",
                options: [
                    "Higher A‚ÇÅ increases both S‚ÇÅ and I‚ÇÅ equally",
                    "Higher current productivity A‚ÇÅ raises S‚ÇÅ (temporary income shock ‚Üí save windfall) but doesn't directly affect I‚ÇÅ (depends on A‚ÇÇ) ‚Üí CA‚ÇÅ ‚Üë",
                    "Higher A‚ÇÅ causes CA‚ÇÅ to deteriorate",
                    "Current productivity doesn't affect CA"
                ],
                correct: 1,
                explanation: "CA‚ÇÅ = S‚ÇÅ - I‚ÇÅ. Higher A‚ÇÅ: (1) S‚ÇÅ rises (temporary income boost ‚Üí save windfall). (2) I‚ÇÅ unchanged (investment depends on A‚ÇÇ, not A‚ÇÅ). Net effect: CA‚ÇÅ = S‚ÇÅ - I‚ÇÅ improves."
            },
            {
                week: 5,
                topic: "Current Account Schedule",
                question: "Why is ‚àÇCA‚ÇÅ/‚àÇA‚ÇÇ < 0 in the current account schedule CA‚ÇÅ = CA(r‚ÇÅ‚Å∫, A‚ÇÅ‚Å∫, A‚ÇÇ‚Åª)?",
                options: [
                    "Higher A‚ÇÇ reduces saving S‚ÇÅ (good news ‚Üí borrow) and increases investment I‚ÇÅ (more profitable) ‚Üí both effects worsen CA‚ÇÅ",
                    "Future productivity shocks don't affect current CA",
                    "Higher A‚ÇÇ improves CA‚ÇÅ through precautionary saving",
                    "The effect is ambiguous"
                ],
                correct: 0,
                explanation: "CA‚ÇÅ = S‚ÇÅ - I‚ÇÅ. Higher A‚ÇÇ: (1) S‚ÇÅ ‚Üì (good news about future ‚Üí households borrow). (2) I‚ÇÅ ‚Üë (higher MPK ‚Üí firms invest more). Both effects reduce CA‚ÇÅ: ‚àÇCA‚ÇÅ/‚àÇA‚ÇÇ < 0."
            },
            {
                week: 5,
                topic: "Metzler Diagram",
                question: "In the Metzler diagram with r‚ÇÅ on the vertical axis and S‚ÇÅ, I‚ÇÅ, CA‚ÇÅ on the horizontal axis, the investment schedule I(r‚ÇÅ‚Åª) slopes:",
                options: [
                    "Upward: higher r‚ÇÅ ‚Üí more investment",
                    "Downward: higher r‚ÇÅ ‚Üí higher opportunity cost ‚Üí less investment",
                    "Vertical: investment is independent of r‚ÇÅ",
                    "Horizontal: interest rate adjusts to investment"
                ],
                correct: 1,
                explanation: "Investment schedule I(r‚ÇÅ‚Åª) slopes downward: ‚àÇI‚ÇÅ/‚àÇr‚ÇÅ < 0. Higher interest rates increase the opportunity cost of investing, reducing optimal investment. The curve is downward-sloping in (I‚ÇÅ, r‚ÇÅ) space."
            },
            {
                week: 5,
                topic: "Metzler Diagram",
                question: "In the Metzler diagram, the saving schedule S(r‚ÇÅ‚Å∫) slopes:",
                options: [
                    "Upward: higher r‚ÇÅ ‚Üí substitution effect dominates ‚Üí save more",
                    "Downward: higher r‚ÇÅ ‚Üí consume more",
                    "Vertical: saving is independent of r‚ÇÅ",
                    "Ambiguous: income and substitution effects oppose"
                ],
                correct: 0,
                explanation: "Saving schedule S(r‚ÇÅ‚Å∫) slopes upward: ‚àÇS‚ÇÅ/‚àÇr‚ÇÅ > 0. Higher interest rates make saving more attractive (substitution effect typically dominates income effect), so households save more."
            },
            {
                week: 5,
                topic: "Metzler Diagram",
                question: "A positive productivity shock in period 2 (A‚ÇÇ ‚Üë) shifts which curves in the Metzler diagram?",
                options: [
                    "Investment schedule shifts right (I‚ÇÅ ‚Üë); Saving schedule shifts left (S‚ÇÅ ‚Üì); CA‚ÇÅ schedule shifts left (worsens)",
                    "Only investment schedule shifts",
                    "Both schedules shift right",
                    "Neither schedule shifts"
                ],
                correct: 0,
                explanation: "A‚ÇÇ ‚Üë: (1) Investment: I‚ÇÅ = I(r‚ÇÅ‚Åª, A‚ÇÇ‚Å∫) shifts right (higher MPK ‚Üí more investment). (2) Saving: S‚ÇÅ = S(r‚ÇÅ‚Å∫, A‚ÇÅ‚Å∫, A‚ÇÇ‚Åª) shifts left (good news ‚Üí borrow ‚Üí S‚ÇÅ ‚Üì). (3) CA‚ÇÅ = S‚ÇÅ - I‚ÇÅ shifts left (deteriorates)."
            },
            {
                week: 5,
                topic: "Giant Oil Discoveries",
                question: "The giant oil discoveries application shows that when large oil fields are discovered (future productivity shock A‚ÇÇ ‚Üë), the empirical evidence supports:",
                options: [
                    "CA‚ÇÅ deteriorates: countries invest heavily (I‚ÇÅ ‚Üë) and borrow against future oil income (S‚ÇÅ ‚Üì), confirming model predictions",
                    "CA‚ÇÅ improves due to precautionary saving",
                    "CA‚ÇÅ is unaffected by oil discoveries",
                    "Investment remains unchanged"
                ],
                correct: 0,
                explanation: "Giant oil discoveries represent large anticipated productivity shocks (A‚ÇÇ ‚Üë). Model predicts: I‚ÇÅ ‚Üë (building infrastructure to extract oil) and S‚ÇÅ ‚Üì (borrowing against future oil revenue) ‚Üí CA‚ÇÅ deteriorates. Empirical evidence confirms this pattern."
            },
            {
                week: 5,
                topic: "Production Economy",
                question: "The production function Q_t = A_t F(I_{t-1}) exhibits diminishing marginal product of capital: F''(I) < 0. What does this imply for the investment response to A‚ÇÇ?",
                options: [
                    "Higher A‚ÇÇ leads to infinite investment",
                    "F''(I) < 0 ensures a finite investment response: as I‚ÇÅ rises, F'(I‚ÇÅ) falls, limiting how much investment increases",
                    "Diminishing returns prevent any investment",
                    "Investment becomes negative"
                ],
                correct: 1,
                explanation: "Diminishing returns (F''(I) < 0) mean F'(I‚ÇÅ) falls as I‚ÇÅ rises. From A‚ÇÇF'(I‚ÇÅ) = 1 + r‚ÇÅ: even if A‚ÇÇ rises, the decline in F'(I‚ÇÅ) as I‚ÇÅ increases ensures a finite, determinate level of optimal investment."
            },
            {
                week: 5,
                topic: "Current Account Schedule",
                question: "In a small open economy with free capital mobility, r‚ÇÅ = r* (world rate). If the world rate rises (r* ‚Üë), what happens to CA‚ÇÅ in the production economy?",
                options: [
                    "CA‚ÇÅ worsens as investment increases",
                    "CA‚ÇÅ improves: S‚ÇÅ rises (substitution effect in saving) and I‚ÇÅ falls (higher opportunity cost) ‚Üí CA‚ÇÅ = S‚ÇÅ - I‚ÇÅ unambiguously improves",
                    "CA‚ÇÅ unchanged",
                    "Effect depends on productivity shocks"
                ],
                correct: 1,
                explanation: "r‚ÇÅ = r* rises: (1) S‚ÇÅ = S(r‚ÇÅ‚Å∫, ...) increases (saving more attractive). (2) I‚ÇÅ = I(r‚ÇÅ‚Åª, ...) decreases (investment less profitable). (3) CA‚ÇÅ = S‚ÇÅ - I‚ÇÅ unambiguously improves. Both effects work in same direction."
            },
            {
                week: 5,
                topic: "Production Economy",
                question: "How does the production economy model differ from the endowment economy in Week 3?",
                options: [
                    "No difference; both are identical",
                    "Production economy introduces investment decisions and physical capital: Q_t = A_t F(I_{t-1}); Endowment economy has exogenous output Q_t",
                    "Production economy has no consumption",
                    "Endowment economy includes investment"
                ],
                correct: 1,
                explanation: "Key difference: Endowment economy (Week 3) has exogenous output Q_t. Production economy (Week 5) has endogenous output Q_t = A_t F(I_{t-1}) determined by investment I_{t-1} and productivity A_t. Investment decisions introduce new channels for CA determination."
            },
        ];

        let currentWeek = 'all';
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let answeredCorrectly = []; // Track if answer was correct on first attempt
        let hasAnswered = []; // Track if question has been answered
        let filteredQuestions = [];
        let userName = '';

        // Week selector
        document.querySelectorAll('.week-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.week-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentWeek = this.dataset.week;
            });
        });

        // Leaderboard functions - now using Firebase for global leaderboard
        function saveToLeaderboard(name, score, correct, total, week) {
            const entry = {
                name: name,
                score: score,
                correct: correct,
                total: total,
                week: week,
                date: new Date().toISOString(),
                timestamp: Date.now()
            };

            if (database) {
                // Save to Firebase (global leaderboard)
                const leaderboardRef = database.ref('leaderboard');
                leaderboardRef.push(entry).then(() => {
                    console.log('Score saved to global leaderboard');
                }).catch((error) => {
                    console.error('Error saving to Firebase:', error);
                    // Fallback to localStorage if Firebase fails
                    saveToLocalStorage(entry);
                });
            } else {
                // Fallback to localStorage if Firebase not available
                saveToLocalStorage(entry);
            }
        }

        function saveToLocalStorage(entry) {
            const saved = localStorage.getItem('ec201_leaderboard');
            const leaderboard = saved ? JSON.parse(saved) : [];
            leaderboard.push(entry);
            leaderboard.sort((a, b) => b.score - a.score || b.timestamp - a.timestamp);
            localStorage.setItem('ec201_leaderboard', JSON.stringify(leaderboard));
        }

        function displayLeaderboard(elementId) {
            const element = document.getElementById(elementId);
            element.innerHTML = '<div style="text-align: center; padding: 20px;">Loading global leaderboard...</div>';

            if (database) {
                // Fetch from Firebase (global leaderboard)
                const leaderboardRef = database.ref('leaderboard');
                leaderboardRef.orderByChild('score').limitToLast(100).once('value').then((snapshot) => {
                    const leaderboard = [];
                    snapshot.forEach((childSnapshot) => {
                        leaderboard.push(childSnapshot.val());
                    });

                    // Sort by score descending, then by timestamp
                    leaderboard.sort((a, b) => b.score - a.score || b.timestamp - a.timestamp);

                    renderLeaderboard(leaderboard, element);
                }).catch((error) => {
                    console.error('Error fetching leaderboard:', error);
                    // Fallback to localStorage
                    displayLocalLeaderboard(element);
                });
            } else {
                // Fallback to localStorage
                displayLocalLeaderboard(element);
            }
        }

        function displayLocalLeaderboard(element) {
            const saved = localStorage.getItem('ec201_leaderboard');
            const leaderboard = saved ? JSON.parse(saved) : [];
            renderLeaderboard(leaderboard, element);
        }

        function renderLeaderboard(leaderboard, element) {
            if (leaderboard.length === 0) {
                element.innerHTML = '<div class="no-leaderboard">No scores yet. Be the first!</div>';
                return;
            }

            let html = `
                <div style="text-align: center; margin-bottom: 15px; color: #667eea; font-weight: 600;">
                    üåç Global Leaderboard - ${leaderboard.length} students competing!
                </div>
                <table class="leaderboard-table">
                <thead><tr><th>Rank</th><th>Name</th><th>Score</th><th>Week</th><th>Date</th></tr></thead>
                <tbody>
            `;

            leaderboard.slice(0, 20).forEach((entry, index) => {
                const rankClass = index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : '';
                const date = new Date(entry.date).toLocaleDateString();
                const weekText = entry.week === 'all' ? 'All Weeks' : `Week ${entry.week}`;

                html += `
                    <tr>
                        <td><span class="rank-badge ${rankClass}">${index + 1}</span></td>
                        <td><strong>${entry.name}</strong></td>
                        <td>${entry.score}% (${entry.correct}/${entry.total})</td>
                        <td>${weekText}</td>
                        <td>${date}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            element.innerHTML = html;
        }

        function showLeaderboardOnly() {
            const display = document.getElementById('leaderboardDisplay');
            if (display.style.display === 'none') {
                display.style.display = 'block';
                displayLeaderboard('leaderboardContent');
            } else {
                display.style.display = 'none';
            }
        }

        function startQuiz() {
            // Get user name
            userName = document.getElementById('userName').value.trim();
            if (!userName) {
                alert('Please enter your name before starting the quiz!');
                return;
            }
            // Filter questions based on selected week
            if (currentWeek === 'all') {
                filteredQuestions = [...questions];
            } else {
                filteredQuestions = questions.filter(q => q.week === parseInt(currentWeek));
            }

            // Reset state
            currentQuestionIndex = 0;
            userAnswers = new Array(filteredQuestions.length).fill(null);
            answeredCorrectly = new Array(filteredQuestions.length).fill(false);
            hasAnswered = new Array(filteredQuestions.length).fill(false);

            // Show quiz area
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('quizArea').style.display = 'block';
            document.getElementById('results').classList.remove('show');

            // Display user greeting
            document.getElementById('userGreeting').innerHTML = `Good luck, <strong>${userName}</strong>! üéì`;

            displayQuestion();
        }

        function displayQuestion() {
            const container = document.getElementById('questionContainer');
            const question = filteredQuestions[currentQuestionIndex];

            container.innerHTML = `
                <div class="question-card active">
                    <div class="question-header">
                        <span class="question-number">Question ${currentQuestionIndex + 1} of ${filteredQuestions.length}</span>
                        <span class="question-number">Week ${question.week}</span>
                    </div>
                    <div class="question-text">${question.question}</div>
                    <div class="options">
                        ${question.options.map((option, index) => `
                            <div class="option" onclick="selectAnswer(${index})" data-index="${index}">
                                <span class="option-label">${String.fromCharCode(65 + index)}.</span>
                                ${option}
                            </div>
                        `).join('')}
                    </div>
                    <div class="feedback" id="feedback"></div>
                </div>
            `;

            // Restore previous answer if exists
            if (userAnswers[currentQuestionIndex] !== null) {
                selectAnswer(userAnswers[currentQuestionIndex], true);
            }

            updateProgress();
            updateButtons();
        }

        function selectAnswer(index, skipFeedback = false) {
            // If already answered, don't allow changing
            if (hasAnswered[currentQuestionIndex] && !skipFeedback) {
                return;
            }

            const options = document.querySelectorAll('.option');
            options.forEach(opt => {
                opt.classList.remove('selected', 'correct', 'incorrect');
            });

            options[index].classList.add('selected');
            userAnswers[currentQuestionIndex] = index;

            if (!skipFeedback) {
                showFeedback(index);
            }

            document.getElementById('nextBtn').disabled = false;
        }

        function showFeedback(selectedIndex) {
            const question = filteredQuestions[currentQuestionIndex];
            const feedback = document.getElementById('feedback');
            const options = document.querySelectorAll('.option');

            // Mark as answered
            hasAnswered[currentQuestionIndex] = true;

            // Disable all options after first attempt
            options.forEach(opt => {
                opt.style.cursor = 'not-allowed';
                opt.style.opacity = '0.7';
                opt.onclick = null;
            });

            if (selectedIndex === question.correct) {
                // Only count as correct if it's the first attempt
                answeredCorrectly[currentQuestionIndex] = true;
                feedback.className = 'feedback correct show';
                feedback.innerHTML = `<strong>‚úì Correct!</strong> ${question.explanation}`;
                options[selectedIndex].classList.add('correct');
            } else {
                // Wrong answer - will NOT count toward score
                answeredCorrectly[currentQuestionIndex] = false;
                feedback.className = 'feedback incorrect show';
                feedback.innerHTML = `<strong>‚úó Incorrect.</strong> ${question.explanation}<br><br><em>Note: You cannot change your answer. This will count as incorrect in your final score.</em>`;
                options[selectedIndex].classList.add('incorrect');
                options[question.correct].classList.add('correct');
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < filteredQuestions.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                showResults();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / filteredQuestions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function updateButtons() {
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;

            if (currentQuestionIndex === filteredQuestions.length - 1) {
                document.getElementById('nextBtn').textContent = 'Finish Quiz';
            } else {
                document.getElementById('nextBtn').textContent = 'Next Question';
            }
        }

        function analyzePerformance() {
            // Analyze performance by topic
            const topicStats = {};

            filteredQuestions.forEach((question, index) => {
                const topic = question.topic || 'General';
                const week = question.week;

                if (!topicStats[week]) {
                    topicStats[week] = {};
                }

                if (!topicStats[week][topic]) {
                    topicStats[week][topic] = {
                        correct: 0,
                        total: 0,
                        questions: []
                    };
                }

                topicStats[week][topic].total++;
                topicStats[week][topic].questions.push(question.question);

                if (answeredCorrectly[index]) {
                    topicStats[week][topic].correct++;
                }
            });

            // Generate AI review
            let reviewHTML = '';
            let weakTopics = [];
            let strongTopics = [];

            // Analyze each week
            Object.keys(topicStats).sort().forEach(week => {
                const topics = topicStats[week];

                Object.keys(topics).forEach(topicName => {
                    const stat = topics[topicName];
                    const accuracy = (stat.correct / stat.total) * 100;

                    const topicData = {
                        week: week,
                        topic: topicName,
                        accuracy: accuracy,
                        correct: stat.correct,
                        total: stat.total
                    };

                    if (accuracy < 60) {
                        weakTopics.push(topicData);
                    } else if (accuracy >= 80) {
                        strongTopics.push(topicData);
                    }
                });
            });

            // Sort weak topics by accuracy (worst first)
            weakTopics.sort((a, b) => a.accuracy - b.accuracy);

            // Generate summary
            if (weakTopics.length > 0) {
                reviewHTML += '<div class="ai-summary">';
                reviewHTML += `<strong>Key Finding:</strong> You should focus on improving your understanding of `;
                reviewHTML += weakTopics.slice(0, 3).map(t => `<strong>${t.topic}</strong> (Week ${t.week})`).join(', ');
                reviewHTML += '.</div>';
            } else {
                reviewHTML += '<div class="ai-summary">';
                reviewHTML += `<strong>Excellent!</strong> You have a strong grasp across all topics. Keep up the great work!`;
                reviewHTML += '</div>';
            }

            // Show weak topics first
            if (weakTopics.length > 0) {
                reviewHTML += '<h4 style="color: #dc3545; margin-top: 20px;">‚ö†Ô∏è Topics Needing Attention:</h4>';
                weakTopics.forEach(topic => {
                    reviewHTML += `<div class="topic-analysis">`;
                    reviewHTML += `<div class="topic-name">Week ${topic.week}: ${topic.topic}</div>`;
                    reviewHTML += `<div class="topic-score">Accuracy: ${Math.round(topic.accuracy)}% (${topic.correct}/${topic.total} correct)</div>`;
                    reviewHTML += `</div>`;
                });
            }

            // Show strong topics
            if (strongTopics.length > 0) {
                reviewHTML += '<h4 style="color: #28a745; margin-top: 20px;">‚úÖ Topics You Mastered:</h4>';
                strongTopics.forEach(topic => {
                    reviewHTML += `<div class="topic-analysis good">`;
                    reviewHTML += `<div class="topic-name">Week ${topic.week}: ${topic.topic}</div>`;
                    reviewHTML += `<div class="topic-score">Accuracy: ${Math.round(topic.accuracy)}% (${topic.correct}/${topic.total} correct)</div>`;
                    reviewHTML += `</div>`;
                });
            }

            // Add recommendations
            if (weakTopics.length > 0) {
                reviewHTML += '<div class="recommendations">';
                reviewHTML += '<h4 style="color: #667eea;">üí° Recommendations:</h4>';

                weakTopics.slice(0, 3).forEach(topic => {
                    let recommendation = '';

                    // Customized recommendations based on topic
                    if (topic.topic.includes('NIIP')) {
                        recommendation = 'Review the relationship between Current Account flows and valuation changes. Practice calculating NIIP changes.';
                    } else if (topic.topic.includes('Dark Matter')) {
                        recommendation = 'Revisit the US NIIP-NII paradox. Understand both the Dark Matter hypothesis and Return Differential hypothesis.';
                    } else if (topic.topic.includes('Finite vs Infinite')) {
                        recommendation = 'Focus on the key difference: finite horizon has hard constraints (B_T=0), while infinite horizon has soft constraints (PV‚Üí0).';
                    } else if (topic.topic.includes('Transversality')) {
                        recommendation = 'Remember: the transversality condition states that the PRESENT VALUE of debt must vanish, not the debt itself.';
                    } else if (topic.topic.includes('Perpetual Deficits')) {
                        recommendation = 'Study when perpetual CA deficits are sustainable. Key: debt must grow slower than interest rate (g < r).';
                    } else if (topic.topic.includes('Temporary vs Permanent')) {
                        recommendation = 'Master the principle: economies FINANCE temporary shocks (through borrowing) and ADJUST to permanent shocks (by changing consumption).';
                    } else if (topic.topic.includes('Euler')) {
                        recommendation = 'Practice deriving and interpreting the Euler equation. Understand how it relates to optimal intertemporal consumption choice.';
                    } else if (topic.topic.includes('Consumption Smoothing')) {
                        recommendation = 'Understand why households prefer stable consumption over time due to concave utility functions.';
                    } else {
                        recommendation = `Re-read the lecture notes on ${topic.topic} and try practice problems to strengthen your understanding.`;
                    }

                    reviewHTML += `<div class="recommendation-item">`;
                    reviewHTML += `<strong>Week ${topic.week} - ${topic.topic}:</strong> ${recommendation}`;
                    reviewHTML += `</div>`;
                });

                reviewHTML += '</div>';
            }

            document.getElementById('aiReview').innerHTML = reviewHTML;
        }

        function showResults() {
            // Count only answers that were correct on FIRST attempt
            let correct = 0;
            answeredCorrectly.forEach((isCorrect) => {
                if (isCorrect) {
                    correct++;
                }
            });

            const percentage = Math.round((correct / filteredQuestions.length) * 100);

            // Save to leaderboard
            saveToLeaderboard(userName, percentage, correct, filteredQuestions.length, currentWeek);

            document.getElementById('quizArea').style.display = 'none';
            document.getElementById('results').classList.add('show');

            document.getElementById('scoreCircle').textContent = percentage + '%';
            document.getElementById('correctCount').textContent = correct;
            document.getElementById('incorrectCount').textContent = filteredQuestions.length - correct;
            document.getElementById('totalCount').textContent = filteredQuestions.length;

            let title = 'Quiz Complete!';
            if (percentage === 100) title = `Perfect Score, ${userName}!`;
            else if (percentage >= 80) title = `Excellent Work, ${userName}!`;
            else if (percentage >= 60) title = `Good Job, ${userName}!`;
            else if (percentage >= 40) title = `Keep Practicing, ${userName}!`;

            document.getElementById('resultsTitle').textContent = title;

            // Generate AI performance analysis
            analyzePerformance();

            // Display leaderboard
            displayLeaderboard('finalLeaderboard');
        }

        function restartQuiz() {
            document.getElementById('results').classList.remove('show');
            document.getElementById('startScreen').style.display = 'block';
        }
    </script>
</body>
</html>
