<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EC201 International Macroeconomics Quiz - Weeks 1-3</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            background-attachment: fixed;
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3), transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(102, 126, 234, 0.2), transparent 50%);
            pointer-events: none;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            box-shadow: 0 30px 80px rgba(0,0,0,0.4), 0 0 0 1px rgba(255,255,255,0.1);
            overflow: hidden;
            position: relative;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse"><path d="M 40 0 L 0 0 0 40" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            opacity: 0.5;
        }

        .logos-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            margin-bottom: 25px;
            position: relative;
            z-index: 1;
        }

        .header-logo {
            height: 70px;
            width: auto;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
            transition: transform 0.3s ease;
        }

        .header-logo:hover {
            transform: scale(1.05);
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 12px;
            font-weight: 700;
            letter-spacing: -0.5px;
            position: relative;
            z-index: 1;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 17px;
            opacity: 0.95;
            font-weight: 400;
            position: relative;
            z-index: 1;
        }

        .ai-disclaimer {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 20px 10px 20px;
            text-align: center;
        }

        .ai-disclaimer p {
            margin: 0;
            font-size: 0.9em;
            line-height: 1.6;
            color: #4a5568;
        }

        .ai-disclaimer strong {
            color: #6366f1;
            font-size: 1.05em;
        }

        .week-selector {
            display: flex;
            justify-content: center;
            gap: 12px;
            padding: 30px 20px;
            background: linear-gradient(180deg, #f8f9fa 0%, #ffffff 100%);
            flex-wrap: wrap;
            border-bottom: 1px solid #e9ecef;
        }

        .difficulty-selector {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            gap: 15px;
            padding: 20px;
            background: linear-gradient(180deg, #ffffff 0%, #f8f9fa 100%);
            border-bottom: 1px solid #e9ecef;
        }

        .difficulty-label {
            text-align: center;
            font-weight: 600;
            color: #4a5568;
            font-size: 1em;
        }

        .difficulty-buttons {
            display: flex;
            gap: 12px;
        }

        .difficulty-btn {
            padding: 12px 28px;
            border: 2px solid #e9ecef;
            background: white;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95em;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .difficulty-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(139, 92, 246, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .difficulty-btn:hover::before {
            left: 100%;
        }

        .difficulty-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.15);
            border-color: #8b5cf6;
        }

        .difficulty-btn.active {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            border-color: #8b5cf6;
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.3);
        }

        .week-btn {
            padding: 14px 28px;
            border: 2px solid transparent;
            background: white;
            color: #667eea;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
            position: relative;
            overflow: hidden;
        }

        .week-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .week-btn:hover::before {
            left: 100%;
        }

        .week-btn:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
            border-color: transparent;
        }

        .week-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .quiz-area {
            padding: 30px;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e9ecef;
            border-radius: 10px;
            margin-bottom: 35px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.06);
            position: relative;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, rgba(255,255,255,0.3), transparent);
            border-radius: 10px 10px 0 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 30px;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4));
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        .question-card {
            display: none;
        }

        .question-card.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .question-number {
            font-size: 14px;
            color: #667eea;
            font-weight: 600;
        }

        .question-text {
            font-size: 20px;
            color: #2d3748;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option {
            padding: 20px 24px;
            border: 2px solid #e9ecef;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            position: relative;
            overflow: hidden;
        }

        .option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .option:hover::before {
            transform: scaleY(1);
        }

        .option:hover {
            border-color: #667eea;
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            transform: translateX(8px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #edf2f7 0%, #e6f2ff 100%);
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.2);
        }

        .option.selected::before {
            transform: scaleY(1);
        }

        .option.correct {
            border-color: #48bb78;
            background: linear-gradient(135deg, #f0fff4 0%, #dcffe4 100%);
            box-shadow: 0 4px 16px rgba(72, 187, 120, 0.2);
        }

        .option.correct::before {
            background: #48bb78;
            transform: scaleY(1);
        }

        .option.incorrect {
            border-color: #f56565;
            background: linear-gradient(135deg, #fff5f5 0%, #ffebeb 100%);
            box-shadow: 0 4px 16px rgba(245, 101, 101, 0.2);
        }

        .option.incorrect::before {
            background: #f56565;
            transform: scaleY(1);
        }

        .option-label {
            font-weight: 600;
            color: #667eea;
            margin-right: 10px;
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }

        .feedback.show {
            display: block;
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .feedback.correct {
            background: #f0fff4;
            border-left: 4px solid #48bb78;
            color: #22543d;
        }

        .feedback.incorrect {
            background: #fff5f5;
            border-left: 4px solid #f56565;
            color: #742a2a;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: space-between;
        }

        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%);
            color: #2d3748;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #dee2e6 0%, #e9ecef 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .results {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .results.show {
            display: block;
            animation: fadeIn 0.5s;
        }

        .score-circle {
            width: 220px;
            height: 220px;
            margin: 0 auto 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 56px;
            font-weight: 800;
            box-shadow:
                0 15px 40px rgba(102, 126, 234, 0.4),
                0 0 0 10px rgba(102, 126, 234, 0.1),
                0 0 0 20px rgba(102, 126, 234, 0.05);
            position: relative;
            animation: scoreReveal 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes scoreReveal {
            0% {
                transform: scale(0) rotate(-180deg);
                opacity: 0;
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        .score-circle::before {
            content: '';
            position: absolute;
            inset: -3px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            opacity: 0.5;
            filter: blur(10px);
            z-index: -1;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 0.5;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.3;
            }
        }

        .results h2 {
            font-size: 32px;
            color: #2d3748;
            margin-bottom: 20px;
        }

        .results-details {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .result-stat {
            text-align: center;
        }

        .result-stat-value {
            font-size: 36px;
            font-weight: bold;
            color: #667eea;
        }

        .result-stat-label {
            font-size: 14px;
            color: #718096;
            margin-top: 5px;
        }

        .start-screen {
            text-align: center;
            padding: 60px 40px;
        }

        .start-screen h2 {
            font-size: 32px;
            color: #2d3748;
            margin-bottom: 20px;
        }

        .start-screen p {
            font-size: 18px;
            color: #718096;
            margin-bottom: 40px;
            line-height: 1.8;
        }

        .week-description {
            background: #f7fafc;
            padding: 20px;
            border-radius: 12px;
            margin: 30px 0;
            text-align: left;
        }

        .week-description h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .week-description ul {
            list-style-position: inside;
            color: #4a5568;
            line-height: 2;
        }

        .name-input-section {
            margin: 30px 0;
        }

        .name-input {
            padding: 18px 24px;
            font-size: 17px;
            border: 2px solid #e9ecef;
            border-radius: 14px;
            width: 100%;
            max-width: 450px;
            margin: 10px auto;
            display: block;
            text-align: center;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .name-input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.15);
            transform: translateY(-2px);
        }

        .name-input::placeholder {
            color: #adb5bd;
            font-weight: 400;
        }

        .ai-review-section {
            background: linear-gradient(135deg, #f5f7fa 0%, #e8edf4 100%);
            padding: 30px;
            border-radius: 12px;
            margin-top: 30px;
            text-align: left;
            border: 2px solid #667eea;
        }

        .ai-review-section h3 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
            font-size: 24px;
        }

        .ai-review-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            line-height: 1.8;
        }

        .ai-loading {
            text-align: center;
            color: #667eea;
            font-style: italic;
            padding: 20px;
        }

        .topic-analysis {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #dc3545;
            border-radius: 4px;
        }

        .topic-analysis.good {
            border-left-color: #28a745;
        }

        .topic-analysis.okay {
            border-left-color: #ffc107;
        }

        .topic-name {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .topic-score {
            font-size: 14px;
            color: #718096;
        }

        .ai-summary {
            background: #667eea;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .recommendations {
            margin-top: 20px;
        }

        .recommendation-item {
            padding: 10px;
            margin: 10px 0;
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            border-radius: 4px;
        }

        .leaderboard-section {
            background: #f7fafc;
            padding: 30px;
            border-radius: 12px;
            margin-top: 30px;
            text-align: left;
        }

        .leaderboard-section h3 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
            font-size: 24px;
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
        }

        .leaderboard-table th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        .leaderboard-table td {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
        }

        .leaderboard-table tr:hover {
            background: #edf2f7;
        }

        .rank-badge {
            display: inline-block;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            font-size: 14px;
        }

        .rank-badge.gold {
            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
        }

        .rank-badge.silver {
            background: linear-gradient(135deg, #a8b8d8 0%, #c7d2e9 100%);
        }

        .rank-badge.bronze {
            background: linear-gradient(135deg, #cd7f32 0%, #d4926f 100%);
        }

        .share-section {
            margin-top: 30px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 12px;
        }

        .share-section h4 {
            color: #2d3748;
            margin-bottom: 15px;
        }

        .share-link {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .share-link input {
            flex: 1;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
        }

        .btn-copy {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-copy:hover {
            background: #5568d3;
        }

        .user-greeting {
            text-align: center;
            padding: 20px;
            background: #f7fafc;
            color: #2d3748;
            font-size: 18px;
        }

        .user-greeting strong {
            color: #667eea;
        }

        .no-leaderboard {
            text-align: center;
            color: #718096;
            padding: 20px;
            font-style: italic;
        }

        .view-leaderboard-btn {
            margin-top: 20px;
            padding: 12px 24px;
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
        }

        .view-leaderboard-btn:hover {
            background: #667eea;
            color: white;
        }

        /* Chat Styles */
        .chat-toggle-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .chat-toggle-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.6);
        }

        .chat-container {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 380px;
            height: 550px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            display: none;
            flex-direction: column;
            z-index: 999;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .chat-container.show {
            display: flex;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            font-weight: 600;
            font-size: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .chat-close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            background: linear-gradient(180deg, #f8f9fa 0%, #ffffff 100%);
        }

        .chat-message {
            display: flex;
            flex-direction: column;
            gap: 4px;
            animation: messageSlide 0.3s ease-out;
        }

        @keyframes messageSlide {
            from {
                transform: translateX(-10px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .chat-message-author {
            font-size: 12px;
            font-weight: 600;
            color: #667eea;
        }

        .chat-message-text {
            background: white;
            padding: 12px 16px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            word-wrap: break-word;
            max-width: 85%;
            color: #2d3748;
            line-height: 1.5;
        }

        .chat-message-time {
            font-size: 11px;
            color: #a0aec0;
            margin-top: 2px;
        }

        .chat-input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
            font-family: 'Inter', sans-serif;
        }

        .chat-input:focus {
            border-color: #667eea;
        }

        .chat-send-btn {
            padding: 12px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s;
        }

        .chat-send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .chat-send-btn:active {
            transform: translateY(0);
        }

        /* Mobile responsiveness for chat */
        @media (max-width: 768px) {
            .chat-container {
                width: calc(100vw - 40px);
                right: 20px;
                bottom: 90px;
                height: 500px;
            }

            .chat-toggle-btn {
                right: 20px;
                bottom: 20px;
            }
        }

        /* Poll Styles */
        .poll-section {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.05), rgba(99, 102, 241, 0.05));
            border: 2px solid rgba(139, 92, 246, 0.2);
            border-radius: 16px;
            padding: 25px;
            margin: 20px;
        }

        .poll-title {
            font-size: 20px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 8px;
            text-align: center;
        }

        .poll-subtitle {
            font-size: 14px;
            color: #718096;
            margin-bottom: 20px;
            text-align: center;
        }

        .poll-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .poll-option {
            position: relative;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .poll-option:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .poll-option.voted {
            cursor: default;
        }

        .poll-option-bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: linear-gradient(90deg, rgba(102, 126, 234, 0.1), rgba(139, 92, 246, 0.1));
            transition: width 0.5s ease;
            z-index: 0;
        }

        .poll-option-content {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .poll-option-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .poll-option-text {
            font-weight: 600;
            color: #2d3748;
            font-size: 14px;
        }

        .poll-option-percentage {
            font-weight: 700;
            color: #667eea;
            font-size: 16px;
        }

        .poll-option-votes {
            font-size: 12px;
            color: #718096;
            font-style: italic;
        }

        .poll-option.voted .poll-option-text {
            font-weight: 700;
        }

        .poll-total-votes {
            text-align: center;
            color: #718096;
            font-size: 13px;
            margin-top: 15px;
            font-style: italic;
        }

        .poll-vote-btn {
            display: none;
        }

        .poll-option input[type="radio"] {
            display: none;
        }

        .poll-option.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .poll-submit-btn {
            display: block;
            margin: 20px auto 0;
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .poll-submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .poll-submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        @media (max-width: 768px) {
            .poll-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logos-container">
                <img src="Warwick_University_Shield.svg.png" alt="Warwick Shield" class="header-logo">
                <img src="u_of_w_third_party_lockup_positive_rgb.jpg" alt="University of Warwick" class="header-logo">
            </div>
            <h1>EC201 International Macroeconomics</h1>
            <p>MCQ Assessment - Weeks 1-5</p>
        </div>

        <div class="ai-disclaimer">
            <p>
                <strong>ðŸ“Š About These Questions:</strong><br><br>
                These questions have been derived from all content uploaded to Moodle for EC201 using AI analysis, including pre-class questions, pre-class answers, in-class questions, lecture slides, and reference books.<br><br>

                The questions are designed to reflect concepts with a higher likelihood of exam appearance based on comprehensive content analysis.<br><br>

                Questions are designed with the intention of understanding and learning the content in the fastest amount of time rather than assessment. Constant quality checks are made on the question quality.<br><br>

                More questions will be uploaded to the site during the week. Questions are now categorized into easy and hard difficulty levels.<br><br>

                There may be some issues with the mathematical formulation of certain questions, which are being worked on and should be fixed soon.<br><br>

                Any opinions or ideas are welcomed through the chat panel designed on the site.
            </p>
        </div>

        <div class="week-selector">
            <button class="week-btn active" data-week="all">All Weeks</button>
            <button class="week-btn" data-week="1">Week 1: Global Imbalances</button>
            <button class="week-btn" data-week="2">Week 2: Sustainability</button>
            <button class="week-btn" data-week="3">Week 3: Current Account Theory</button>
            <button class="week-btn" data-week="4">Week 4: Terms of Trade & Tariffs</button>
            <button class="week-btn" data-week="5">Week 5: Production Economy</button>
        </div>

        <div class="difficulty-selector">
            <div class="difficulty-label">ðŸ“Š Select Difficulty Level:</div>
            <div class="difficulty-buttons">
                <button class="difficulty-btn active" data-difficulty="easy">ðŸŸ¢ Easy - Original Questions</button>
                <button class="difficulty-btn" data-difficulty="hard">ðŸ”´ Hard - Challenging Questions</button>
            </div>
        </div>

        <!-- Belgrade Tracker Toggle Button -->
        <div style="text-align: center; padding: 15px; background: #f8f9fa;">
            <button onclick="toggleBelgradeTracker()" class="btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer;">
                ðŸ“Š Belgrade Tracker - Professor's Emphasis Patterns
            </button>
        </div>

        <!-- Belgrade Tracker Section -->
        <div id="belgradeTracker" style="display: none; padding: 30px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <div style="max-width: 1200px; margin: 0 auto; background: white; border-radius: 16px; padding: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.1);">
                <h2 style="text-align: center; color: #667eea; margin-bottom: 10px; font-size: 2em;">ðŸ“Š Belgrade Tracker</h2>
                <p style="text-align: center; color: #64748b; margin-bottom: 15px; font-style: italic; line-height: 1.6; max-width: 900px; margin-left: auto; margin-right: auto;">
                    Professor Vukotic has an emphasis on repeating "test" to reference potential questions. We analyzed her complete lecture recordings across 7 weeks to identify which weeks she discussed the test most frequently, along with the primary topics emphasized in each lecture.
                </p>

                <!-- Test/Exam Mentions by Lecture -->
                <div style="margin-bottom: 40px;">
                    <h3 style="color: #2d3748; border-bottom: 3px solid #667eea; padding-bottom: 10px; margin-bottom: 20px;">ðŸŽ¯ Test/Exam References Per Lecture</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div style="background: linear-gradient(135deg, #fef3c7 0%, #fcd34d 100%); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                            <div style="font-size: 0.85em; color: #92400e; font-weight: 600;">Oct 9 - Week 1</div>
                            <div style="font-size: 1.1em; color: #78350f; margin-top: 5px;"><strong>Test:</strong> 17 times</div>
                            <div style="font-size: 1.1em; color: #78350f;"><strong>Exam:</strong> 63 times</div>
                            <div style="font-size: 0.8em; color: #a16207; margin-top: 5px;">OK: 259 times</div>
                            <div style="border-top: 1px solid rgba(146,64,14,0.2); margin-top: 10px; padding-top: 10px;">
                                <div style="font-size: 0.75em; color: #92400e; text-transform: uppercase; letter-spacing: 0.5px;">Most Discussed</div>
                                <div style="font-size: 0.9em; color: #78350f; font-weight: 600; margin-top: 3px;">Current Account & NIIP</div>
                            </div>
                        </div>
                        <div style="background: linear-gradient(135deg, #ddd6fe 0%, #c4b5fd 100%); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                            <div style="font-size: 0.85em; color: #5b21b6; font-weight: 600;">Oct 16 - Week 2</div>
                            <div style="font-size: 1.1em; color: #6b21a8; margin-top: 5px;"><strong>Test:</strong> 2 times</div>
                            <div style="font-size: 1.1em; color: #6b21a8;"><strong>Exam:</strong> 11 times</div>
                            <div style="font-size: 0.8em; color: #7c3aed; margin-top: 5px;">OK: 297 times</div>
                            <div style="border-top: 1px solid rgba(91,33,182,0.2); margin-top: 10px; padding-top: 10px;">
                                <div style="font-size: 0.75em; color: #5b21b6; text-transform: uppercase; letter-spacing: 0.5px;">Most Discussed</div>
                                <div style="font-size: 0.9em; color: #6b21a8; font-weight: 600; margin-top: 3px;">Trade Balance & Transversality</div>
                            </div>
                        </div>
                        <div style="background: linear-gradient(135deg, #bbf7d0 0%, #86efac 100%); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                            <div style="font-size: 0.85em; color: #166534; font-weight: 600;">Oct 23 - Week 3</div>
                            <div style="font-size: 1.1em; color: #15803d; margin-top: 5px;"><strong>Test:</strong> 4 times</div>
                            <div style="font-size: 1.1em; color: #15803d;"><strong>Exam:</strong> 21 times</div>
                            <div style="font-size: 0.8em; color: #16a34a; margin-top: 5px;">OK: 321 times</div>
                            <div style="border-top: 1px solid rgba(22,101,52,0.2); margin-top: 10px; padding-top: 10px;">
                                <div style="font-size: 0.75em; color: #166534; text-transform: uppercase; letter-spacing: 0.5px;">Most Discussed</div>
                                <div style="font-size: 0.9em; color: #15803d; font-weight: 600; margin-top: 3px;">Consumption & Euler Equation</div>
                            </div>
                        </div>
                        <div style="background: linear-gradient(135deg, #fed7aa 0%, #fdba74 100%); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                            <div style="font-size: 0.85em; color: #9a3412; font-weight: 600;">Oct 30 - Week 4</div>
                            <div style="font-size: 1.1em; color: #c2410c; margin-top: 5px;"><strong>Test:</strong> 0 times</div>
                            <div style="font-size: 1.1em; color: #c2410c;"><strong>Exam:</strong> 35 times</div>
                            <div style="font-size: 0.8em; color: #ea580c; margin-top: 5px;">OK: 206 times</div>
                            <div style="border-top: 1px solid rgba(154,52,18,0.2); margin-top: 10px; padding-top: 10px;">
                                <div style="font-size: 0.75em; color: #9a3412; text-transform: uppercase; letter-spacing: 0.5px;">Most Discussed</div>
                                <div style="font-size: 0.9em; color: #c2410c; font-weight: 600; margin-top: 3px;">Interest Rates & Consumption</div>
                            </div>
                        </div>
                        <div style="background: linear-gradient(135deg, #bfdbfe 0%, #93c5fd 100%); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                            <div style="font-size: 0.85em; color: #1e40af; font-weight: 600;">Nov 6 - Week 5</div>
                            <div style="font-size: 1.1em; color: #1e3a8a; margin-top: 5px;"><strong>Test:</strong> 4 times</div>
                            <div style="font-size: 1.1em; color: #1e3a8a;"><strong>Exam:</strong> 11 times</div>
                            <div style="font-size: 0.8em; color: #2563eb; margin-top: 5px;">OK: 209 times</div>
                            <div style="border-top: 1px solid rgba(30,64,175,0.2); margin-top: 10px; padding-top: 10px;">
                                <div style="font-size: 0.75em; color: #1e40af; text-transform: uppercase; letter-spacing: 0.5px;">Most Discussed</div>
                                <div style="font-size: 0.9em; color: #1e3a8a; font-weight: 600; margin-top: 3px;">Investment & Interest Rates</div>
                            </div>
                        </div>
                        <div style="background: linear-gradient(135deg, #fecaca 0%, #fca5a5 100%); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                            <div style="font-size: 0.85em; color: #991b1b; font-weight: 600;">Nov 13 - Week 6</div>
                            <div style="font-size: 1.1em; color: #b91c1c; margin-top: 5px;"><strong>Test:</strong> 10 times</div>
                            <div style="font-size: 1.1em; color: #b91c1c;"><strong>Exam:</strong> 19 times</div>
                            <div style="font-size: 0.8em; color: #dc2626; margin-top: 5px;">OK: 223 times</div>
                            <div style="border-top: 1px solid rgba(153,27,27,0.2); margin-top: 10px; padding-top: 10px;">
                                <div style="font-size: 0.75em; color: #991b1b; text-transform: uppercase; letter-spacing: 0.5px;">Most Discussed</div>
                                <div style="font-size: 0.9em; color: #b91c1c; font-weight: 600; margin-top: 3px;">Saving & Consumption</div>
                            </div>
                        </div>
                        <div style="background: linear-gradient(135deg, #fbcfe8 0%, #f9a8d4 100%); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                            <div style="font-size: 0.85em; color: #831843; font-weight: 600;">Nov 20 - Week 7</div>
                            <div style="font-size: 1.1em; color: #9f1239; margin-top: 5px;"><strong>Test:</strong> 26 times</div>
                            <div style="font-size: 1.1em; color: #9f1239;"><strong>Exam:</strong> 28 times</div>
                            <div style="font-size: 0.8em; color: #db2777; margin-top: 5px;">OK: 227 times</div>
                            <div style="border-top: 1px solid rgba(131,24,67,0.2); margin-top: 10px; padding-top: 10px;">
                                <div style="font-size: 0.75em; color: #831843; text-transform: uppercase; letter-spacing: 0.5px;">Most Discussed</div>
                                <div style="font-size: 0.9em; color: #9f1239; font-weight: 600; margin-top: 3px;">Interest Rates & Saving</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Topic Emphasis Chart -->
                <div style="margin-bottom: 40px;">
                    <h3 style="color: #2d3748; border-bottom: 3px solid #667eea; padding-bottom: 10px; margin-bottom: 20px;">ðŸ“š Topic Emphasis Across All Lectures</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div style="background: #f0f9ff; padding: 15px; border-radius: 10px; border-left: 4px solid #0ea5e9;">
                            <div style="font-weight: 600; color: #0c4a6e; margin-bottom: 5px;">Current Account</div>
                            <div style="font-size: 1.5em; color: #0369a1;">439</div>
                            <div style="font-size: 0.75em; color: #64748b;">total mentions</div>
                        </div>
                        <div style="background: #fef3c7; padding: 15px; border-radius: 10px; border-left: 4px solid #eab308;">
                            <div style="font-weight: 600; color: #713f12; margin-bottom: 5px;">Trade Balance</div>
                            <div style="font-size: 1.5em; color: #a16207;">271</div>
                            <div style="font-size: 0.75em; color: #64748b;">total mentions</div>
                        </div>
                        <div style="background: #fce7f3; padding: 15px; border-radius: 10px; border-left: 4px solid #ec4899;">
                            <div style="font-weight: 600; color: #831843; margin-bottom: 5px;">Interest Rate</div>
                            <div style="font-size: 1.5em; color: #9f1239;">368</div>
                            <div style="font-size: 0.75em; color: #64748b;">total mentions</div>
                        </div>
                        <div style="background: #f0fdf4; padding: 15px; border-radius: 10px; border-left: 4px solid #22c55e;">
                            <div style="font-weight: 600; color: #14532d; margin-bottom: 5px;">Consumption</div>
                            <div style="font-size: 1.5em; color: #15803d;">327</div>
                            <div style="font-size: 0.75em; color: #64748b;">total mentions</div>
                        </div>
                        <div style="background: #ede9fe; padding: 15px; border-radius: 10px; border-left: 4px solid #a855f7;">
                            <div style="font-weight: 600; color: #581c87; margin-bottom: 5px;">Investment</div>
                            <div style="font-size: 1.5em; color: #7e22ce;">275</div>
                            <div style="font-size: 0.75em; color: #64748b;">total mentions</div>
                        </div>
                        <div style="background: #fff7ed; padding: 15px; border-radius: 10px; border-left: 4px solid #f97316;">
                            <div style="font-weight: 600; color: #7c2d12; margin-bottom: 5px;">Saving</div>
                            <div style="font-size: 1.5em; color: #c2410c;">207</div>
                            <div style="font-size: 0.75em; color: #64748b;">total mentions</div>
                        </div>
                        <div style="background: #e0f2fe; padding: 15px; border-radius: 10px; border-left: 4px solid #06b6d4;">
                            <div style="font-weight: 600; color: #164e63; margin-bottom: 5px;">Tariff</div>
                            <div style="font-size: 1.5em; color: #0e7490;">78</div>
                            <div style="font-size: 0.75em; color: #64748b;">total mentions</div>
                        </div>
                        <div style="background: #fef2f2; padding: 15px; border-radius: 10px; border-left: 4px solid #ef4444;">
                            <div style="font-weight: 600; color: #7f1d1d; margin-bottom: 5px;">Terms of Trade</div>
                            <div style="font-size: 1.5em; color: #b91c1c;">71</div>
                            <div style="font-size: 0.75em; color: #64748b;">total mentions</div>
                        </div>
                        <div style="background: #faf5ff; padding: 15px; border-radius: 10px; border-left: 4px solid #d946ef;">
                            <div style="font-weight: 600; color: #701a75; margin-bottom: 5px;">Valuation</div>
                            <div style="font-size: 1.5em; color: #a21caf;">47</div>
                            <div style="font-size: 0.75em; color: #64748b;">total mentions</div>
                        </div>
                        <div style="background: #ecfdf5; padding: 15px; border-radius: 10px; border-left: 4px solid #10b981;">
                            <div style="font-weight: 600; color: #065f46; margin-bottom: 5px;">Euler</div>
                            <div style="font-size: 1.5em; color: #059669;">34</div>
                            <div style="font-size: 0.75em; color: #64748b;">total mentions</div>
                        </div>
                        <div style="background: #fff1f2; padding: 15px; border-radius: 10px; border-left: 4px solid #f43f5e;">
                            <div style="font-weight: 600; color: #881337; margin-bottom: 5px;">Transversality</div>
                            <div style="font-size: 1.5em; color: #be123c;">8</div>
                            <div style="font-size: 0.75em; color: #64748b;">total mentions</div>
                        </div>
                    </div>
                </div>

                <!-- Summary Stats -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 25px; border-radius: 12px; color: white;">
                    <h3 style="margin-bottom: 15px; text-align: center;">ðŸ“ˆ Overall Statistics</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; text-align: center;">
                        <div>
                            <div style="font-size: 2em; font-weight: bold;">251</div>
                            <div style="font-size: 0.9em; opacity: 0.9;">Total "Test/Exam" Mentions</div>
                        </div>
                        <div>
                            <div style="font-size: 2em; font-weight: bold;">1,742</div>
                            <div style="font-size: 0.9em; opacity: 0.9;">Total "OK" Count</div>
                        </div>
                        <div>
                            <div style="font-size: 2em; font-weight: bold;">107,621</div>
                            <div style="font-size: 0.9em; opacity: 0.9;">Total Words Spoken</div>
                        </div>
                        <div>
                            <div style="font-size: 2em; font-weight: bold;">7</div>
                            <div style="font-size: 0.9em; opacity: 0.9;">Weeks Analyzed</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="startScreen" class="start-screen">
            <h2>Ready to Test Your Knowledge?</h2>
            <p>This quiz covers key concepts from Weeks 1-5 of EC201 International Macroeconomics.</p>

            <div class="name-input-section">
                <label for="userName" style="display: block; margin-bottom: 10px; font-weight: 600; color: #2d3748;">Enter Your Name:</label>
                <input type="text" id="userName" class="name-input" placeholder="Your name..." required>
            </div>

            <div class="week-description">
                <h3>Topics Covered:</h3>
                <ul>
                    <li><strong>Week 1:</strong> Balance of Payments, NIIP, Global imbalances</li>
                    <li><strong>Week 2:</strong> Trade balance sustainability, Transversality conditions</li>
                    <li><strong>Week 3:</strong> Small open economy model, Consumption smoothing</li>
                    <li><strong>Week 4:</strong> Terms of Trade shocks, World interest rates, Tariffs</li>
                    <li><strong>Week 5:</strong> Production economy, Investment/Saving schedules, Metzler diagram</li>
                </ul>
            </div>

            <button class="btn btn-primary" onclick="startQuiz()" style="font-size: 18px; padding: 18px 36px;">Start Quiz</button>
            <button class="btn view-leaderboard-btn" onclick="showLeaderboardOnly()">View Leaderboard</button>

            <div id="leaderboardDisplay" class="leaderboard-section" style="display: none;">
                <h3>ðŸ† Leaderboard</h3>
                <div id="leaderboardContent"></div>
            </div>
        </div>

        <div id="quizArea" class="quiz-area" style="display: none;">
            <div class="user-greeting" id="userGreeting"></div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div id="questionContainer"></div>

            <div class="button-group">
                <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()">Previous</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" disabled>Next Question</button>
            </div>
        </div>

        <div id="results" class="results">
            <div class="score-circle" id="scoreCircle">0%</div>
            <h2 id="resultsTitle">Quiz Complete!</h2>
            <div class="results-details">
                <div class="result-stat">
                    <div class="result-stat-value" id="correctCount">0</div>
                    <div class="result-stat-label">Correct</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-value" id="incorrectCount">0</div>
                    <div class="result-stat-label">Incorrect</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-value" id="totalCount">0</div>
                    <div class="result-stat-label">Total Questions</div>
                </div>
            </div>

            <div id="aiReviewSection" class="ai-review-section">
                <h3>ðŸ“Š AI Performance Analysis</h3>
                <div id="aiReview" class="ai-review-content">
                    <div class="ai-loading">Analyzing your performance...</div>
                </div>
            </div>

            <div class="leaderboard-section">
                <h3>ðŸ† Leaderboard</h3>
                <div id="finalLeaderboard"></div>
            </div>

            <button class="btn btn-primary" onclick="restartQuiz()" style="margin-top: 30px;">Restart Quiz</button>
        </div>

        <!-- Poll Section -->
        <div class="poll-section">
            <div class="poll-title">ðŸ“Š Student Poll</div>
            <div class="poll-subtitle">Which topic do you think will be most challenging on the test?</div>
            <div class="poll-options" id="pollOptions">
                <div class="poll-option" onclick="selectPollOption('week1', event)">
                    <div class="poll-option-bar" id="bar-week1" style="width: 0%"></div>
                    <div class="poll-option-content">
                        <div class="poll-option-header">
                            <span class="poll-option-text">Week 1: Global Imbalances</span>
                            <span class="poll-option-percentage" id="percent-week1">0%</span>
                        </div>
                        <span class="poll-option-votes" id="votes-week1">0 votes</span>
                    </div>
                </div>
                <div class="poll-option" onclick="selectPollOption('week2', event)">
                    <div class="poll-option-bar" id="bar-week2" style="width: 0%"></div>
                    <div class="poll-option-content">
                        <div class="poll-option-header">
                            <span class="poll-option-text">Week 2: Sustainability</span>
                            <span class="poll-option-percentage" id="percent-week2">0%</span>
                        </div>
                        <span class="poll-option-votes" id="votes-week2">0 votes</span>
                    </div>
                </div>
                <div class="poll-option" onclick="selectPollOption('week3', event)">
                    <div class="poll-option-bar" id="bar-week3" style="width: 0%"></div>
                    <div class="poll-option-content">
                        <div class="poll-option-header">
                            <span class="poll-option-text">Week 3: Current Account</span>
                            <span class="poll-option-percentage" id="percent-week3">0%</span>
                        </div>
                        <span class="poll-option-votes" id="votes-week3">0 votes</span>
                    </div>
                </div>
                <div class="poll-option" onclick="selectPollOption('week4', event)">
                    <div class="poll-option-bar" id="bar-week4" style="width: 0%"></div>
                    <div class="poll-option-content">
                        <div class="poll-option-header">
                            <span class="poll-option-text">Week 4: ToT & Tariffs</span>
                            <span class="poll-option-percentage" id="percent-week4">0%</span>
                        </div>
                        <span class="poll-option-votes" id="votes-week4">0 votes</span>
                    </div>
                </div>
                <div class="poll-option" onclick="selectPollOption('week5', event)">
                    <div class="poll-option-bar" id="bar-week5" style="width: 0%"></div>
                    <div class="poll-option-content">
                        <div class="poll-option-header">
                            <span class="poll-option-text">Week 5: Production Economy</span>
                            <span class="poll-option-percentage" id="percent-week5">0%</span>
                        </div>
                        <span class="poll-option-votes" id="votes-week5">0 votes</span>
                    </div>
                </div>
                <div class="poll-option" onclick="selectPollOption('week6', event)">
                    <div class="poll-option-bar" id="bar-week6" style="width: 0%"></div>
                    <div class="poll-option-content">
                        <div class="poll-option-header">
                            <span class="poll-option-text">Week 6: Topic 6</span>
                            <span class="poll-option-percentage" id="percent-week6">0%</span>
                        </div>
                        <span class="poll-option-votes" id="votes-week6">0 votes</span>
                    </div>
                </div>
                <div class="poll-option" onclick="selectPollOption('week7', event)">
                    <div class="poll-option-bar" id="bar-week7" style="width: 0%"></div>
                    <div class="poll-option-content">
                        <div class="poll-option-header">
                            <span class="poll-option-text">Week 7: Topic 7</span>
                            <span class="poll-option-percentage" id="percent-week7">0%</span>
                        </div>
                        <span class="poll-option-votes" id="votes-week7">0 votes</span>
                    </div>
                </div>
                <div class="poll-option" onclick="selectPollOption('week8', event)">
                    <div class="poll-option-bar" id="bar-week8" style="width: 0%"></div>
                    <div class="poll-option-content">
                        <div class="poll-option-header">
                            <span class="poll-option-text">Week 8: Topic 8</span>
                            <span class="poll-option-percentage" id="percent-week8">0%</span>
                        </div>
                        <span class="poll-option-votes" id="votes-week8">0 votes</span>
                    </div>
                </div>
            </div>
            <button class="poll-submit-btn" id="pollSubmitBtn" onclick="submitPollVote()" disabled>Vote</button>
            <div class="poll-total-votes" id="pollTotalVotes">Loading votes...</div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAeRv3FnOy8-pNoqZWRmh-Wbj41rpQExlo",
            authDomain: "ec201-c1bb6.firebaseapp.com",
            databaseURL: "https://ec201-c1bb6-default-rtdb.firebaseio.com",
            projectId: "ec201-c1bb6",
            storageBucket: "ec201-c1bb6.firebasestorage.app",
            messagingSenderId: "579096241028",
            appId: "1:579096241028:web:972f85a4161e1309c9f3d1",
            measurementId: "G-94G3LFX721"
        };

        // Initialize Firebase
        let database;
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            console.log('Firebase initialized successfully');
        } catch (error) {
            console.error('Firebase initialization error:', error);
            database = null;
        }

        const questions = [
            // EASY QUESTIONS - Original simpler versions
            // Week 1: Global Imbalances - Easy (10 questions)
            {
                week: 1,
                difficulty: "easy",
                topic: "Balance of Payments Components",
                question: "The Balance of Payments consists of which main components?",
                options: [
                    "Current Account + Financial Account + Capital Account",
                    "Trade Balance + Income Balance only",
                    "Exports + Imports + Transfers",
                    "GDP + Net Exports + Government Spending"
                ],
                correct: 0,
                explanation: "The Balance of Payments = Current Account + Financial Account + Capital Account."
            },
            {
                week: 1,
                difficulty: "easy",
                topic: "Balance of Payments Components",
                question: "What does the Trade Balance measure?",
                options: [
                    "Total government spending on trade",
                    "Exports minus Imports of goods and services",
                    "Foreign investment flows",
                    "Net unilateral transfers"
                ],
                correct: 1,
                explanation: "Trade Balance = Exports - Imports (goods & services)."
            },
            {
                week: 1,
                difficulty: "easy",
                topic: "NIIP and Valuation",
                question: "Net International Investment Position (NIIP) is calculated as:",
                options: [
                    "Current Account - Trade Balance",
                    "Exports - Imports",
                    "Foreign Assets - Foreign Liabilities",
                    "GDP - National Debt"
                ],
                correct: 2,
                explanation: "NIIP = Foreign Assets - Foreign Liabilities. It represents accumulated wealth position."
            },
            {
                week: 1,
                difficulty: "easy",
                topic: "NIIP and Valuation",
                question: "What is the relationship between Current Account deficits and NIIP?",
                options: [
                    "Current Account Deficit causes NIIP to rise",
                    "Current Account Deficit causes NIIP to fall",
                    "They are unrelated",
                    "Current Account Deficit doubles the NIIP"
                ],
                correct: 1,
                explanation: "A Current Account Deficit leads to a fall in NIIP, while a Current Account Surplus causes NIIP to rise."
            },
            {
                week: 1,
                difficulty: "easy",
                topic: "Global Creditors and Debtors",
                question: "Which of the following is a major external creditor?",
                options: [
                    "United States",
                    "United Kingdom",
                    "Japan",
                    "Australia"
                ],
                correct: 2,
                explanation: "Japan, China, and Germany are major external creditors. The US is the world's largest debtor."
            },
            {
                week: 1,
                difficulty: "easy",
                topic: "NIIP and Valuation",
                question: "Why might NIIP not equal accumulated current accounts?",
                options: [
                    "Because of calculation errors",
                    "Because of valuation changes from market price movements",
                    "Because trade is measured incorrectly",
                    "They are always equal"
                ],
                correct: 1,
                explanation: "NIIP changes from two sources: (1) Current Account flows and (2) Valuation changes (stock/bond prices, exchange rates)."
            },
            {
                week: 1,
                difficulty: "easy",
                topic: "NIIP and Valuation",
                question: "During 2002-2007, the US ran $3.9 trillion in current account deficits but NIIP improved by $80 billion. What explains this?",
                options: [
                    "Measurement error",
                    "$4 trillion in positive valuation changes",
                    "Increased exports",
                    "Reduced imports"
                ],
                correct: 1,
                explanation: "The US benefited from $4 trillion in positive valuation changes, offsetting the current account deficits."
            },
            {
                week: 1,
                difficulty: "easy",
                topic: "Dark Matter and Return Differential",
                question: "The 'Dark Matter' hypothesis suggests:",
                options: [
                    "The US has hidden debt obligations",
                    "Unmeasured intangible assets mean true NIIP might be positive",
                    "Foreign countries hide their investments",
                    "Trade statistics are completely wrong"
                ],
                correct: 1,
                explanation: "The Dark Matter hypothesis suggests unmeasured intangible assets (brands, know-how) mean the true NIIP might actually be positive."
            },
            {
                week: 1,
                difficulty: "easy",
                topic: "Dark Matter and Return Differential",
                question: "The 'Return Differential' hypothesis explains the NIIP-NII paradox by:",
                options: [
                    "The US borrows at high rates and lends at low rates",
                    "The US invests in high-return assets (stocks/FDI) while foreigners invest in low-return US assets (Treasury bonds)",
                    "All countries earn the same return",
                    "Returns don't matter for investment income"
                ],
                correct: 1,
                explanation: "The Return Differential hypothesis: US invests in high-return foreign assets while foreigners invest in low-return US assets, related to 'exorbitant privilege'."
            },
            {
                week: 1,
                difficulty: "easy",
                topic: "Balance of Payments Components",
                question: "Which is included in the Income Balance component of the Current Account?",
                options: [
                    "Exports and imports of goods",
                    "Net Investment Income and Net Compensation to Employees",
                    "Government transfers only",
                    "Capital gains on stocks"
                ],
                correct: 1,
                explanation: "Income Balance = Net Investment Income + Net Compensation to Employees."
            },

            // Week 2: Sustainability - Easy (10 questions)
            {
                week: 2,
                difficulty: "easy",
                topic: "Finite vs Infinite Horizon",
                question: "In a two-period economy with terminal condition Bâ‚‚ = 0, can a net debtor run perpetual trade balance deficits?",
                options: [
                    "Yes, always",
                    "No, must run surplus in at least one period",
                    "Yes, but only if interest rates are negative",
                    "It depends on GDP growth"
                ],
                correct: 1,
                explanation: "In finite horizon, a net debtor cannot run perpetual TB deficits - must run a surplus in at least one period to satisfy the sustainability condition."
            },
            {
                week: 2,
                difficulty: "easy",
                topic: "Transversality Condition",
                question: "What is the transversality condition in the infinite horizon model?",
                options: [
                    "Debt must equal zero",
                    "The present value of debt must vanish: lim(Tâ†’âˆž) Bâ‚œ/(1+r)áµ€ = 0",
                    "Debt must grow faster than interest rate",
                    "Current account must always be positive"
                ],
                correct: 1,
                explanation: "The transversality (No-Ponzi-Game) condition: lim(Tâ†’âˆž) Bâ‚œ/(1+r)áµ€ = 0. Present value of debt must vanish (not that debt goes to zero)."
            },
            {
                week: 2,
                difficulty: "easy",
                topic: "Perpetual Deficits",
                question: "In infinite horizon, can a net debtor run perpetual current account deficits?",
                options: [
                    "No, never",
                    "Yes, if paying fraction Î± âˆˆ (0,1) of interest via trade surplus",
                    "Only if GDP shrinks",
                    "Only for one period"
                ],
                correct: 1,
                explanation: "Yes! A net debtor CAN run perpetual CA deficits in infinite horizon if following a debt-servicing policy: TBâ‚œ = -Î±rBâ‚œâ‚‹â‚ where Î± âˆˆ (0,1)."
            },
            {
                week: 2,
                difficulty: "easy",
                topic: "Debt Growth and Sustainability",
                question: "For perpetual CA deficits to be sustainable, debt must grow at rate g where:",
                options: [
                    "g > r (faster than interest rate)",
                    "g = r (equal to interest rate)",
                    "g < r, specifically g = r(1-Î±) where Î± > 0",
                    "g can be anything"
                ],
                correct: 2,
                explanation: "Debt must grow slower than interest rate: g = r(1-Î±) < r. This ensures the transversality condition is satisfied."
            },
            {
                week: 2,
                difficulty: "easy",
                topic: "Finite vs Infinite Horizon",
                question: "What is the key difference between finite and infinite horizon sustainability?",
                options: [
                    "No difference",
                    "Finite: hard constraint (Bâ‚œ=0), Infinite: soft constraint (PVâ†’0)",
                    "Finite is easier",
                    "Infinite requires balanced budgets"
                ],
                correct: 1,
                explanation: "Finite horizon has hard constraint (must settle all debts), infinite has soft constraint (can 'grow out of debt' as long as PVâ†’0)."
            },
            {
                week: 2,
                difficulty: "easy",
                topic: "Accounting Identities",
                question: "The accounting identity Bâ‚œ = (1+r)Bâ‚œâ‚‹â‚ + TBâ‚œ shows:",
                options: [
                    "How current NIIP relates to previous NIIP plus current trade balance",
                    "How GDP grows over time",
                    "The inflation rate",
                    "Government budget constraint"
                ],
                correct: 0,
                explanation: "This identity shows NIIP evolves as: current NIIP = previous NIIP with interest plus current trade balance."
            },
            {
                week: 2,
                difficulty: "easy",
                topic: "Accounting Identities",
                question: "The relationship between Current Account and Trade Balance is:",
                options: [
                    "CA = TB (they are identical)",
                    "CA = TB + rBâ‚œâ‚‹â‚ (trade balance plus net investment income)",
                    "CA = TB Ã— 2",
                    "They are unrelated"
                ],
                correct: 1,
                explanation: "Current Account = Trade Balance + rBâ‚œâ‚‹â‚ (where rBâ‚œâ‚‹â‚ represents net investment income)."
            },
            {
                week: 2,
                difficulty: "easy",
                topic: "Perpetual Deficits",
                question: "In infinite horizon, a net debtor CANNOT run perpetual:",
                options: [
                    "Current account deficits",
                    "Trade balance deficits",
                    "Both CA and TB deficits",
                    "Either CA or TB deficits"
                ],
                correct: 1,
                explanation: "Even in infinite horizon, a net debtor CANNOT run perpetual TB deficits (must repay real resources at some point), but CAN run perpetual CA deficits."
            },
            {
                week: 2,
                difficulty: "easy",
                topic: "Debt Growth and Sustainability",
                question: "For sustainability with perpetual CA deficits, GDP growth must be:",
                options: [
                    "Negative",
                    "Zero",
                    "â‰¥ r(1-Î±) to generate required TB surpluses",
                    "< interest rate"
                ],
                correct: 2,
                explanation: "Critical condition: GDP must grow â‰¥ r(1-Î±) to generate the required TB surpluses for sustainability."
            },
            {
                week: 2,
                difficulty: "easy",
                topic: "Finite vs Infinite Horizon",
                question: "In a two-period model, the sustainability condition with Bâ‚€ < 0 (net debtor) is:",
                options: [
                    "(1+r)Bâ‚€ = -TBâ‚ - TBâ‚‚/(1+r)",
                    "Bâ‚€ = TBâ‚ + TBâ‚‚",
                    "(1+r)Bâ‚€ = TBâ‚ + TBâ‚‚",
                    "Bâ‚€ = 0"
                ],
                correct: 0,
                explanation: "The sustainability condition is (1+r)Bâ‚€ = -TBâ‚ - TBâ‚‚/(1+r), which shows present value of trade balances must offset initial debt."
            },

            // Week 3: Theory of Current Account - Easy (10 questions)
            {
                week: 3,
                difficulty: "easy",
                topic: "Small Open Economy Model",
                question: "In the small open economy model, what does 'small' mean?",
                options: [
                    "The country has a small population",
                    "World prices and interest rates are independent of domestic conditions",
                    "The economy produces few goods",
                    "GDP is low"
                ],
                correct: 1,
                explanation: "Small means world prices and interest rates are independent of domestic conditions - the country is a price taker."
            },
            {
                week: 3,
                difficulty: "easy",
                topic: "Small Open Economy Model",
                question: "Free capital mobility in the model implies:",
                options: [
                    "No restrictions on trade",
                    "râ‚ = r* (domestic interest rate equals world rate)",
                    "No taxes",
                    "Fixed exchange rate"
                ],
                correct: 1,
                explanation: "Free capital mobility implies interest rate parity: râ‚ = r*."
            },
            {
                week: 3,
                difficulty: "easy",
                topic: "Euler Equation and Optimization",
                question: "The Euler equation in the model represents:",
                options: [
                    "Budget constraint",
                    "Optimal consumption choice: U'(Câ‚) = (1+râ‚)Î²U'(Câ‚‚)",
                    "Production function",
                    "Trade balance identity"
                ],
                correct: 1,
                explanation: "The Euler equation U'(Câ‚) = (1+râ‚)Î²U'(Câ‚‚) characterizes optimal intertemporal consumption choice."
            },
            {
                week: 3,
                difficulty: "easy",
                topic: "Temporary vs Permanent Shocks",
                question: "How does a TEMPORARY decline in Qâ‚ affect the current account?",
                options: [
                    "Large CA deterioration (households borrow to smooth consumption)",
                    "No effect",
                    "Large CA improvement",
                    "Small CA deterioration"
                ],
                correct: 0,
                explanation: "Temporary shocks lead to large CA movements - households borrow to smooth consumption, causing CA to deteriorate significantly."
            },
            {
                week: 3,
                difficulty: "easy",
                topic: "Temporary vs Permanent Shocks",
                question: "How does a PERMANENT decline in output (Qâ‚ and Qâ‚‚) affect consumption?",
                options: [
                    "No change in consumption",
                    "Câ‚ falls by less than the output decline",
                    "Both Câ‚ and Câ‚‚ adjust proportionally, little change in trade balance",
                    "Only Câ‚‚ changes"
                ],
                correct: 2,
                explanation: "With permanent shocks, economies adjust consumption in both periods. The trade balance changes little because households cannot smooth a permanent shock."
            },
            {
                week: 3,
                difficulty: "easy",
                topic: "Temporary vs Permanent Shocks",
                question: "The general principle comparing temporary vs permanent shocks is:",
                options: [
                    "Both have identical effects",
                    "Economies finance temporary shocks (borrow/lend) and adjust to permanent ones",
                    "Economies ignore temporary shocks",
                    "Only permanent shocks matter"
                ],
                correct: 1,
                explanation: "Economies tend to FINANCE temporary shocks through international borrowing/lending and ADJUST to permanent shocks by changing consumption."
            },
            {
                week: 3,
                difficulty: "easy",
                topic: "Anticipated Income Shocks",
                question: "If households learn in period 1 that Qâ‚‚ will be higher (anticipated income shock), what happens to CAâ‚?",
                options: [
                    "CAâ‚ improves",
                    "CAâ‚ deteriorates (households borrow against future income)",
                    "No change in CAâ‚",
                    "CAâ‚ becomes zero"
                ],
                correct: 1,
                explanation: "Good news about future income causes CA to deteriorate - households increase Câ‚ by borrowing, even though Qâ‚ is unchanged."
            },
            {
                week: 3,
                difficulty: "easy",
                topic: "Budget Constraint",
                question: "The intertemporal budget constraint in the two-period model is:",
                options: [
                    "Câ‚ + Câ‚‚ = Qâ‚ + Qâ‚‚",
                    "Câ‚ + Câ‚‚/(1+râ‚) = (1+râ‚€)Bâ‚€ + Qâ‚ + Qâ‚‚/(1+râ‚)",
                    "Câ‚ = Qâ‚ and Câ‚‚ = Qâ‚‚",
                    "Câ‚ + Câ‚‚ = 2Qâ‚"
                ],
                correct: 1,
                explanation: "The intertemporal budget constraint: Câ‚ + Câ‚‚/(1+râ‚) = (1+râ‚€)Bâ‚€ + Qâ‚ + Qâ‚‚/(1+râ‚) - present value of consumption equals present value of resources."
            },
            {
                week: 3,
                difficulty: "easy",
                topic: "Budget Constraint",
                question: "Trade balance in period 1 is defined as:",
                options: [
                    "TBâ‚ = Câ‚ - Qâ‚",
                    "TBâ‚ = Qâ‚ - Câ‚",
                    "TBâ‚ = Qâ‚ + Câ‚",
                    "TBâ‚ = (Qâ‚ - Câ‚) Ã— r"
                ],
                correct: 1,
                explanation: "Trade Balance: TBâ‚ = Qâ‚ - Câ‚ (output minus consumption)."
            },
            {
                week: 3,
                difficulty: "easy",
                topic: "Consumption Smoothing",
                question: "What does consumption smoothing mean?",
                options: [
                    "Consuming the same goods every period",
                    "Households prefer stable consumption over time using international borrowing/lending",
                    "Consumption always equals income",
                    "Avoiding imported goods"
                ],
                correct: 1,
                explanation: "Consumption smoothing: households prefer stable consumption over time (due to concave utility) and use international borrowing/lending to achieve this."
            },

            // Week 4: Terms of Trade - Easy (10 questions)
            {
                week: 4,
                difficulty: "easy",
                topic: "Terms of Trade",
                question: "The terms of trade (TT) is defined as:",
                options: [
                    "TT = Imports / Exports",
                    "TT = Price of Exports / Price of Imports",
                    "TT = Trade Balance / GDP",
                    "TT = Current Account / Financial Account"
                ],
                correct: 1,
                explanation: "Terms of trade (TT) = P^X / P^M, the relative price of exports in terms of imports."
            },
            {
                week: 4,
                difficulty: "easy",
                topic: "Terms of Trade",
                question: "A temporary improvement in terms of trade (TTâ‚ â†‘) affects the current account by:",
                options: [
                    "CAâ‚ improves as country saves windfall",
                    "CAâ‚ deteriorates",
                    "No effect on CA",
                    "CAâ‚ becomes zero"
                ],
                correct: 0,
                explanation: "Temporary TT improvement: country saves windfall to smooth consumption â†’ CAâ‚ improves."
            },
            {
                week: 4,
                difficulty: "easy",
                topic: "Terms of Trade",
                question: "A permanent improvement in terms of trade (TTâ‚ and TTâ‚‚ both â†‘) has what effect on CA?",
                options: [
                    "Large CA improvement",
                    "Little change in CA (consumption rises in both periods)",
                    "Large CA deterioration",
                    "CAâ‚ doubles"
                ],
                correct: 1,
                explanation: "Permanent TT improvement: consumption increases in both periods proportionally â†’ little CA change. Same principle as endowment shocks."
            },
            {
                week: 4,
                difficulty: "easy",
                topic: "World Interest Rate Shocks",
                question: "An increase in world interest rate r* has two effects. What are they?",
                options: [
                    "Inflation effect and deflation effect",
                    "Substitution effect and income effect",
                    "Supply effect and demand effect",
                    "Export effect and import effect"
                ],
                correct: 1,
                explanation: "r* â†‘ creates: (1) Substitution effect: bonds more attractive â†’ save more. (2) Income effect: depends on borrower/lender position."
            },
            {
                week: 4,
                difficulty: "easy",
                topic: "World Interest Rate Shocks",
                question: "For a net borrower (Bâ‚€ < 0), an increase in r* causes:",
                options: [
                    "Income and substitution effects reinforce â†’ CAâ‚ improves",
                    "Income and substitution effects oppose",
                    "No effect on CA",
                    "Only substitution effect matters"
                ],
                correct: 0,
                explanation: "Net borrower: both effects reduce Câ‚ (substitution: save more; income: poorer) â†’ CAâ‚ improves."
            },
            {
                week: 4,
                difficulty: "easy",
                topic: "World Interest Rate Shocks",
                question: "For a net lender (Bâ‚€ > 0), which effect typically dominates when r* increases?",
                options: [
                    "Income effect (richer â†’ consume more)",
                    "Substitution effect (save more â†’ standard assumption)",
                    "Both cancel exactly",
                    "Neither effect applies"
                ],
                correct: 1,
                explanation: "For lenders: effects oppose, but substitution effect typically dominates under standard preferencesâ€”savings increase with interest rate."
            },
            {
                week: 4,
                difficulty: "easy",
                topic: "Import Tariffs",
                question: "The modified Euler equation with tariffs is:",
                options: [
                    "U'(Câ‚) = Î²(1+r)U'(Câ‚‚)",
                    "U'(Câ‚) = [(1+Ï„â‚)/(1+Ï„â‚‚)]Î²(1+r)U'(Câ‚‚)",
                    "U'(Câ‚) = Ï„â‚U'(Câ‚‚)",
                    "U'(Câ‚) = U'(Câ‚‚)"
                ],
                correct: 1,
                explanation: "With tariffs, the Euler equation becomes: U'(Câ‚) = [(1+Ï„â‚)/(1+Ï„â‚‚)]Î²(1+r)U'(Câ‚‚), where Ï„ represents import tariffs."
            },
            {
                week: 4,
                difficulty: "easy",
                topic: "Import Tariffs",
                question: "A temporary tariff (Ï„â‚ > 0, Ï„â‚‚ = 0) affects consumption by:",
                options: [
                    "Making current consumption relatively expensive â†’ Câ‚ â†“, CAâ‚ â†‘",
                    "Making current consumption cheaper â†’ Câ‚ â†‘",
                    "No effect on consumption",
                    "Doubling current consumption"
                ],
                correct: 0,
                explanation: "Temporary tariff: (1+Ï„â‚)/(1+Ï„â‚‚) > 1 makes current consumption expensive â†’ households postpone consumption â†’ CAâ‚ improves."
            },
            {
                week: 4,
                difficulty: "easy",
                topic: "Import Tariffs",
                question: "A permanent tariff (Ï„â‚ = Ï„â‚‚ > 0) has what effect on the current account?",
                options: [
                    "Large CA improvement",
                    "No effect on CA (ratio (1+Ï„â‚)/(1+Ï„â‚‚) = 1)",
                    "Large CA deterioration",
                    "CA doubles"
                ],
                correct: 1,
                explanation: "Permanent tariff: (1+Ï„â‚)/(1+Ï„â‚‚) = 1 in Euler equation â†’ no intertemporal distortion â†’ no CA effect."
            },
            {
                week: 4,
                difficulty: "easy",
                topic: "Import Tariffs",
                question: "Why do permanent tariffs not affect the CA in this model?",
                options: [
                    "Tariffs don't affect trade",
                    "Tariff revenues are rebated lump-sum, and no intertemporal substitution is created",
                    "The model ignores tariffs",
                    "CA is always zero"
                ],
                correct: 1,
                explanation: "Tariff revenues are rebated (L_t = Ï„_t C_t), so economy-wide resources unchanged. Permanent tariffs don't create intertemporal distortion â†’ no CA effect."
            },

            // Week 5: Production Economy - Easy (10 questions)
            {
                week: 5,
                difficulty: "easy",
                topic: "Production Economy",
                question: "In the production economy, output is determined by:",
                options: [
                    "Q_t = A_t F(I_{t-1}), where I is investment and A is productivity",
                    "Q_t = C_t (consumption)",
                    "Q_t = exogenous endowment",
                    "Q_t = exports - imports"
                ],
                correct: 0,
                explanation: "Production economy: Q_t = A_t F(I_{t-1}). Output depends on investment I_{t-1} and productivity A_t."
            },
            {
                week: 5,
                difficulty: "easy",
                topic: "Production Economy",
                question: "The marginal product of capital (MPK) is:",
                options: [
                    "MPK = A_t F'(I_{t-1})",
                    "MPK = F(I)",
                    "MPK = I / Q",
                    "MPK = 1 + r"
                ],
                correct: 0,
                explanation: "MPK = A_t F'(I_{t-1}), the additional output from one more unit of investment."
            },
            {
                week: 5,
                difficulty: "easy",
                topic: "Production Economy",
                question: "The firm's profit maximization condition is:",
                options: [
                    "Aâ‚‚F'(Iâ‚) = 1 + râ‚ (MPK equals opportunity cost)",
                    "Iâ‚ = Sâ‚",
                    "MPK = 0",
                    "Q = C"
                ],
                correct: 0,
                explanation: "Firms invest until Aâ‚‚F'(Iâ‚) = 1 + râ‚: marginal benefit (MPK) equals marginal cost (opportunity cost of funds)."
            },
            {
                week: 5,
                difficulty: "easy",
                topic: "Investment Schedule",
                question: "The investment schedule I_1 = I(r_1^-, A_2^+) shows:",
                options: [
                    "Investment decreases with r_1 (higher cost) and increases with A_2 (higher MPK)",
                    "Investment increases with r_1",
                    "Investment is constant",
                    "Investment equals savings"
                ],
                correct: 0,
                explanation: "âˆ‚I/âˆ‚r_1 < 0 (higher interest rate â†’ higher cost â†’ less investment). âˆ‚I/âˆ‚A_2 > 0 (higher productivity â†’ higher MPK â†’ more investment)."
            },
            {
                week: 5,
                difficulty: "easy",
                topic: "Saving Schedule",
                question: "The saving schedule Sâ‚ = S(râ‚âº, Aâ‚âº, Aâ‚‚â») indicates:",
                options: [
                    "Saving increases with râ‚ and current productivity Aâ‚, decreases with future productivity Aâ‚‚",
                    "Saving is constant",
                    "Saving only depends on râ‚",
                    "Saving equals investment"
                ],
                correct: 0,
                explanation: "âˆ‚S/âˆ‚râ‚ > 0 (save more when return is higher). âˆ‚S/âˆ‚Aâ‚ > 0 (temporary income boost â†’ save). âˆ‚S/âˆ‚Aâ‚‚ < 0 (good news â†’ borrow)."
            },
            {
                week: 5,
                difficulty: "easy",
                topic: "Current Account Schedule",
                question: "The current account is defined as:",
                options: [
                    "CAâ‚ = Sâ‚ - Iâ‚ (saving minus investment)",
                    "CAâ‚ = Iâ‚ - Sâ‚",
                    "CAâ‚ = Qâ‚",
                    "CAâ‚ = Câ‚"
                ],
                correct: 0,
                explanation: "In production economy: CAâ‚ = Sâ‚ - Iâ‚. The current account equals saving minus investment."
            },
            {
                week: 5,
                difficulty: "easy",
                topic: "Current Account Schedule",
                question: "A positive productivity shock in period 2 (Aâ‚‚ â†‘) affects CAâ‚ by:",
                options: [
                    "CAâ‚ deteriorates (Iâ‚ â†‘ and Sâ‚ â†“)",
                    "CAâ‚ improves",
                    "No effect on CAâ‚",
                    "CAâ‚ doubles"
                ],
                correct: 0,
                explanation: "Aâ‚‚ â†‘: firms invest more (Iâ‚ â†‘) and households borrow against future income (Sâ‚ â†“) â†’ CAâ‚ = Sâ‚ - Iâ‚ deteriorates."
            },
            {
                week: 5,
                difficulty: "easy",
                topic: "Metzler Diagram",
                question: "In the Metzler diagram, the investment schedule I(râ‚) slopes:",
                options: [
                    "Downward (higher râ‚ â†’ less investment)",
                    "Upward (higher râ‚ â†’ more investment)",
                    "Vertical",
                    "Horizontal"
                ],
                correct: 0,
                explanation: "Investment schedule slopes downward: higher interest rates increase opportunity cost â†’ less investment."
            },
            {
                week: 5,
                difficulty: "easy",
                topic: "Metzler Diagram",
                question: "In the Metzler diagram, the saving schedule S(râ‚) slopes:",
                options: [
                    "Upward (higher râ‚ â†’ save more)",
                    "Downward",
                    "Vertical",
                    "Horizontal"
                ],
                correct: 0,
                explanation: "Saving schedule slopes upward: higher interest rates make saving more attractive (substitution effect dominates)."
            },
            {
                week: 5,
                difficulty: "easy",
                topic: "Giant Oil Discoveries",
                question: "The giant oil discoveries application shows that large future productivity shocks lead to:",
                options: [
                    "CA deterioration (heavy investment + borrowing against future oil)",
                    "CA improvement",
                    "No CA effect",
                    "Balanced trade"
                ],
                correct: 0,
                explanation: "Oil discoveries (Aâ‚‚ â†‘): countries invest in infrastructure (Iâ‚ â†‘) and borrow against future revenue (Sâ‚ â†“) â†’ CAâ‚ deteriorates."
            },

            // HARD QUESTIONS START HERE            // Week 1: Global Imbalances (15 challenging questions)
            {
                week: 1,
                difficulty: "hard",
                topic: "Balance of Payments Components",
                question: "Consider a country with TB = -50, Net Investment Income = 30, Net Compensation to Employees = -5, and Net Unilateral Transfers = 10. What is the Current Account balance?",
                options: [
                    "CA = -35 (the trade deficit partially offsets the investment income surplus)",
                    "CA = -15 (TB + NII + NCE + NUT = -50 + 30 - 5 + 10)",
                    "CA = -25 (only TB and NII are included in CA)",
                    "CA = 15 (net investment income dominates the calculation)"
                ],
                correct: 1,
                explanation: "CA = TB + Net Investment Income + Net Compensation to Employees + Net Unilateral Transfers = -50 + 30 - 5 + 10 = -15. All four components must be included."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "Balance of Payments Components",
                question: "If a country's Financial Account shows +$200 billion (capital inflows), the BoP identity implies:",
                options: [
                    "Current Account must be approximately -$200 billion (BoP â‰ˆ 0)",
                    "Current Account must be +$200 billion (they move together)",
                    "Trade Balance must equal +$200 billion exactly",
                    "Capital Account must be -$200 billion to offset the Financial Account"
                ],
                correct: 0,
                explanation: "By the BoP identity: CA + Financial Account + Capital Account â‰ˆ 0. Large capital inflows (+$200B FA) typically reflect financing of a CA deficit (approximately -$200B CA)."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "NIIP and Valuation",
                question: "A country has NIIPâ‚€ = -$500B. Over one year, it runs CA = -$100B, but NIIPâ‚ = -$550B (not -$600B). What explains the $50B discrepancy?",
                options: [
                    "Measurement error in the current account statistics",
                    "+$50B positive valuation effect (e.g., domestic currency depreciation increased value of foreign assets)",
                    "-$50B negative valuation effect (e.g., foreign liabilities appreciated more than assets)",
                    "The Financial Account must have been incorrectly recorded"
                ],
                correct: 1,
                explanation: "NIIPâ‚ = NIIPâ‚€ + CA + Valuation Changes. Expected: -500 - 100 = -600, but actual is -550. The +$50B difference comes from positive valuation effects (e.g., FX movements, asset price changes)."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "NIIP and Valuation",
                question: "During a period of domestic currency depreciation, which valuation effect is most likely for a country whose foreign assets are denominated in foreign currency and foreign liabilities in domestic currency?",
                options: [
                    "Negative valuation effect: both assets and liabilities increase proportionally",
                    "Positive valuation effect: foreign assets rise in domestic currency value while liabilities remain stable",
                    "Neutral effect: currency movements don't affect NIIP",
                    "Ambiguous effect: depends entirely on the magnitude of the trade balance"
                ],
                correct: 1,
                explanation: "Currency depreciation causes foreign-currency-denominated assets to rise in domestic currency value, while domestic-currency liabilities remain constantâ€”creating positive valuation effects that improve NIIP."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "Global Creditors and Debtors",
                question: "How can the US maintain a large negative NIIP (-$18 trillion, 2023) but still receive positive Net Investment Income?",
                options: [
                    "This is impossibleâ€”negative NIIP must imply negative NII",
                    "Return Differential: US foreign assets (equity, FDI) earn higher returns than US liabilities (bonds)",
                    "Dark Matter: unmeasured intangible assets generate hidden income streams",
                    "Both B and C contribute to explaining the NIIP-NII paradox"
                ],
                correct: 3,
                explanation: "Both hypotheses explain the paradox: (1) Return Differentialâ€”US invests abroad in high-return equity/FDI while foreigners hold low-return US Treasuries; (2) Dark Matterâ€”unmeasured intangibles (brands, know-how) generate income."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "NIIP and Valuation",
                question: "Between 2002-2007, the US ran cumulative CA deficits of $3.9 trillion, yet NIIP improved by $80 billion. If valuation effects were +$4 trillion, what is the approximate breakdown?",
                options: [
                    "NIIP change = CA + Valuation: +$80B = -$3.9T + $4T",
                    "NIIP change = CA only: the $4T valuation is separate",
                    "NIIP change = Valuation only: CA deficits don't affect NIIP",
                    "The numbers are inconsistent and indicate measurement error"
                ],
                correct: 0,
                explanation: "Î”NIIP = CA + Valuation. Here: +$80B = -$3,900B + $4,000B. The massive positive valuation effects (+$4T) more than offset the CA deficits (-$3.9T), improving NIIP."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "Dark Matter and Return Differential",
                question: "The Return Differential hypothesis suggests the US benefits from 'exorbitant privilege.' Which statement best characterizes this privilege?",
                options: [
                    "The US can print unlimited currency without inflationary consequences",
                    "The US borrows cheaply (safe Treasury bonds at low rates) and invests abroad in high-return risky assets (equity, FDI)",
                    "The US pays no interest on its foreign liabilities",
                    "Foreign countries are legally required to hold US assets regardless of returns"
                ],
                correct: 1,
                explanation: "Exorbitant privilege: US borrows globally at low rates (safe haven statusâ€”foreigners hold Treasuries) while investing abroad in high-return assets (stocks, FDI), earning positive return differential despite negative NIIP."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "Dark Matter and Return Differential",
                question: "Hausmann and Sturzenegger's 'Dark Matter' hypothesis posits that US NIIP is mismeasured. Which of these is the strongest criticism of this hypothesis?",
                options: [
                    "Intangible assets (brands, know-how) are impossible to value precisely",
                    "Return differentials can explain the NIIP-NII paradox without assuming hidden assets",
                    "Dark matter violates international accounting standards",
                    "The hypothesis has been definitively proven false by empirical data"
                ],
                correct: 1,
                explanation: "The main criticism is that return differentials (observable differences in asset returns) can explain the paradox without invoking unmeasured intangibles. Dark matter is hard to verify empirically; return differentials are measurable."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "Balance of Payments Components",
                question: "A country has Net Investment Income = +50 but NIIP = -1000 (net debtor). Which scenario best explains this?",
                options: [
                    "Impossible: net debtors must have negative investment income",
                    "Rate of return earned on foreign assets exceeds rate paid on foreign liabilities despite negative NIIP",
                    "Current account surplus is so large it dominates the calculation",
                    "The country has defaulted on its foreign debt obligations"
                ],
                correct: 1,
                explanation: "NII = (return on assets Ã— assets) - (return on liabilities Ã— liabilities). Even with negative NIIP, if return on assets >> return on liabilities, NII can be positive (the NIIP-NII paradox)."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "NIIP and Valuation",
                question: "Suppose Country A's foreign assets are primarily equity holdings, and foreign liabilities are primarily bonds. A global stock market boom would most likely:",
                options: [
                    "Deteriorate NIIP as both assets and liabilities rise equally",
                    "Improve NIIP as foreign equity assets appreciate while bond liabilities remain stable",
                    "Have no effect on NIIP since market values don't matter for BoP accounting",
                    "Improve NIIP only if the country simultaneously runs a current account surplus"
                ],
                correct: 1,
                explanation: "Stock market boom increases value of equity assets while bond liabilities remain stable (bonds are fixed-income), creating positive valuation effects that improve NIIP. This is independent of current CA position."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "Global Creditors and Debtors",
                question: "Japan, China, and Germany are major net creditors with NIIP > 0. Which of the following is the most accurate implication?",
                options: [
                    "These countries must always run current account surpluses",
                    "These countries likely earn positive Net Investment Income, reinforcing CA surpluses",
                    "These countries have no foreign liabilities",
                    "These countries cannot experience valuation losses on their foreign assets"
                ],
                correct: 1,
                explanation: "Positive NIIP (net creditors) typically generates positive NII (investment income on net foreign assets), which reinforces CA surpluses. However, they can run CA deficits in some periods, and valuation losses are possible."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "Balance of Payments Components",
                question: "The Income Balance includes Net Investment Income (NII) and Net Compensation to Employees (NCE). If NII = +100 and NCE = -20, what does this indicate?",
                options: [
                    "The country's workers abroad send home more than foreign workers in the country",
                    "The country earns net +80 from both capital income and labor income combined",
                    "The country's foreign investment returns (+100) exceed compensation paid to foreign workers domestically (-20), netting +80",
                    "The trade balance must be positive to offset the negative NCE"
                ],
                correct: 2,
                explanation: "Income Balance = NII + NCE = 100 - 20 = +80. NII > 0 means returns on foreign assets exceed payments on liabilities; NCE < 0 means compensation paid to foreign workers domestically exceeds compensation to domestic workers abroad."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "NIIP and Valuation",
                question: "Which of the following events would cause valuation changes to NIIP without affecting the current account?",
                options: [
                    "An increase in exports due to higher global demand",
                    "A domestic stock market crash that reduces the value of foreigners' equity holdings in the country",
                    "A reduction in government spending on imports",
                    "An increase in Net Investment Income due to higher interest rates abroad"
                ],
                correct: 1,
                explanation: "Stock market crash affecting foreign-held domestic equity creates valuation changes (reduces foreign liabilities â†’ improves NIIP) without affecting CA. Options A, C, D all affect CA directly through trade or income flows."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "Dark Matter and Return Differential",
                question: "A refined version of the Dark Matter hypothesis would suggest that if US intangible assets (brands, technology, know-how) were properly measured and capitalized, the US NIIP would be:",
                options: [
                    "Even more negative (larger debtor position)",
                    "Less negative or possibly positive (hidden assets reduce net liability position)",
                    "Unchanged (intangibles don't appear in NIIP calculations)",
                    "Exactly zero (intangibles perfectly offset measured liabilities)"
                ],
                correct: 1,
                explanation: "Dark Matter posits unmeasured intangible assets (brands like Coca-Cola, tech like Microsoft, managerial know-how) that generate income. Capitalizing these would add to US foreign assets, improving (making less negative or positive) NIIP."
            },
            {
                week: 1,
                difficulty: "hard",
                topic: "Global Creditors and Debtors",
                question: "Consider two countries: Country X (NIIP = +500, NII = +30) and Country Y (NIIP = -500, NII = -10). The return differential (rate of return gap) is larger for:",
                options: [
                    "Country X: earning 6% average return on net assets",
                    "Country Y: paying only 2% average on net liabilities (expected would be higher)",
                    "Both countries exhibit similar return profiles",
                    "Cannot determine without knowing the composition of assets and liabilities"
                ],
                correct: 1,
                explanation: "Country X: 30/500 = 6% (normal return). Country Y: 10/500 = 2% payment rate on net liabilitiesâ€”surprisingly low for a debtor. This suggests Y has a favorable return differential (paying less than expected), similar to US 'exorbitant privilege'."
            },

            // Week 2: Sustainability (15 challenging questions)
            {
                week: 2,
                difficulty: "hard",
                topic: "Finite vs Infinite Horizon",
                question: "In a two-period model with Bâ‚€ = -200, r = 0.05, if TBâ‚ = -10, what TBâ‚‚ is required to satisfy the terminal condition Bâ‚‚ = 0?",
                options: [
                    "TBâ‚‚ = 210 (simply repay the initial debt)",
                    "TBâ‚‚ = 220.5 (must cover accumulated debt: (1+r)(Bâ‚€(1+r) + TBâ‚) = (1.05)(-210 - 10) = -220.5)",
                    "TBâ‚‚ = 200 (only repay principal)",
                    "TBâ‚‚ = 231 (account for compounding on both periods)"
                ],
                correct: 1,
                explanation: "Bâ‚ = (1+r)Bâ‚€ + TBâ‚ = 1.05(-200) + (-10) = -220. Then Bâ‚‚ = (1+r)Bâ‚ + TBâ‚‚ = 0 implies TBâ‚‚ = -1.05(-220) = 231. But using the PV formula: (1+r)Bâ‚€ = -TBâ‚ - TBâ‚‚/(1+r) â†’ 1.05(-200) = -(-10) - TBâ‚‚/1.05 â†’ TBâ‚‚ = 220.5."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Transversality Condition",
                question: "The transversality condition states lim(Tâ†’âˆž) Bâ‚œ/(1+r)áµ€ = 0. Which debt path satisfies this for r = 0.05?",
                options: [
                    "Bâ‚œ = -100(1.05)áµ— (debt grows at rate r)",
                    "Bâ‚œ = -100(1.03)áµ— (debt grows slower than r at 3%)",
                    "Bâ‚œ = -100(1.07)áµ— (debt grows faster than r at 7%)",
                    "Bâ‚œ = -100 for all t (constant debt)"
                ],
                correct: 1,
                explanation: "For transversality: lim Bâ‚œ/(1+r)áµ€ = 0. (A) lim -100(1.05)áµ—/(1.05)áµ— = -100 â‰  0. (B) lim -100(1.03)áµ—/(1.05)áµ— = 0 since 1.03 < 1.05. (C) grows too fast. (D) lim -100/(1.05)áµ— = 0 also works, but B is the debt-growth scenario."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Perpetual Deficits",
                question: "A country with Bâ‚€ = -1000 and r = 0.04 follows the policy TBâ‚œ = -Î±rBâ‚œâ‚‹â‚ with Î± = 0.5. What is TBâ‚ and the resulting CAâ‚?",
                options: [
                    "TBâ‚ = +20, CAâ‚ = -20 (must run trade surplus, but CA still in deficit)",
                    "TBâ‚ = -20, CAâ‚ = +20 (trade deficit dominates)",
                    "TBâ‚ = +20, CAâ‚ = +20 (both in surplus)",
                    "TBâ‚ = -20, CAâ‚ = -60 (trade deficit plus interest payments)"
                ],
                correct: 0,
                explanation: "TBâ‚ = -Î±rBâ‚€ = -0.5(0.04)(-1000) = +20 (trade surplus pays half the interest). CAâ‚ = TBâ‚ + rBâ‚€ = 20 + 0.04(-1000) = 20 - 40 = -20 (CA deficit as only half interest is paid via TB)."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Debt Growth and Sustainability",
                question: "Following the debt-servicing policy TBâ‚œ = -Î±rBâ‚œâ‚‹â‚ with Î± = 0.6 and r = 0.05, at what rate does debt grow?",
                options: [
                    "g = 0.05 (same as interest rate)",
                    "g = 0.03 (explicitly r(1-Î±) = 0.05(1-0.6) = 0.02)",
                    "g = 0.02 (g = r(1-Î±) = 0.05(0.4) = 0.02)",
                    "g = 0.08 (compounds both r and Î±)"
                ],
                correct: 2,
                explanation: "Under debt-servicing policy, debt grows at g = r(1-Î±). Here: g = 0.05(1 - 0.6) = 0.05(0.4) = 0.02 or 2%. This is slower than r, ensuring transversality is satisfied."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Finite vs Infinite Horizon",
                question: "Compare finite vs infinite horizon for a net debtor (Bâ‚€ < 0). Which statement is correct?",
                options: [
                    "Both require TB surpluses in every period",
                    "Finite: must eventually run TB surpluses to reach B_T=0; Infinite: can run perpetual CA deficits if g < r",
                    "Infinite is stricter because it requires immediate debt repayment",
                    "Both allow perpetual TB deficits as long as GDP grows"
                ],
                correct: 1,
                explanation: "Finite horizon (B_T = 0) requires actual repayment via TB surpluses eventually. Infinite horizon allows perpetual CA deficits (but not TB deficits) if debt grows slower than interest rate (transversality: g < r)."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Accounting Identities",
                question: "Given Bâ‚€ = -500, r = 0.06, TBâ‚ = +15, calculate Bâ‚ using Bâ‚œ = (1+r)Bâ‚œâ‚‹â‚ + TBâ‚œ:",
                options: [
                    "Bâ‚ = -530 (lose track of interest compounding)",
                    "Bâ‚ = -515 (simple addition: -500 + 15)",
                    "Bâ‚ = -515 (Bâ‚ = 1.06(-500) + 15 = -530 + 15 = -515)",
                    "Bâ‚ = -470 (incorrectly add interest)"
                ],
                correct: 2,
                explanation: "Bâ‚ = (1+r)Bâ‚€ + TBâ‚ = 1.06(-500) + 15 = -530 + 15 = -515. The debt accumulates interest, then trade surplus partially offsets it."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Accounting Identities",
                question: "If CAâ‚ = -50 and Bâ‚€ = -300 with r = 0.05, what is TBâ‚? Use CAâ‚ = TBâ‚ + rBâ‚€:",
                options: [
                    "TBâ‚ = -50 (CA and TB are the same)",
                    "TBâ‚ = -35 (CAâ‚ = TBâ‚ + rBâ‚€ â†’ -50 = TBâ‚ + 0.05(-300) â†’ TBâ‚ = -50 + 15 = -35)",
                    "TBâ‚ = -65 (CAâ‚ = TBâ‚ - rBâ‚€ â†’ TBâ‚ = -50 - 15)",
                    "TBâ‚ = -15 (only interest component)"
                ],
                correct: 1,
                explanation: "CAâ‚ = TBâ‚ + rBâ‚€. Given CAâ‚ = -50, Bâ‚€ = -300, r = 0.05: -50 = TBâ‚ + 0.05(-300) â†’ -50 = TBâ‚ - 15 â†’ TBâ‚ = -35. Net investment income = rBâ‚€ = -15 worsens the CA relative to TB."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Perpetual Deficits",
                question: "In infinite horizon, which combination is possible for a net debtor under a sustainable debt-servicing policy?",
                options: [
                    "Perpetual CA deficits + Perpetual TB deficits (both can be sustained indefinitely)",
                    "Perpetual CA deficits + Perpetual TB surpluses (CA deficit as only partial interest paid via TB surplus)",
                    "Perpetual CA surpluses + Perpetual TB deficits (interest income dominates trade)",
                    "Neither CA nor TB deficits are sustainable for a net debtor"
                ],
                correct: 1,
                explanation: "Net debtor with TBâ‚œ = -Î±rBâ‚œâ‚‹â‚ (Î± âˆˆ (0,1)): TB > 0 (surplus pays fraction of interest), but CA = TB + rB < 0 (deficit as only partial interest paid). Perpetual TB deficits violate resource constraints."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Debt Growth and Sustainability",
                question: "A country maintains Î± = 0.4 (pays 40% of interest via trade surplus), r = 0.05, and GDP grows at 3% annually. Is this sustainable in infinite horizon?",
                options: [
                    "Yes, because GDP growth (3%) > debt growth g = r(1-Î±) = 0.05(0.6) = 3%",
                    "No, because GDP growth (3%) = debt growth (3%), creating instability",
                    "Yes, because GDP growth (3%) â‰¥ debt growth (3%), maintaining debt-to-GDP ratio stability",
                    "No, because GDP growth must exceed r, not just g"
                ],
                correct: 2,
                explanation: "Debt grows at g = r(1-Î±) = 0.05(0.6) = 0.03 = 3%. GDP also grows at 3%. Since GDP growth â‰¥ debt growth, debt-to-GDP ratio is stable/declining. This satisfies sustainability (transversality + economic feasibility)."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Finite vs Infinite Horizon",
                question: "In a two-period model (T=2), the present value sustainability condition is (1+r)Bâ‚€ = -TBâ‚ - TBâ‚‚/(1+r). If Bâ‚€ = -100, r = 0.1, TBâ‚ = 20, what TBâ‚‚ is required?",
                options: [
                    "TBâ‚‚ = 80 (simple arithmetic: 100 - 20)",
                    "TBâ‚‚ = 90 (PV calculation: 1.1(-100) = -20 - TBâ‚‚/1.1 â†’ -110 = -20 - TBâ‚‚/1.1 â†’ TBâ‚‚/1.1 = 90 â†’ TBâ‚‚ = 99)",
                    "TBâ‚‚ = 99 (from rearranging: TBâ‚‚ = 1.1[20 + 1.1(-100)] = 1.1[20 - 110] = 1.1(-90) magnitude error)",
                    "TBâ‚‚ = 99 (correctly: (1+r)Bâ‚€ = -TBâ‚ - TBâ‚‚/(1+r) â†’ 1.1(-100) = -20 - TBâ‚‚/1.1 â†’ -110 + 20 = -TBâ‚‚/1.1 â†’ -90 = -TBâ‚‚/1.1 â†’ TBâ‚‚ = 99)"
                ],
                correct: 3,
                explanation: "(1+r)Bâ‚€ = -TBâ‚ - TBâ‚‚/(1+r). Substituting: 1.1(-100) = -20 - TBâ‚‚/1.1 â†’ -110 = -20 - TBâ‚‚/1.1 â†’ -90 = -TBâ‚‚/1.1 â†’ TBâ‚‚ = 99. Need a large period-2 surplus to satisfy terminal condition."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Transversality Condition",
                question: "Which economic interpretation best describes why the transversality condition lim Bâ‚œ/(1+r)áµ— = 0 is called the 'No-Ponzi-Game' condition?",
                options: [
                    "It prevents governments from running any deficits",
                    "It prevents perpetual 'rolling over' of debt without ever repaying in present value terms",
                    "It requires debt to be exactly zero in finite time",
                    "It mandates balanced budgets in every period"
                ],
                correct: 1,
                explanation: "The No-Ponzi-Game condition prevents countries from perpetually borrowing new funds to pay interest without ever repaying in present value. Debt can grow, but not faster than râ€”its present value must eventually vanish."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Perpetual Deficits",
                question: "Why can a net debtor run perpetual CA deficits in infinite horizon but NOT perpetual TB deficits?",
                options: [
                    "TB involves real resources (goods/services) that must be repaid eventually; CA includes financial flows that can be rolled over",
                    "CA is measured incorrectly in national accounts",
                    "TB deficits are prohibited by international law",
                    "CA deficits don't affect debt, but TB deficits do"
                ],
                correct: 0,
                explanation: "TB represents real resource flows (exports minus imports). Perpetual TB deficit means never repaying real resourcesâ€”violates resource constraints. CA includes interest payments; running CA deficits while maintaining TB surpluses (paying partial interest) is feasible."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Accounting Identities",
                question: "The evolution equation Bâ‚œ = (1+r)Bâ‚œâ‚‹â‚ + TBâ‚œ can be rearranged to show TBâ‚œ = Bâ‚œ - (1+r)Bâ‚œâ‚‹â‚. What does this reveal about TB when debt is constant (Bâ‚œ = Bâ‚œâ‚‹â‚ = B)?",
                options: [
                    "TB = 0 (no trade activity)",
                    "TB = rB (trade balance exactly offsets interest to keep debt constant)",
                    "TB = -rB (need a surplus of rB magnitude to offset interest on negative B; if B < 0, TB > 0)",
                    "TB = B (trade equals debt)"
                ],
                correct: 2,
                explanation: "If Bâ‚œ = Bâ‚œâ‚‹â‚ = B (constant debt): TB = B - (1+r)B = B - B - rB = -rB. For net debtor (B < 0), this means TB = -r(B) > 0â€”must run trade surplus equal to interest to stabilize debt."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Debt Growth and Sustainability",
                question: "A country with Bâ‚€ = -2000, r = 0.04, follows Î± = 0.75 policy. After many periods, if this is sustained, the debt-to-GDP ratio will:",
                options: [
                    "Explode to infinity as debt grows without bound",
                    "Converge to a stable ratio if GDP growth g_Y â‰¥ r(1-Î±) = 0.01",
                    "Immediately jump to zero",
                    "Oscillate unpredictably"
                ],
                correct: 1,
                explanation: "Debt grows at g = r(1-Î±) = 0.04(0.25) = 0.01 = 1%. If GDP grows â‰¥1%, debt-to-GDP ratio stabilizes or declines. If GDP growth < 1%, ratio rises (unsustainable). The policy is sustainable if g_Y â‰¥ 0.01."
            },
            {
                week: 2,
                difficulty: "hard",
                topic: "Finite vs Infinite Horizon",
                question: "In the two-period model, suppose Bâ‚€ = 0 (initial balanced position), and the country wishes to run TBâ‚ = -100 (deficit). What TBâ‚‚ is needed to satisfy Bâ‚‚ = 0 if r = 0.05?",
                options: [
                    "TBâ‚‚ = +100 (simply reverse the deficit)",
                    "TBâ‚‚ = +105 (repay principal plus interest: (1+r) Ã— 100)",
                    "TBâ‚‚ = +110.25 (compound interest on borrowed amount)",
                    "TBâ‚‚ = +95 (discount back)"
                ],
                correct: 1,
                explanation: "Bâ‚ = (1+r)Bâ‚€ + TBâ‚ = 1.05(0) + (-100) = -100. To reach Bâ‚‚ = 0: Bâ‚‚ = (1+r)Bâ‚ + TBâ‚‚ = 0 â†’ 1.05(-100) + TBâ‚‚ = 0 â†’ TBâ‚‚ = 105. Must repay principal (100) plus interest (5)."
            },

            // Week 3: Theory of Current Account (15 challenging questions)
            {
                week: 3,
                difficulty: "hard",
                topic: "Small Open Economy Model",
                question: "A small open economy has Bâ‚€ = 0, Qâ‚ = 100, Qâ‚‚ = 110, r* = 0.10, and Î² = 0.95. If households optimize with log utility U(C) = ln(C), what is the equilibrium Câ‚?",
                options: [
                    "Câ‚ = 100 (consume endowment each period)",
                    "Câ‚ â‰ˆ 103.8 (solving Euler equation: Câ‚/(Câ‚‚) = Î²(1+r*) = 0.95(1.1) = 1.045, with PV budget constraint)",
                    "Câ‚ = 105 (simple average of endowments)",
                    "Câ‚ â‰ˆ 98.5 (save in period 1 due to patient preferences)"
                ],
                correct: 1,
                explanation: "With log utility, Euler equation: Câ‚/Câ‚‚ = Î²(1+r*). Budget: Câ‚ + Câ‚‚/1.1 = 100 + 110/1.1 = 200. From Euler: Câ‚‚ = Câ‚/[Î²(1+r*)] = Câ‚/1.045. Substituting: Câ‚ + Câ‚/(1.045Ã—1.1) â‰ˆ Câ‚(1 + 0.870) = 200 â†’ Câ‚ â‰ˆ 103.8."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Euler Equation and Optimization",
                question: "The Euler equation U'(Câ‚) = Î²(1+râ‚)U'(Câ‚‚) can be rewritten for log utility as Câ‚/Câ‚‚ = Î²(1+râ‚). If Î² = 1.0 and râ‚ = 0, what does this imply?",
                options: [
                    "Câ‚ = Câ‚‚ (perfect consumption smoothing when time preference equals interest rate)",
                    "Câ‚ > Câ‚‚ (consume more in period 1)",
                    "Câ‚ < Câ‚‚ (save for future)",
                    "Consumption is indeterminate"
                ],
                correct: 0,
                explanation: "If Î² = 1.0 (no time preference) and râ‚ = 0 (no return on saving), then Câ‚/Câ‚‚ = 1.0(1.0) = 1 â†’ Câ‚ = Câ‚‚. Households perfectly smooth consumption across periods."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Temporary vs Permanent Shocks",
                question: "An economy has Qâ‚ = Qâ‚‚ = 100, Bâ‚€ = 0, r* = 0. A temporary shock reduces Qâ‚ to 80 (Qâ‚‚ unchanged). With perfect consumption smoothing (Î²(1+r) = 1), what is the new CAâ‚?",
                options: [
                    "CAâ‚ = -20 (households borrow to maintain Câ‚ = 90, borrowing 10)",
                    "CAâ‚ = 0 (no effect on CA)",
                    "CAâ‚ = -10 (households borrow to smooth: Câ‚ = Câ‚‚ = 90, CAâ‚ = TBâ‚ = Qâ‚ - Câ‚ = 80 - 90 = -10)",
                    "CAâ‚ = +20 (households save the shock)"
                ],
                correct: 2,
                explanation: "With smoothing: Câ‚ = Câ‚‚. Budget: Câ‚ + Câ‚‚ = 80 + 100 = 180 â†’ Câ‚ = Câ‚‚ = 90. CAâ‚ = TBâ‚ = Qâ‚ - Câ‚ = 80 - 90 = -10. Households borrow to smooth the temporary decline."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Temporary vs Permanent Shocks",
                question: "Compare two scenarios: (A) Qâ‚ drops by 20 (temporary), (B) Qâ‚ and Qâ‚‚ each drop by 10 (permanent). With smoothing, which has larger |CAâ‚| impact?",
                options: [
                    "Scenario A: |CAâ‚| = 10 (smooth temporary shock); Scenario B: |CAâ‚| = 0 (adjust to permanent shock). Temporary shock causes larger CA movement.",
                    "Scenario B has larger impact as permanent shocks are more severe",
                    "Both have identical CA impacts",
                    "Neither affects CA"
                ],
                correct: 0,
                explanation: "Scenario A (temporary): PV income drops by 10 (20/2), so Câ‚ = Câ‚‚ drop by 10 each. CAâ‚ = Qâ‚ - Câ‚ = (Qâ‚ - 20) - (Câ‚ - 10) = -10. Scenario B (permanent): Câ‚, Câ‚‚ each drop by 10, matching output declines â†’ CAâ‚ â‰ˆ 0. Temporary shocks cause large CA movements."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Anticipated Income Shocks",
                question: "An economy learns in period 1 that Qâ‚‚ will increase from 100 to 120 (Qâ‚ = 100 unchanged). With r* = 0 and perfect smoothing, what happens?",
                options: [
                    "CAâ‚ = -10 (households increase Câ‚ from 100 to 110, borrowing against future income)",
                    "CAâ‚ = 0 (no change until period 2)",
                    "CAâ‚ = +10 (save in anticipation)",
                    "CAâ‚ = -20 (households over-borrow)"
                ],
                correct: 0,
                explanation: "Original: Câ‚ = Câ‚‚ = 100. New PV income: 100 + 120 = 220 â†’ Câ‚ = Câ‚‚ = 110. Since Qâ‚ = 100 but Câ‚ = 110, CAâ‚ = TBâ‚ = 100 - 110 = -10. Good news about future causes current CA deterioration."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Budget Constraint",
                question: "Given Bâ‚€ = -50, Qâ‚ = 100, Qâ‚‚ = 110, r* = 0.10, the intertemporal budget constraint is Câ‚ + Câ‚‚/(1.1) = (1.1)(-50) + 100 + 110/1.1. Calculate the RHS (present value of resources):",
                options: [
                    "PV = 155 (accurately: -55 + 100 + 100 = 145)",
                    "PV = 145 (correct: 1.1(-50) + 100 + 110/1.1 = -55 + 100 + 100 = 145)",
                    "PV = 160 (ignoring initial debt)",
                    "PV = 210 (summing without discounting)"
                ],
                correct: 1,
                explanation: "PV of resources = (1+râ‚€)Bâ‚€ + Qâ‚ + Qâ‚‚/(1+râ‚) = 1.1(-50) + 100 + 110/1.1 = -55 + 100 + 100 = 145. The initial debt reduces available resources for consumption."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Budget Constraint",
                question: "If the intertemporal budget constraint is satisfied with Câ‚ = 105, Câ‚‚ = 115, Qâ‚ = 100, Qâ‚‚ = 110, r = 0, and Bâ‚€ = 0, what is TBâ‚?",
                options: [
                    "TBâ‚ = -5 (Qâ‚ - Câ‚ = 100 - 105 = -5, trade deficit to finance excess consumption)",
                    "TBâ‚ = +5 (trade surplus)",
                    "TBâ‚ = 0 (balanced trade)",
                    "TBâ‚ = -10 (larger deficit)"
                ],
                correct: 0,
                explanation: "TBâ‚ = Qâ‚ - Câ‚ = 100 - 105 = -5. The household consumes more than output in period 1, running a trade deficit, borrowing to finance it."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Small Open Economy Model",
                question: "With free capital mobility, if the world interest rate r* = 0.05 and domestic agents try to set domestic rate râ‚ = 0.03, what happens?",
                options: [
                    "Massive capital outflows drive domestic rate back to râ‚ = r* = 0.05 (arbitrage ensures interest rate parity)",
                    "Domestic rate stays at 0.03 due to government policy",
                    "Equilibrium at râ‚ = 0.04 (average of the two rates)",
                    "No capital flows occur"
                ],
                correct: 0,
                explanation: "Free capital mobility implies râ‚ = r* via arbitrage. If domestic r < world r, capital flows out (domestic agents invest abroad at higher return), raising domestic rate until râ‚ = r* = 0.05."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Euler Equation and Optimization",
                question: "For CRRA utility U(C) = C^(1-Ïƒ)/(1-Ïƒ) with Ïƒ = 2 (high risk aversion), the Euler equation is Câ‚^(-2) / Câ‚‚^(-2) = Î²(1+r). If Î² = 0.96 and r = 0.05, and Câ‚‚ = 100, what is Câ‚?",
                options: [
                    "Câ‚ â‰ˆ 99.0 (Câ‚‚/Câ‚)Â² = Î²(1+r) = 0.96(1.05) = 1.008 â†’ Câ‚‚/Câ‚ â‰ˆ 1.004 â†’ Câ‚ â‰ˆ 99.6)",
                    "Câ‚ â‰ˆ 99.6 (correctly solving: (Câ‚‚/Câ‚)Â² = 1.008 â†’ Câ‚‚/Câ‚ â‰ˆ 1.004 â†’ Câ‚ = 100/1.004 â‰ˆ 99.6)",
                    "Câ‚ = 100 (equal consumption)",
                    "Câ‚ â‰ˆ 95 (much lower due to high risk aversion)"
                ],
                correct: 1,
                explanation: "Euler: (Câ‚/Câ‚‚)^Ïƒ = Î²(1+r) â†’ (Câ‚/Câ‚‚)Â² = 0.96(1.05) = 1.008 â†’ Câ‚/Câ‚‚ = âˆš1.008 â‰ˆ 1.004 â†’ Câ‚ = Câ‚‚/1.004 â‰ˆ 100/1.004 â‰ˆ 99.6. Slight tilt toward period-2 consumption given Î² < 1/(1+r)."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Consumption Smoothing",
                question: "Why do households prefer consumption smoothing (due to concave utility U''(C) < 0)?",
                options: [
                    "Diminishing marginal utility: the utility gain from extra consumption when C is low exceeds the utility loss from reduced consumption when C is high",
                    "Households dislike variety in consumption baskets",
                    "Government mandates smooth consumption",
                    "Inflation erodes purchasing power"
                ],
                correct: 0,
                explanation: "Concave utility (U''(C) < 0) means diminishing marginal utility. Transferring consumption from high-C period to low-C period increases total utility, as marginal utility is higher when C is low. This drives smoothing."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Temporary vs Permanent Shocks",
                question: "An oil-exporting country experiences a temporary oil price boom that increases Qâ‚ by 50 (Qâ‚‚ unchanged). With perfect smoothing and r = 0, how much does Câ‚ increase, and what is the CAâ‚ response?",
                options: [
                    "Câ‚ increases by 50, CAâ‚ = 0 (consume all the windfall)",
                    "Câ‚ increases by 25, CAâ‚ = +25 (save half the windfall to smooth consumption: Î”Câ‚ = Î”Câ‚‚ = 25)",
                    "Câ‚ increases by 10, CAâ‚ = +40 (mostly save)",
                    "Câ‚ unchanged, CAâ‚ = +50 (save all windfall)"
                ],
                correct: 1,
                explanation: "Temporary windfall increases PV income by 50. With smoothing and r = 0: Î”Câ‚ = Î”Câ‚‚ = 25. Since Qâ‚ rises by 50 but Câ‚ rises by 25, CAâ‚ improves by 50 - 25 = +25. Save half the windfall."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Anticipated Income Shocks",
                question: "A developing country announces major reforms expected to boost Qâ‚‚ from 100 to 150 (Qâ‚ = 100). Markets believe the reforms. If r = 0.10 and households smooth consumption, how does CAâ‚ respond?",
                options: [
                    "CAâ‚ deteriorates by approximately 22.7 (households increase Câ‚ from baseline by borrowing against future prosperity)",
                    "CAâ‚ improves as households save in anticipation",
                    "CAâ‚ unchanged until reforms materialize",
                    "CAâ‚ deteriorates by 50 (households borrow the full future increase)"
                ],
                correct: 0,
                explanation: "Original PV: 100 + 100/1.1 â‰ˆ 190.9 â†’ Câ‚ = Câ‚‚/(1+r). New PV: 100 + 150/1.1 â‰ˆ 236.4. Solving Euler + budget (simplified with log utility Î²(1+r) = 1): Câ‚ â‰ˆ 122.7. CAâ‚ = TBâ‚ = Qâ‚ - Câ‚ = 100 - 122.7 â‰ˆ -22.7."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Small Open Economy Model",
                question: "In equilibrium, the three key conditions are: (1) Intertemporal budget constraint, (2) Euler equation (optimality), (3) Interest rate parity (râ‚ = r*). If a country imposes capital controls preventing capital outflows, which condition is violated?",
                options: [
                    "Condition (3): interest rate parity breaks down (domestic râ‚ can deviate from r*)",
                    "Condition (1): budget constraint is no longer binding",
                    "Condition (2): households no longer optimize",
                    "All three conditions are maintained"
                ],
                correct: 0,
                explanation: "Capital controls prevent free capital mobility, breaking the arbitrage that enforces râ‚ = r*. The domestic interest rate can deviate from the world rate. Budget constraint and household optimization still hold domestically."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Budget Constraint",
                question: "An economy with Bâ‚€ = 0, Qâ‚ = 100, Qâ‚‚ = 121, r* = 0.10, and Î² = 1/1.1 (implying Î²(1+r) = 1) optimizes consumption. What is the equilibrium CAâ‚?",
                options: [
                    "CAâ‚ = 0 (TBâ‚ = Qâ‚ - Câ‚ = 100 - 110 = -10, but CAâ‚ = TBâ‚ + rBâ‚€ = -10 + 0 = -10; wait, if Câ‚=Câ‚‚=110 with r=0.1: PV check)",
                    "CAâ‚ â‰ˆ -10 (with perfect smoothing Câ‚ = Câ‚‚: budget Câ‚ + Câ‚‚/1.1 = 100 + 121/1.1 = 210 â†’ Câ‚ = Câ‚‚ = 110 â†’ TBâ‚ = -10)",
                    "CAâ‚ = +10 (save in period 1)",
                    "CAâ‚ = -21 (borrow heavily)"
                ],
                correct: 1,
                explanation: "Î²(1+r) = 1 implies perfect smoothing: Câ‚ = Câ‚‚. Budget: Câ‚ + Câ‚‚/1.1 = 100 + 110 = 210 â†’ Câ‚(1 + 1/1.1) = 210 â†’ Câ‚(1.909) = 210 â†’ Câ‚ â‰ˆ 110. CAâ‚ = TBâ‚ = Qâ‚ - Câ‚ = 100 - 110 = -10."
            },
            {
                week: 3,
                difficulty: "hard",
                topic: "Consumption Smoothing",
                question: "Without international borrowing/lending (financial autarky), an economy with Qâ‚ = 80, Qâ‚‚ = 120 must satisfy:",
                options: [
                    "Câ‚ = Qâ‚ = 80, Câ‚‚ = Qâ‚‚ = 120 (no smoothing possible, consumption tied to output each period)",
                    "Câ‚ = Câ‚‚ = 100 (perfect smoothing despite autarky)",
                    "Câ‚ = 90, Câ‚‚ = 110 (partial smoothing)",
                    "CAâ‚ = -20 (can still borrow)"
                ],
                correct: 0,
                explanation: "Financial autarky means no international borrowing/lending: Bâ‚ = Bâ‚€ = 0 always. Thus, Câ‚ = Qâ‚ = 80 and Câ‚‚ = Qâ‚‚ = 120. Consumption volatility matches output volatilityâ€”no smoothing possible."
            },

            // Week 4: Terms of Trade, World Interest Rate Shocks, and Tariffs (15 challenging questions)
            {
                week: 4,
                difficulty: "hard",
                topic: "Terms of Trade",
                question: "The terms of trade (TT) is defined as TT = P^X / P^M. If an oil-exporting country experiences a rise in oil prices (P^X â†‘) while import prices remain constant (P^M unchanged), how does this affect TTâ‚ and the budget constraint?",
                options: [
                    "TTâ‚ falls, making the country poorer in real terms",
                    "TTâ‚ rises (TTâ‚ = P^Xâ‚/P^Mâ‚ increases), improving the country's purchasing power: resources = TTâ‚Qâ‚ + TTâ‚‚Qâ‚‚/(1+r) rise",
                    "TTâ‚ unchanged as both prices move proportionally",
                    "TTâ‚ effect depends on the elasticity of substitution"
                ],
                correct: 1,
                explanation: "TT = P^X/P^M. If P^X â†‘ and P^M constant, then TT â†‘. This improvement in terms of trade increases the real value of exports (TTâ‚Qâ‚), expanding the budget constraint and making the country richer."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "Terms of Trade",
                question: "An economy with Qâ‚ = Qâ‚‚ = 100, TTâ‚ = 1, TTâ‚‚ = 1, experiences a temporary TT shock: TTâ‚ rises to 1.2 (TTâ‚‚ = 1 unchanged). With perfect smoothing (r = 0), what is the CAâ‚ response?",
                options: [
                    "CAâ‚ = 0 (temporary shocks don't affect CA)",
                    "CAâ‚ â‰ˆ +10 (country saves most of the windfall: PV income rises by 20, so Câ‚ = Câ‚‚ rise by 10 each; CAâ‚ = TTâ‚Qâ‚ - Câ‚ = 120 - 110 = +10)",
                    "CAâ‚ = +20 (save entire windfall)",
                    "CAâ‚ = -10 (borrow against future income)"
                ],
                correct: 1,
                explanation: "Temporary TT improvement (TTâ‚ from 1 to 1.2) increases PV income by TTâ‚Qâ‚ - Qâ‚ = 120 - 100 = 20. With smoothing: Î”Câ‚ = Î”Câ‚‚ = 10. CAâ‚ = TTâ‚Qâ‚ - Câ‚ = 120 - 110 = +10. Country saves half the windfall."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "Terms of Trade",
                question: "Compare two scenarios: (A) TTâ‚ rises from 1 to 1.1 (temporary), (B) TTâ‚ and TTâ‚‚ both rise from 1 to 1.1 (permanent). Which has larger CAâ‚ impact?",
                options: [
                    "Scenario B: permanent shocks have larger effects",
                    "Scenario A: CAâ‚ improves significantly as country smooths by saving; Scenario B: CAâ‚ changes little as consumption rises in both periods",
                    "Both have identical CAâ‚ effects",
                    "Neither affects CAâ‚"
                ],
                correct: 1,
                explanation: "Temporary TT improvement: country saves windfall to smooth consumption â†’ large CAâ‚ improvement. Permanent TT improvement: consumption rises in both periods proportionally â†’ little CAâ‚ change. Same principle as endowment shocks."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "World Interest Rate Shocks",
                question: "When the world interest rate r* rises, there are two effects: substitution and income. For a net borrower (Bâ‚€ < 0), which statement is correct?",
                options: [
                    "Substitution effect: Câ‚ â†“ (bonds more attractive); Income effect: Câ‚ â†“ (poorer due to higher debt costs); Effects reinforce â†’ CAâ‚ â†‘",
                    "Substitution and income effects oppose, making the net effect ambiguous",
                    "Only substitution effect matters; income effect is negligible",
                    "Interest rate changes don't affect consumption decisions"
                ],
                correct: 0,
                explanation: "For net borrower (Bâ‚€ < 0): (1) Substitution effect: r â†‘ makes saving more attractive â†’ Câ‚ â†“. (2) Income effect: r â†‘ raises debt service costs â†’ poorer â†’ Câ‚ â†“. Both effects reinforce, unambiguously improving CAâ‚."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "World Interest Rate Shocks",
                question: "For a net lender (Bâ‚€ > 0), an increase in r* creates opposing effects. Which effect typically dominates under standard preferences?",
                options: [
                    "Income effect dominates: higher returns make lender richer â†’ Câ‚ â†‘, CAâ‚ â†“",
                    "Substitution effect dominates: bonds more attractive â†’ Câ‚ â†“, CAâ‚ â†‘ (savings should increase with interest rate)",
                    "Both effects exactly cancel",
                    "Net effect depends entirely on the size of Bâ‚€"
                ],
                correct: 1,
                explanation: "For net lender (Bâ‚€ > 0): income effect (richer â†’ Câ‚ â†‘) opposes substitution effect (bonds more attractive â†’ Câ‚ â†“). Under standard preferences, substitution effect dominatesâ€”we expect savings to increase when r rises."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "World Interest Rate Shocks",
                question: "An economy with Bâ‚€ = 0 experiences an increase in r* from 0.05 to 0.10. The Euler equation changes from Câ‚/Câ‚‚ = Î²(1.05) to Câ‚/Câ‚‚ = Î²(1.10). What happens to Câ‚ relative to Câ‚‚?",
                options: [
                    "Câ‚/Câ‚‚ rises (tilt consumption toward period 1)",
                    "Câ‚/Câ‚‚ falls (tilt consumption toward period 2, as Câ‚‚ becomes cheaper in PV terms)",
                    "Câ‚/Câ‚‚ unchanged (Bâ‚€ = 0 means no income effect)",
                    "Cannot determine without knowing Î²"
                ],
                correct: 1,
                explanation: "With Bâ‚€ = 0 (pure substitution effect): higher r makes future consumption cheaper in present value. Câ‚/Câ‚‚ = Î²(1+r) rises â†’ Câ‚ rises relative to Câ‚‚. But in levels, Câ‚ falls because budget constraint rotates: TBâ‚ = Qâ‚ - Câ‚ improves."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "Import Tariffs",
                question: "The modified Euler equation with tariffs is U'(Câ‚) = [(1+Ï„â‚)/(1+Ï„â‚‚)]Î²(1+r)U'(Câ‚‚). If Ï„â‚ = 0.10 and Ï„â‚‚ = 0, what is the effect?",
                options: [
                    "(1+Ï„â‚)/(1+Ï„â‚‚) = 1.10 > 1 makes current consumption relatively expensive â†’ Câ‚ â†“, CAâ‚ â†‘",
                    "(1+Ï„â‚)/(1+Ï„â‚‚) = 1.10 > 1 makes current consumption relatively cheap â†’ Câ‚ â†‘, CAâ‚ â†“",
                    "Temporary tariffs have no effect on consumption allocation",
                    "The ratio equals 1 since Ï„â‚‚ = 0"
                ],
                correct: 0,
                explanation: "Temporary tariff (Ï„â‚ = 0.10, Ï„â‚‚ = 0): (1+Ï„â‚)/(1+Ï„â‚‚) = 1.10/1 = 1.10 > 1. This makes current consumption relatively expensive (high tariff now, no tariff later). Households postpone consumption: Câ‚ â†“, CAâ‚ â†‘."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "Import Tariffs",
                question: "A permanent tariff is imposed: Ï„â‚ = Ï„â‚‚ = 0.20. What is the effect on the current account?",
                options: [
                    "CAâ‚ improves significantly as tariffs reduce imports",
                    "No effect on CAâ‚: (1+Ï„â‚)/(1+Ï„â‚‚) = 1 in Euler equation, no intertemporal substitution created",
                    "CAâ‚ deteriorates due to retaliation",
                    "Effect depends on elasticity of import demand"
                ],
                correct: 1,
                explanation: "Permanent tariff (Ï„â‚ = Ï„â‚‚): the ratio (1+Ï„â‚)/(1+Ï„â‚‚) = 1 in Euler equation. No intertemporal distortion is created. Consumption path and CA are unchanged. Tariffs only affect CA via intertemporal substitution."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "Import Tariffs",
                question: "An anticipated future tariff is announced: Ï„â‚ = 0, Ï„â‚‚ = 0.25. How does this affect CAâ‚?",
                options: [
                    "CAâ‚ improves as households save in anticipation",
                    "CAâ‚ deteriorates: (1+Ï„â‚)/(1+Ï„â‚‚) = 1/1.25 = 0.8 < 1 makes current consumption relatively cheap â†’ Câ‚ â†‘, CAâ‚ â†“",
                    "No effect until Ï„â‚‚ is actually implemented",
                    "CAâ‚ improves slightly due to precautionary saving"
                ],
                correct: 1,
                explanation: "Anticipated future tariff (Ï„â‚ = 0, Ï„â‚‚ = 0.25): (1+Ï„â‚)/(1+Ï„â‚‚) = 1/1.25 = 0.8 < 1. Current consumption is relatively cheap (no tariff now, high tariff later). Households front-load consumption: Câ‚ â†‘, CAâ‚ â†“."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "Import Tariffs",
                question: "Why do permanent tariffs not affect the current account in this model, despite reducing imports?",
                options: [
                    "The model assumes tariff revenues are wasted",
                    "Tariff revenues are rebated lump-sum (L_t = Ï„_t C_t), so economy-wide resource constraint is unchanged: Câ‚ + Câ‚‚/(1+r) = (1+r)Bâ‚€ + TTâ‚Qâ‚ + TTâ‚‚Qâ‚‚/(1+r)",
                    "Imports don't affect the current account",
                    "The model ignores general equilibrium effects"
                ],
                correct: 1,
                explanation: "Tariff revenues are rebated lump-sum to households (L_t = Ï„_t C_t). This means the economy-wide budget constraint remains unchangedâ€”no net resources are gained or lost. Permanent tariffs don't create intertemporal distortions, so CA is unaffected."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "Terms of Trade",
                question: "A commodity exporter has Qâ‚ = Qâ‚‚ = 100, TTâ‚ = 1, TTâ‚‚ = 1, r = 0. A permanent TT improvement occurs: TTâ‚ = TTâ‚‚ = 1.2. With perfect smoothing, how much does Câ‚ increase?",
                options: [
                    "Î”Câ‚ = 10 (half the increase)",
                    "Î”Câ‚ = 20 (full increase in both periods: PV income rises by 120 - 100 = 20 in each period, so Î”Câ‚ = Î”Câ‚‚ = 20)",
                    "Î”Câ‚ = 0 (permanent shocks don't affect consumption)",
                    "Î”Câ‚ = 40 (double the increase)"
                ],
                correct: 1,
                explanation: "Permanent TT improvement: PV income changes from 100 + 100 = 200 to 120 + 120 = 240. Î”PV = 40. With smoothing: Î”Câ‚ = Î”Câ‚‚ = 20. Permanent shocks are fully adjusted to; no smoothing via borrowing/lending needed."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "World Interest Rate Shocks",
                question: "An economy has Bâ‚€ = -100, r* rises from 0.05 to 0.10. The income effect changes the budget constraint by approximately:",
                options: [
                    "+5 (additional interest income)",
                    "-5 (increased debt service: Î”(rBâ‚€) = 0.05(-100) = -5, reducing PV resources)",
                    "0 (Bâ‚€ < 0 means no income effect)",
                    "-10 (debt service doubles)"
                ],
                correct: 1,
                explanation: "Net borrower (Bâ‚€ = -100): income effect from r rising by 0.05 is Î”(rBâ‚€) = 0.05 Ã— (-100) = -5. The country must pay additional interest, reducing available resources by approximately 5 in present value terms."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "World Interest Rate Shocks",
                question: "For a country with Bâ‚€ = +200 (net lender), r* rises from 0.04 to 0.06. The positive income effect increases resources by:",
                options: [
                    "+4 (Î”(rBâ‚€) = 0.02 Ã— 200 = 4)",
                    "+8 (proportional to the rate change)",
                    "+12 (including compounding)",
                    "0 (interest changes don't create income effects for lenders)"
                ],
                correct: 0,
                explanation: "Net lender (Bâ‚€ = +200): income effect from r rising by 0.02 is Î”(rBâ‚€) = 0.02 Ã— 200 = +4. The country earns additional interest income, increasing available resources by 4 in present value."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "Import Tariffs",
                question: "The household budget constraints with tariffs are (1+Ï„â‚)Câ‚ + Bâ‚ = TTâ‚Qâ‚ + Lâ‚ + (1+râ‚€)Bâ‚€ where Lâ‚ = Ï„â‚Câ‚. Substituting the rebate, the constraint simplifies to:",
                options: [
                    "Câ‚ + Bâ‚ = TTâ‚Qâ‚ + (1+râ‚€)Bâ‚€ (tariff term cancels out as (1+Ï„â‚)Câ‚ - Ï„â‚Câ‚ = Câ‚)",
                    "(1+Ï„â‚)Câ‚ + Bâ‚ = TTâ‚Qâ‚ + (1+râ‚€)Bâ‚€ (rebate doesn't affect household)",
                    "Ï„â‚Câ‚ + Bâ‚ = TTâ‚Qâ‚ (only tariff component matters)",
                    "Tariffs prevent simplification"
                ],
                correct: 0,
                explanation: "(1+Ï„â‚)Câ‚ + Bâ‚ = TTâ‚Qâ‚ + Lâ‚ + (1+râ‚€)Bâ‚€. With Lâ‚ = Ï„â‚Câ‚: (1+Ï„â‚)Câ‚ + Bâ‚ = TTâ‚Qâ‚ + Ï„â‚Câ‚ + (1+râ‚€)Bâ‚€. Simplifying: Câ‚ + Bâ‚ = TTâ‚Qâ‚ + (1+râ‚€)Bâ‚€. The economy-wide resource constraint is unaffected by tariffs when revenues are rebated."
            },
            {
                week: 4,
                difficulty: "hard",
                topic: "Terms of Trade",
                question: "Why do terms-of-trade shocks behave identically to endowment shocks in their CA effects?",
                options: [
                    "They both affect the present value of resources in the same way: TT_t Q_t is analogous to endowment Q_t",
                    "Terms of trade don't actually affect the current account",
                    "Endowment shocks are always larger in magnitude",
                    "They affect different components of the budget constraint"
                ],
                correct: 0,
                explanation: "In the budget constraint Câ‚ + Câ‚‚/(1+r) = (1+r)Bâ‚€ + TTâ‚Qâ‚ + TTâ‚‚Qâ‚‚/(1+r), terms-of-trade-adjusted output TT_t Q_t plays the same role as endowment Q_t in the single-good model. Temporary vs permanent TT shocks have identical CA effects to endowment shocks."
            },

            // Week 5: Production Economy and Current Account Determination
            {
                week: 5,
                difficulty: "hard",
                topic: "Production Economy",
                question: "In the production economy model, output in period t is Q_t = A_t F(I_{t-1}), where I_{t-1} is investment and A_t is productivity. What is the marginal product of capital (MPK)?",
                options: [
                    "MPK = F(I_{t-1})",
                    "MPK = A_t F'(I_{t-1}) (the additional output from one more unit of investment)",
                    "MPK = A_t F(I_{t-1}) / I_{t-1}",
                    "MPK = F'(I_{t-1}) / A_t"
                ],
                correct: 1,
                explanation: "Marginal product of capital: MPKâ‚‚ = âˆ‚Qâ‚‚/âˆ‚Iâ‚ = Aâ‚‚F'(Iâ‚). This represents the additional output in period 2 from investing one more unit in period 1, accounting for productivity Aâ‚‚."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Production Economy",
                question: "The firm's profit maximization condition for optimal investment is Aâ‚‚F'(Iâ‚) = 1 + râ‚. What is the economic interpretation?",
                options: [
                    "Marginal product equals the interest rate",
                    "Invest until marginal benefit (MPK) equals marginal cost (1 + râ‚, the opportunity cost of funds)",
                    "All output should be invested",
                    "Investment should equal savings"
                ],
                correct: 1,
                explanation: "Aâ‚‚F'(Iâ‚) = 1 + râ‚: invest until the marginal benefit (additional output from last unit invested, MPK = Aâ‚‚F'(Iâ‚)) equals the marginal cost (opportunity cost of funds, 1 + râ‚). This is the standard first-order condition."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Investment Schedule",
                question: "The investment schedule I_1 = I(r_1^-, A_2^+) shows how investment depends on r_1 and A_2. Why is âˆ‚I_1/âˆ‚r_1 < 0?",
                options: [
                    "Higher interest rates make investment more attractive",
                    "Higher r_1 increases the opportunity cost of investing â†’ firms invest less (I_1 â†“)",
                    "Investment is independent of interest rates",
                    "The relationship depends on productivity"
                ],
                correct: 1,
                explanation: "From A_2Â·F'(I_1) = 1 + r_1: if r_1 rises, firms must reduce I_1 to raise F'(I_1) (due to diminishing returns) to satisfy the condition. Higher interest rates â†’ higher opportunity cost â†’ less investment."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Investment Schedule",
                question: "Why is âˆ‚I_1/âˆ‚A_2 > 0 in the investment schedule I_1 = I(r_1^-, A_2^+)?",
                options: [
                    "Higher productivity A_2 raises the marginal product A_2Â·F'(I_1), making investment more profitable â†’ I_1 â†‘",
                    "Productivity shocks don't affect investment decisions",
                    "Higher A_2 reduces investment due to income effects",
                    "The relationship is ambiguous"
                ],
                correct: 0,
                explanation: "From A_2Â·F'(I_1) = 1 + r_1: if A_2 rises, firms can invest more (I_1 â†‘) while still satisfying the condition (as A_2Â·F'(I_1) rises). Higher future productivity makes investment more profitable."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Saving Schedule",
                question: "The saving schedule is Sâ‚ = S(râ‚âº, Aâ‚âº, Aâ‚‚â»). Why is âˆ‚Sâ‚/âˆ‚Aâ‚ > 0?",
                options: [
                    "Higher Aâ‚ reduces output and income",
                    "Higher current productivity Aâ‚ increases Qâ‚ = Aâ‚F(Iâ‚€), raising income â†’ households save more (temporary income shock)",
                    "Productivity doesn't affect saving decisions",
                    "Higher Aâ‚ causes households to borrow"
                ],
                correct: 1,
                explanation: "Sâ‚ = Qâ‚ - Câ‚. Higher Aâ‚ raises Qâ‚ = Aâ‚F(Iâ‚€). If this is a temporary shock (Aâ‚‚ unchanged), households smooth consumption: Câ‚ rises less than Qâ‚ â†’ Sâ‚ = Qâ‚ - Câ‚ rises."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Saving Schedule",
                question: "Why is âˆ‚Sâ‚/âˆ‚Aâ‚‚ < 0 in the saving schedule Sâ‚ = S(râ‚âº, Aâ‚âº, Aâ‚‚â»)?",
                options: [
                    "Higher future productivity Aâ‚‚ is good news â†’ households borrow against future income â†’ Sâ‚ â†“",
                    "Future productivity doesn't affect current saving",
                    "Higher Aâ‚‚ increases current saving for precautionary reasons",
                    "The relationship depends on risk aversion"
                ],
                correct: 0,
                explanation: "Higher Aâ‚‚ means higher future income Qâ‚‚ = Aâ‚‚F(Iâ‚). Good news about future income causes households to increase Câ‚ (borrowing against future) â†’ Sâ‚ = Qâ‚ - Câ‚ falls. This is the anticipated income effect."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Current Account Schedule",
                question: "The current account schedule is CAâ‚ = CA(râ‚âº, Aâ‚âº, Aâ‚‚â») = Sâ‚ - Iâ‚. Why is âˆ‚CAâ‚/âˆ‚Aâ‚ > 0?",
                options: [
                    "Higher Aâ‚ increases both Sâ‚ and Iâ‚ equally",
                    "Higher current productivity Aâ‚ raises Sâ‚ (temporary income shock â†’ save windfall) but doesn't directly affect Iâ‚ (depends on Aâ‚‚) â†’ CAâ‚ â†‘",
                    "Higher Aâ‚ causes CAâ‚ to deteriorate",
                    "Current productivity doesn't affect CA"
                ],
                correct: 1,
                explanation: "CAâ‚ = Sâ‚ - Iâ‚. Higher Aâ‚: (1) Sâ‚ rises (temporary income boost â†’ save windfall). (2) Iâ‚ unchanged (investment depends on Aâ‚‚, not Aâ‚). Net effect: CAâ‚ = Sâ‚ - Iâ‚ improves."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Current Account Schedule",
                question: "Why is âˆ‚CAâ‚/âˆ‚Aâ‚‚ < 0 in the current account schedule CAâ‚ = CA(râ‚âº, Aâ‚âº, Aâ‚‚â»)?",
                options: [
                    "Higher Aâ‚‚ reduces saving Sâ‚ (good news â†’ borrow) and increases investment Iâ‚ (more profitable) â†’ both effects worsen CAâ‚",
                    "Future productivity shocks don't affect current CA",
                    "Higher Aâ‚‚ improves CAâ‚ through precautionary saving",
                    "The effect is ambiguous"
                ],
                correct: 0,
                explanation: "CAâ‚ = Sâ‚ - Iâ‚. Higher Aâ‚‚: (1) Sâ‚ â†“ (good news about future â†’ households borrow). (2) Iâ‚ â†‘ (higher MPK â†’ firms invest more). Both effects reduce CAâ‚: âˆ‚CAâ‚/âˆ‚Aâ‚‚ < 0."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Metzler Diagram",
                question: "In the Metzler diagram with râ‚ on the vertical axis and Sâ‚, Iâ‚, CAâ‚ on the horizontal axis, the investment schedule I(râ‚â») slopes:",
                options: [
                    "Upward: higher râ‚ â†’ more investment",
                    "Downward: higher râ‚ â†’ higher opportunity cost â†’ less investment",
                    "Vertical: investment is independent of râ‚",
                    "Horizontal: interest rate adjusts to investment"
                ],
                correct: 1,
                explanation: "Investment schedule I(râ‚â») slopes downward: âˆ‚Iâ‚/âˆ‚râ‚ < 0. Higher interest rates increase the opportunity cost of investing, reducing optimal investment. The curve is downward-sloping in (Iâ‚, râ‚) space."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Metzler Diagram",
                question: "In the Metzler diagram, the saving schedule S(râ‚âº) slopes:",
                options: [
                    "Upward: higher râ‚ â†’ substitution effect dominates â†’ save more",
                    "Downward: higher râ‚ â†’ consume more",
                    "Vertical: saving is independent of râ‚",
                    "Ambiguous: income and substitution effects oppose"
                ],
                correct: 0,
                explanation: "Saving schedule S(râ‚âº) slopes upward: âˆ‚Sâ‚/âˆ‚râ‚ > 0. Higher interest rates make saving more attractive (substitution effect typically dominates income effect), so households save more."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Metzler Diagram",
                question: "A positive productivity shock in period 2 (Aâ‚‚ â†‘) shifts which curves in the Metzler diagram?",
                options: [
                    "Investment schedule shifts right (I_1 â†‘); Saving schedule shifts left (S_1 â†“); CA_1 schedule shifts left (worsens)",
                    "Only investment schedule shifts",
                    "Both schedules shift right",
                    "Neither schedule shifts"
                ],
                correct: 0,
                explanation: "A_2 â†‘: (1) Investment: I_1 = I(r_1^-, A_2^+) shifts right (higher MPK â†’ more investment). (2) Saving: S_1 = S(r_1^+, A_1^+, A_2^-) shifts left (good news â†’ borrow â†’ S_1 â†“). (3) CA_1 = S_1 - I_1 shifts left (deteriorates)."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Giant Oil Discoveries",
                question: "The giant oil discoveries application shows that when large oil fields are discovered (future productivity shock Aâ‚‚ â†‘), the empirical evidence supports:",
                options: [
                    "CAâ‚ deteriorates: countries invest heavily (Iâ‚ â†‘) and borrow against future oil income (Sâ‚ â†“), confirming model predictions",
                    "CAâ‚ improves due to precautionary saving",
                    "CAâ‚ is unaffected by oil discoveries",
                    "Investment remains unchanged"
                ],
                correct: 0,
                explanation: "Giant oil discoveries represent large anticipated productivity shocks (Aâ‚‚ â†‘). Model predicts: Iâ‚ â†‘ (building infrastructure to extract oil) and Sâ‚ â†“ (borrowing against future oil revenue) â†’ CAâ‚ deteriorates. Empirical evidence confirms this pattern."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Production Economy",
                question: "The production function Q_t = A_t F(I_{t-1}) exhibits diminishing marginal product of capital: F''(I) < 0. What does this imply for the investment response to Aâ‚‚?",
                options: [
                    "Higher Aâ‚‚ leads to infinite investment",
                    "F''(I) < 0 ensures a finite investment response: as Iâ‚ rises, F'(Iâ‚) falls, limiting how much investment increases",
                    "Diminishing returns prevent any investment",
                    "Investment becomes negative"
                ],
                correct: 1,
                explanation: "Diminishing returns (F''(I) < 0) mean F'(Iâ‚) falls as Iâ‚ rises. From Aâ‚‚F'(Iâ‚) = 1 + râ‚: even if Aâ‚‚ rises, the decline in F'(Iâ‚) as Iâ‚ increases ensures a finite, determinate level of optimal investment."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Current Account Schedule",
                question: "In a small open economy with free capital mobility, râ‚ = r* (world rate). If the world rate rises (r* â†‘), what happens to CAâ‚ in the production economy?",
                options: [
                    "CAâ‚ worsens as investment increases",
                    "CAâ‚ improves: Sâ‚ rises (substitution effect in saving) and Iâ‚ falls (higher opportunity cost) â†’ CAâ‚ = Sâ‚ - Iâ‚ unambiguously improves",
                    "CAâ‚ unchanged",
                    "Effect depends on productivity shocks"
                ],
                correct: 1,
                explanation: "râ‚ = r* rises: (1) Sâ‚ = S(râ‚âº, ...) increases (saving more attractive). (2) Iâ‚ = I(râ‚â», ...) decreases (investment less profitable). (3) CAâ‚ = Sâ‚ - Iâ‚ unambiguously improves. Both effects work in same direction."
            },
            {
                week: 5,
                difficulty: "hard",
                topic: "Production Economy",
                question: "How does the production economy model differ from the endowment economy in Week 3?",
                options: [
                    "No difference; both are identical",
                    "Production economy introduces investment decisions and physical capital: Q_t = A_t F(I_{t-1}); Endowment economy has exogenous output Q_t",
                    "Production economy has no consumption",
                    "Endowment economy includes investment"
                ],
                correct: 1,
                explanation: "Key difference: Endowment economy (Week 3) has exogenous output Q_t. Production economy (Week 5) has endogenous output Q_t = A_t F(I_{t-1}) determined by investment I_{t-1} and productivity A_t. Investment decisions introduce new channels for CA determination."
            },
        ];

        let currentWeek = 'all';
        let currentDifficulty = 'easy';
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let answeredCorrectly = []; // Track if answer was correct on first attempt
        let hasAnswered = []; // Track if question has been answered
        let filteredQuestions = [];
        let userName = '';

        // Week selector
        document.querySelectorAll('.week-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.week-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentWeek = this.dataset.week;
            });
        });

        // Difficulty selector
        document.querySelectorAll('.difficulty-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentDifficulty = this.dataset.difficulty;
            });
        });

        // Leaderboard functions - now using Firebase for global leaderboard
        function saveToLeaderboard(name, score, correct, total, week) {
            const entry = {
                name: name,
                score: score,
                correct: correct,
                total: total,
                week: week,
                date: new Date().toISOString(),
                timestamp: Date.now()
            };

            if (database) {
                // Save to Firebase (global leaderboard)
                const leaderboardRef = database.ref('leaderboard');
                leaderboardRef.push(entry).then(() => {
                    console.log('Score saved to global leaderboard');
                }).catch((error) => {
                    console.error('Error saving to Firebase:', error);
                    // Fallback to localStorage if Firebase fails
                    saveToLocalStorage(entry);
                });
            } else {
                // Fallback to localStorage if Firebase not available
                saveToLocalStorage(entry);
            }
        }

        function saveToLocalStorage(entry) {
            const saved = localStorage.getItem('ec201_leaderboard');
            const leaderboard = saved ? JSON.parse(saved) : [];
            leaderboard.push(entry);
            leaderboard.sort((a, b) => b.score - a.score || b.timestamp - a.timestamp);
            localStorage.setItem('ec201_leaderboard', JSON.stringify(leaderboard));
        }

        function displayLeaderboard(elementId) {
            const element = document.getElementById(elementId);
            element.innerHTML = '<div style="text-align: center; padding: 20px;">Loading global leaderboard...</div>';

            if (database) {
                // Fetch from Firebase (global leaderboard)
                const leaderboardRef = database.ref('leaderboard');
                leaderboardRef.orderByChild('score').limitToLast(100).once('value').then((snapshot) => {
                    const leaderboard = [];
                    snapshot.forEach((childSnapshot) => {
                        leaderboard.push(childSnapshot.val());
                    });

                    // Sort by score descending, then by timestamp
                    leaderboard.sort((a, b) => b.score - a.score || b.timestamp - a.timestamp);

                    renderLeaderboard(leaderboard, element);
                }).catch((error) => {
                    console.error('Error fetching leaderboard:', error);
                    // Fallback to localStorage
                    displayLocalLeaderboard(element);
                });
            } else {
                // Fallback to localStorage
                displayLocalLeaderboard(element);
            }
        }

        function displayLocalLeaderboard(element) {
            const saved = localStorage.getItem('ec201_leaderboard');
            const leaderboard = saved ? JSON.parse(saved) : [];
            renderLeaderboard(leaderboard, element);
        }

        function renderLeaderboard(leaderboard, element) {
            if (leaderboard.length === 0) {
                element.innerHTML = '<div class="no-leaderboard">No scores yet. Be the first!</div>';
                return;
            }

            let html = `
                <div style="text-align: center; margin-bottom: 15px; color: #667eea; font-weight: 600;">
                    ðŸŒ Global Leaderboard - ${leaderboard.length} students competing!
                </div>
                <table class="leaderboard-table">
                <thead><tr><th>Rank</th><th>Name</th><th>Score</th><th>Week</th><th>Date</th></tr></thead>
                <tbody>
            `;

            leaderboard.slice(0, 20).forEach((entry, index) => {
                const rankClass = index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : '';
                const date = new Date(entry.date).toLocaleDateString();
                const weekText = entry.week === 'all' ? 'All Weeks' : `Week ${entry.week}`;

                html += `
                    <tr>
                        <td><span class="rank-badge ${rankClass}">${index + 1}</span></td>
                        <td><strong>${entry.name}</strong></td>
                        <td>${entry.score}% (${entry.correct}/${entry.total})</td>
                        <td>${weekText}</td>
                        <td>${date}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            element.innerHTML = html;
        }

        function showLeaderboardOnly() {
            const display = document.getElementById('leaderboardDisplay');
            if (display.style.display === 'none') {
                display.style.display = 'block';
                displayLeaderboard('leaderboardContent');
            } else {
                display.style.display = 'none';
            }
        }

        function toggleBelgradeTracker() {
            const tracker = document.getElementById('belgradeTracker');
            if (tracker.style.display === 'none') {
                tracker.style.display = 'block';
                // Scroll to tracker
                tracker.scrollIntoView({ behavior: 'smooth', block: 'start' });
            } else {
                tracker.style.display = 'none';
            }
        }

        function startQuiz() {
            // Get user name
            userName = document.getElementById('userName').value.trim();
            if (!userName) {
                alert('Please enter your name before starting the quiz!');
                return;
            }
            // Filter questions based on selected week and difficulty
            let filtered = questions;

            // Filter by difficulty
            filtered = filtered.filter(q => q.difficulty === currentDifficulty);

            // Filter by week
            if (currentWeek === 'all') {
                filteredQuestions = [...filtered];
            } else {
                filteredQuestions = filtered.filter(q => q.week === parseInt(currentWeek));
            }

            // Reset state
            currentQuestionIndex = 0;
            userAnswers = new Array(filteredQuestions.length).fill(null);
            answeredCorrectly = new Array(filteredQuestions.length).fill(false);
            hasAnswered = new Array(filteredQuestions.length).fill(false);

            // Show quiz area
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('quizArea').style.display = 'block';
            document.getElementById('results').classList.remove('show');

            // Display user greeting
            document.getElementById('userGreeting').innerHTML = `Good luck, <strong>${userName}</strong>! ðŸŽ“`;

            displayQuestion();
        }

        function displayQuestion() {
            const container = document.getElementById('questionContainer');
            const question = filteredQuestions[currentQuestionIndex];

            container.innerHTML = `
                <div class="question-card active">
                    <div class="question-header">
                        <span class="question-number">Question ${currentQuestionIndex + 1} of ${filteredQuestions.length}</span>
                        <span class="question-number">Week ${question.week}</span>
                    </div>
                    <div class="question-text">${question.question}</div>
                    <div class="options">
                        ${question.options.map((option, index) => `
                            <div class="option" onclick="selectAnswer(${index})" data-index="${index}">
                                <span class="option-label">${String.fromCharCode(65 + index)}.</span>
                                ${option}
                            </div>
                        `).join('')}
                    </div>
                    <div class="feedback" id="feedback"></div>
                </div>
            `;

            // Restore previous answer if exists
            if (userAnswers[currentQuestionIndex] !== null) {
                selectAnswer(userAnswers[currentQuestionIndex], true);
            }

            updateProgress();
            updateButtons();
        }

        function selectAnswer(index, skipFeedback = false) {
            // If already answered, don't allow changing
            if (hasAnswered[currentQuestionIndex] && !skipFeedback) {
                return;
            }

            const options = document.querySelectorAll('.option');
            options.forEach(opt => {
                opt.classList.remove('selected', 'correct', 'incorrect');
            });

            options[index].classList.add('selected');
            userAnswers[currentQuestionIndex] = index;

            if (!skipFeedback) {
                showFeedback(index);
            }

            document.getElementById('nextBtn').disabled = false;
        }

        function showFeedback(selectedIndex) {
            const question = filteredQuestions[currentQuestionIndex];
            const feedback = document.getElementById('feedback');
            const options = document.querySelectorAll('.option');

            // Mark as answered
            hasAnswered[currentQuestionIndex] = true;

            // Disable all options after first attempt
            options.forEach(opt => {
                opt.style.cursor = 'not-allowed';
                opt.style.opacity = '0.7';
                opt.onclick = null;
            });

            if (selectedIndex === question.correct) {
                // Only count as correct if it's the first attempt
                answeredCorrectly[currentQuestionIndex] = true;
                feedback.className = 'feedback correct show';
                feedback.innerHTML = `<strong>âœ“ Correct!</strong> ${question.explanation}`;
                options[selectedIndex].classList.add('correct');
            } else {
                // Wrong answer - will NOT count toward score
                answeredCorrectly[currentQuestionIndex] = false;
                feedback.className = 'feedback incorrect show';
                feedback.innerHTML = `<strong>âœ— Incorrect.</strong> ${question.explanation}<br><br><em>Note: You cannot change your answer. This will count as incorrect in your final score.</em>`;
                options[selectedIndex].classList.add('incorrect');
                options[question.correct].classList.add('correct');
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < filteredQuestions.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                showResults();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / filteredQuestions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function updateButtons() {
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;

            if (currentQuestionIndex === filteredQuestions.length - 1) {
                document.getElementById('nextBtn').textContent = 'Finish Quiz';
            } else {
                document.getElementById('nextBtn').textContent = 'Next Question';
            }
        }

        function analyzePerformance() {
            // Analyze performance by topic
            const topicStats = {};

            filteredQuestions.forEach((question, index) => {
                const topic = question.topic || 'General';
                const week = question.week;

                if (!topicStats[week]) {
                    topicStats[week] = {};
                }

                if (!topicStats[week][topic]) {
                    topicStats[week][topic] = {
                        correct: 0,
                        total: 0,
                        questions: []
                    };
                }

                topicStats[week][topic].total++;
                topicStats[week][topic].questions.push(question.question);

                if (answeredCorrectly[index]) {
                    topicStats[week][topic].correct++;
                }
            });

            // Generate AI review
            let reviewHTML = '';
            let weakTopics = [];
            let strongTopics = [];

            // Analyze each week
            Object.keys(topicStats).sort().forEach(week => {
                const topics = topicStats[week];

                Object.keys(topics).forEach(topicName => {
                    const stat = topics[topicName];
                    const accuracy = (stat.correct / stat.total) * 100;

                    const topicData = {
                        week: week,
                        topic: topicName,
                        accuracy: accuracy,
                        correct: stat.correct,
                        total: stat.total
                    };

                    if (accuracy < 60) {
                        weakTopics.push(topicData);
                    } else if (accuracy >= 80) {
                        strongTopics.push(topicData);
                    }
                });
            });

            // Sort weak topics by accuracy (worst first)
            weakTopics.sort((a, b) => a.accuracy - b.accuracy);

            // Generate summary
            if (weakTopics.length > 0) {
                reviewHTML += '<div class="ai-summary">';
                reviewHTML += `<strong>Key Finding:</strong> You should focus on improving your understanding of `;
                reviewHTML += weakTopics.slice(0, 3).map(t => `<strong>${t.topic}</strong> (Week ${t.week})`).join(', ');
                reviewHTML += '.</div>';
            } else {
                reviewHTML += '<div class="ai-summary">';
                reviewHTML += `<strong>Excellent!</strong> You have a strong grasp across all topics. Keep up the great work!`;
                reviewHTML += '</div>';
            }

            // Show weak topics first
            if (weakTopics.length > 0) {
                reviewHTML += '<h4 style="color: #dc3545; margin-top: 20px;">âš ï¸ Topics Needing Attention:</h4>';
                weakTopics.forEach(topic => {
                    reviewHTML += `<div class="topic-analysis">`;
                    reviewHTML += `<div class="topic-name">Week ${topic.week}: ${topic.topic}</div>`;
                    reviewHTML += `<div class="topic-score">Accuracy: ${Math.round(topic.accuracy)}% (${topic.correct}/${topic.total} correct)</div>`;
                    reviewHTML += `</div>`;
                });
            }

            // Show strong topics
            if (strongTopics.length > 0) {
                reviewHTML += '<h4 style="color: #28a745; margin-top: 20px;">âœ… Topics You Mastered:</h4>';
                strongTopics.forEach(topic => {
                    reviewHTML += `<div class="topic-analysis good">`;
                    reviewHTML += `<div class="topic-name">Week ${topic.week}: ${topic.topic}</div>`;
                    reviewHTML += `<div class="topic-score">Accuracy: ${Math.round(topic.accuracy)}% (${topic.correct}/${topic.total} correct)</div>`;
                    reviewHTML += `</div>`;
                });
            }

            // Add recommendations
            if (weakTopics.length > 0) {
                reviewHTML += '<div class="recommendations">';
                reviewHTML += '<h4 style="color: #667eea;">ðŸ’¡ Recommendations:</h4>';

                weakTopics.slice(0, 3).forEach(topic => {
                    let recommendation = '';

                    // Customized recommendations based on topic
                    if (topic.topic.includes('NIIP')) {
                        recommendation = 'Review the relationship between Current Account flows and valuation changes. Practice calculating NIIP changes.';
                    } else if (topic.topic.includes('Dark Matter')) {
                        recommendation = 'Revisit the US NIIP-NII paradox. Understand both the Dark Matter hypothesis and Return Differential hypothesis.';
                    } else if (topic.topic.includes('Finite vs Infinite')) {
                        recommendation = 'Focus on the key difference: finite horizon has hard constraints (B_T=0), while infinite horizon has soft constraints (PVâ†’0).';
                    } else if (topic.topic.includes('Transversality')) {
                        recommendation = 'Remember: the transversality condition states that the PRESENT VALUE of debt must vanish, not the debt itself.';
                    } else if (topic.topic.includes('Perpetual Deficits')) {
                        recommendation = 'Study when perpetual CA deficits are sustainable. Key: debt must grow slower than interest rate (g < r).';
                    } else if (topic.topic.includes('Temporary vs Permanent')) {
                        recommendation = 'Master the principle: economies FINANCE temporary shocks (through borrowing) and ADJUST to permanent shocks (by changing consumption).';
                    } else if (topic.topic.includes('Euler')) {
                        recommendation = 'Practice deriving and interpreting the Euler equation. Understand how it relates to optimal intertemporal consumption choice.';
                    } else if (topic.topic.includes('Consumption Smoothing')) {
                        recommendation = 'Understand why households prefer stable consumption over time due to concave utility functions.';
                    } else {
                        recommendation = `Re-read the lecture notes on ${topic.topic} and try practice problems to strengthen your understanding.`;
                    }

                    reviewHTML += `<div class="recommendation-item">`;
                    reviewHTML += `<strong>Week ${topic.week} - ${topic.topic}:</strong> ${recommendation}`;
                    reviewHTML += `</div>`;
                });

                reviewHTML += '</div>';
            }

            document.getElementById('aiReview').innerHTML = reviewHTML;
        }

        function showResults() {
            // Count only answers that were correct on FIRST attempt
            let correct = 0;
            answeredCorrectly.forEach((isCorrect) => {
                if (isCorrect) {
                    correct++;
                }
            });

            const percentage = Math.round((correct / filteredQuestions.length) * 100);

            // Save to leaderboard
            saveToLeaderboard(userName, percentage, correct, filteredQuestions.length, currentWeek);

            document.getElementById('quizArea').style.display = 'none';
            document.getElementById('results').classList.add('show');

            document.getElementById('scoreCircle').textContent = percentage + '%';
            document.getElementById('correctCount').textContent = correct;
            document.getElementById('incorrectCount').textContent = filteredQuestions.length - correct;
            document.getElementById('totalCount').textContent = filteredQuestions.length;

            let title = 'Quiz Complete!';
            if (percentage === 100) title = `Perfect Score, ${userName}!`;
            else if (percentage >= 80) title = `Excellent Work, ${userName}!`;
            else if (percentage >= 60) title = `Good Job, ${userName}!`;
            else if (percentage >= 40) title = `Keep Practicing, ${userName}!`;

            document.getElementById('resultsTitle').textContent = title;

            // Generate AI performance analysis
            analyzePerformance();

            // Display leaderboard
            displayLeaderboard('finalLeaderboard');
        }

        function restartQuiz() {
            document.getElementById('results').classList.remove('show');
            document.getElementById('startScreen').style.display = 'block';
        }

        // ============== CHAT FUNCTIONALITY ==============
        let chatDatabase;
        let chatMessagesRef;

        // Initialize chat when Firebase loads
        function initializeChat() {
            if (typeof firebase !== 'undefined' && firebase.database) {
                chatDatabase = firebase.database();
                chatMessagesRef = chatDatabase.ref('chat');

                // Listen for new messages
                chatMessagesRef.on('child_added', (snapshot) => {
                    const message = snapshot.val();
                    displayChatMessage(message);
                });

                console.log('Chat initialized successfully');
            } else {
                console.error('Firebase not available for chat');
            }
        }

        function toggleChat() {
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.classList.toggle('show');

            if (chatContainer.classList.contains('show')) {
                // Scroll to bottom when opening
                setTimeout(() => {
                    const messagesContainer = document.getElementById('chatMessages');
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }, 100);
            }
        }

        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();

            if (!message) return;

            const userName = document.getElementById('userName').value.trim() || 'Anonymous';

            const messageData = {
                name: userName,
                message: message,
                timestamp: Date.now(),
                date: new Date().toLocaleString()
            };

            // Send to Firebase
            if (chatMessagesRef) {
                chatMessagesRef.push(messageData)
                    .then(() => {
                        input.value = '';
                        console.log('Message sent to chat');
                    })
                    .catch((error) => {
                        console.error('Error sending message:', error);
                        alert('Failed to send message. Please try again.');
                    });
            } else {
                alert('Chat is not connected. Please refresh the page.');
            }
        }

        function displayChatMessage(messageData) {
            const messagesContainer = document.getElementById('chatMessages');

            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message';

            const authorDiv = document.createElement('div');
            authorDiv.className = 'chat-message-author';
            authorDiv.textContent = messageData.name;

            const textDiv = document.createElement('div');
            textDiv.className = 'chat-message-text';
            textDiv.textContent = messageData.message;

            const timeDiv = document.createElement('div');
            timeDiv.className = 'chat-message-time';
            const messageDate = new Date(messageData.timestamp);
            timeDiv.textContent = messageDate.toLocaleTimeString();

            messageDiv.appendChild(authorDiv);
            messageDiv.appendChild(textDiv);
            messageDiv.appendChild(timeDiv);

            messagesContainer.appendChild(messageDiv);

            // Auto-scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Handle Enter key in chat input
        document.addEventListener('DOMContentLoaded', function() {
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendChatMessage();
                    }
                });
            }

            // Initialize chat after Firebase loads
            setTimeout(() => {
                initializeChat();
                initializePoll();
            }, 1000);
        });

        // ============== POLL FUNCTIONALITY ==============
        let pollDatabase;
        let pollVotesRef;
        let selectedPollOption = null;
        let hasVoted = false;

        const pollWeeks = ['week1', 'week2', 'week3', 'week4', 'week5', 'week6', 'week7', 'week8'];

        function initializePoll() {
            if (typeof firebase !== 'undefined' && firebase.database) {
                pollDatabase = firebase.database();
                pollVotesRef = pollDatabase.ref('poll/votes');

                // Check if user has already voted
                const votedStatus = localStorage.getItem('ec201_poll_voted');
                if (votedStatus === 'true') {
                    hasVoted = true;
                    disablePollVoting();
                }

                // Listen for vote updates
                pollVotesRef.on('value', (snapshot) => {
                    updatePollResults(snapshot.val());
                });

                console.log('Poll initialized successfully');
            } else {
                console.error('Firebase not available for poll');
            }
        }

        function selectPollOption(weekId, event) {
            if (hasVoted) {
                console.log('Already voted, cannot select another option');
                return;
            }

            console.log('Selected poll option:', weekId);

            // Remove selected class from all options
            document.querySelectorAll('.poll-option').forEach(opt => {
                opt.classList.remove('selected');
            });

            // Add selected class to clicked option
            event.currentTarget.classList.add('selected');
            selectedPollOption = weekId;

            // Enable submit button
            document.getElementById('pollSubmitBtn').disabled = false;
            console.log('Vote button enabled');
        }

        function submitPollVote() {
            if (!selectedPollOption || hasVoted) {
                console.log('Cannot vote:', { selectedPollOption, hasVoted });
                return;
            }

            if (!pollVotesRef) {
                alert('Poll is not connected to Firebase. Please refresh the page and try again.');
                console.error('pollVotesRef is null');
                return;
            }

            // Get current votes
            pollVotesRef.once('value').then((snapshot) => {
                const votes = snapshot.val() || {};

                // Initialize if doesn't exist
                if (!votes[selectedPollOption]) {
                    votes[selectedPollOption] = 0;
                }

                // Increment vote
                votes[selectedPollOption]++;

                // Save to Firebase
                pollVotesRef.set(votes).then(() => {
                    hasVoted = true;
                    localStorage.setItem('ec201_poll_voted', 'true');
                    disablePollVoting();
                    alert('Thank you for voting! ðŸŽ‰');
                }).catch((error) => {
                    console.error('Error submitting vote:', error);
                    alert('Failed to submit vote. Please try again.');
                });
            }).catch((error) => {
                console.error('Error reading votes:', error);
                alert('Failed to connect to database. Please check your Firebase rules and try again.');
            });
        }

        function disablePollVoting() {
            // Disable all options
            document.querySelectorAll('.poll-option').forEach(opt => {
                opt.classList.add('voted');
                opt.onclick = null;
            });

            // Hide submit button
            const submitBtn = document.getElementById('pollSubmitBtn');
            submitBtn.style.display = 'none';

            // Update subtitle
            document.querySelector('.poll-subtitle').textContent = 'Poll Results - You have already voted';
        }

        function updatePollResults(votes) {
            if (!votes) {
                votes = {};
                pollWeeks.forEach(week => {
                    votes[week] = 0;
                });
            }

            // Calculate total votes
            let totalVotes = 0;
            pollWeeks.forEach(week => {
                totalVotes += (votes[week] || 0);
            });

            // Update display
            if (totalVotes === 0) {
                document.getElementById('pollTotalVotes').textContent = 'No votes yet - be the first to vote!';
            } else {
                document.getElementById('pollTotalVotes').textContent = `Total votes: ${totalVotes}`;
            }

            // Update percentages and bars
            pollWeeks.forEach(week => {
                const voteCount = votes[week] || 0;
                const percentage = totalVotes > 0 ? Math.round((voteCount / totalVotes) * 100) : 0;

                // Update percentage text
                document.getElementById(`percent-${week}`).textContent = `${percentage}%`;

                // Update vote count text
                const voteText = voteCount === 1 ? '1 vote' : `${voteCount} votes`;
                document.getElementById(`votes-${week}`).textContent = voteText;

                // Update bar width
                document.getElementById(`bar-${week}`).style.width = `${percentage}%`;
            });
        }
    </script>

    <!-- Chat UI -->
    <button class="chat-toggle-btn" onclick="toggleChat()" title="Open Chat">
        ðŸ’¬
    </button>

    <div class="chat-container" id="chatContainer">
        <div class="chat-header">
            <span>ðŸ’¬ EC201 Chat</span>
            <button class="chat-close-btn" onclick="toggleChat()">Ã—</button>
        </div>
        <div class="chat-messages" id="chatMessages">
            <!-- Messages will appear here -->
        </div>
        <div class="chat-input-container">
            <input
                type="text"
                class="chat-input"
                id="chatInput"
                placeholder="Type a message..."
                maxlength="500"
            >
            <button class="chat-send-btn" onclick="sendChatMessage()">Send</button>
        </div>
    </div>
</body>
</html>
